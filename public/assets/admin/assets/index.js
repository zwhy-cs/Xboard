import{r as m,j as e,t as ki,c as Ti,I as qn,a as tt,S as mn,u as Rs,b as Di,d as un,R as ml,e as ul,f as Pi,F as Li,C as Ei,L as xl,T as hl,g as pl,h as Ii,i as Ri,k as Vi,l as $,z as x,m as V,n as Ne,o as we,p as le,q as fs,s as ke,v as Fi,w as Mi,O as xn,x as Oi,y as zi,A as $i,B as Ai,D as qi,E as Hi,Q as Ui,G as Ki,H as Bi,J as Gi,P as Wi,K as Yi,M as Ji,N as Qi,U as Xi,V as gl,W as fl,X as Ca,Y as Sa,Z as hn,_ as ds,$ as ka,a0 as Ta,a1 as jl,a2 as vl,a3 as bl,a4 as pn,a5 as yl,a6 as Zi,a7 as Nl,a8 as _l,a9 as wl,aa as Cl,ab as at,ac as Sl,ad as eo,ae as kl,af as Tl,ag as so,ah as to,ai as ao,aj as no,ak as lo,al as ro,am as io,an as oo,ao as co,ap as mo,aq as uo,ar as Dl,as as xo,at as ho,au as nt,av as Pl,aw as po,ax as go,ay as Ll,az as gn,aA as fo,aB as jo,aC as Hn,aD as vo,aE as El,aF as bo,aG as Il,aH as yo,aI as No,aJ as _o,aK as wo,aL as Co,aM as So,aN as Rl,aO as ko,aP as To,aQ as Do,aR as He,aS as Po,aT as fn,aU as Lo,aV as Eo,aW as Vl,aX as Fl,aY as Ml,aZ as Io,a_ as Ro,a$ as Vo,b0 as Ol,b1 as Fo,b2 as jn,b3 as zl,b4 as Mo,b5 as $l,b6 as Oo,b7 as Al,b8 as zo,b9 as ql,ba as Hl,bb as $o,bc as Ao,bd as Ul,be as qo,bf as Ho,bg as Kl,bh as Uo,bi as Bl,bj as Ko,bk as Bo,bl as ps,bm as hs,bn as Ct,bo as Go,bp as Wo,bq as Yo,br as Jo,bs as Qo,bt as Xo,bu as Un,bv as Kn,bw as Zo,bx as ec,by as Gl,bz as sc,bA as tc,bB as pa,bC as Kt,bD as ac,bE as nc,bF as Wl,bG as lc,bH as rc,bI as Yl,bJ as ic,bK as oc,bL as Bn,bM as tn,bN as an,bO as cc,bP as dc,bQ as Jl,bR as mc,bS as uc,bT as xc,bU as ga,bV as nn,bW as Je,bX as fa,bY as hc,bZ as Ua,b_ as pc,b$ as Gn,c0 as We,c1 as $t,c2 as da,c3 as ln,c4 as Ql,c5 as Qe,c6 as rs,c7 as Xl,c8 as Zl,c9 as gc,ca as fc,cb as jc,cc as vc,cd as bc,ce as er,cf as yc,cg as Nc,ch as ze,ci as Wn,cj as _c,ck as sr,cl as tr,cm as ar,cn as nr,co as lr,cp as rr,cq as wc,cr as Cc,cs as Sc,ct as Da,cu as lt,cv as js,cw as vs,cx as kc,cy as Tc,cz as Dc,cA as Pc,cB as Lc,cC as Ec,cD as Ic,cE as Rc,cF as Vc,cG as rn,cH as vn,cI as bn,cJ as Fc,cK as Vs,cL as Fs,cM as Pa,cN as Mc,cO as ja,cP as Oc,cQ as Yn,cR as ir,cS as Jn,cT as va,cU as zc,cV as $c,cW as Ac,cX as qc,cY as Hc,cZ as or,c_ as Uc,c$ as Kc,d0 as cr,d1 as on,d2 as dr,d3 as Bc,d4 as mr,d5 as ur,d6 as Gc,d7 as Wc,d8 as Yc,d9 as Jc,da as Qc}from"./vendor.js";import"./index.js";var np=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lp(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Xc(s){if(s.__esModule)return s;var a=s.default;if(typeof a=="function"){var t=function l(){return this instanceof l?Reflect.construct(a,arguments,this.constructor):a.apply(this,arguments)};t.prototype=a.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(l){var n=Object.getOwnPropertyDescriptor(s,l);Object.defineProperty(t,l,n.get?n:{enumerable:!0,get:function(){return s[l]}})}),t}const Zc={theme:"system",setTheme:()=>null},xr=m.createContext(Zc);function ed({children:s,defaultTheme:a="system",storageKey:t="vite-ui-theme",...l}){const[n,r]=m.useState(()=>localStorage.getItem(t)||a);m.useEffect(()=>{const c=window.document.documentElement;if(c.classList.remove("light","dark"),n==="system"){const u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";c.classList.add(u);return}c.classList.add(n)},[n]);const o={theme:n,setTheme:c=>{localStorage.setItem(t,c),r(c)}};return e.jsx(xr.Provider,{...l,value:o,children:s})}const sd=()=>{const s=m.useContext(xr);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},td=function(){const a=typeof document<"u"&&document.createElement("link").relList;return a&&a.supports&&a.supports("modulepreload")?"modulepreload":"preload"}(),ad=function(s,a){return new URL(s,a).href},Qn={},be=function(a,t,l){let n=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");n=Promise.allSettled(t.map(i=>{if(i=ad(i,l),i in Qn)return;Qn[i]=!0;const d=i.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(!!l)for(let S=o.length-1;S>=0;S--){const w=o[S];if(w.href===i&&(!d||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${h}`))return;const C=document.createElement("link");if(C.rel=d?"stylesheet":td,d||(C.as="script"),C.crossOrigin="",C.href=i,u&&C.setAttribute("nonce",u),document.head.appendChild(C),d)return new Promise((S,w)=>{C.addEventListener("load",S),C.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function r(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&r(c.reason);return a().catch(r)})};function y(...s){return ki(Ti(s))}const St=tt("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),L=m.forwardRef(({className:s,variant:a,size:t,asChild:l=!1,children:n,disabled:r,loading:o=!1,leftSection:c,rightSection:u,...i},d)=>{const h=l?mn:"button";return e.jsxs(h,{className:y(St({variant:a,size:t,className:s})),disabled:o||r,ref:d,...i,children:[(c&&o||!c&&!u&&o)&&e.jsx(qn,{className:"mr-2 h-4 w-4 animate-spin"}),!o&&c&&e.jsx("div",{className:"mr-2",children:c}),n,!o&&u&&e.jsx("div",{className:"ml-2",children:u}),u&&o&&e.jsx(qn,{className:"ml-2 h-4 w-4 animate-spin"})]})});L.displayName="Button";function dt({className:s,minimal:a=!1}){const t=Rs(),l=Di(),n=l?.message||l?.statusText||"Unknown error occurred";return e.jsx("div",{className:y("h-svh w-full",s),children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[!a&&e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"500"}),e.jsxs("span",{className:"font-medium",children:["Oops! Something went wrong ",":')"]}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["We apologize for the inconvenience. ",e.jsx("br",{}),n]}),!a&&e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx(L,{variant:"outline",onClick:()=>t(-1),children:"Go Back"}),e.jsx(L,{onClick:()=>t("/"),children:"Back to Home"})]})]})})}function Xn(){const s=Rs();return e.jsx("div",{className:"h-svh",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"404"}),e.jsx("span",{className:"font-medium",children:"Oops! Page Not Found!"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["It seems like the page you're looking for ",e.jsx("br",{}),"does not exist or might have been removed."]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx(L,{variant:"outline",onClick:()=>s(-1),children:"Go Back"}),e.jsx(L,{onClick:()=>s("/"),children:"Back to Home"})]})]})})}function nd(){return e.jsx("div",{className:"h-svh",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"503"}),e.jsx("span",{className:"font-medium",children:"Website is under maintenance!"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["The site is not available at the moment. ",e.jsx("br",{}),"We'll be back online shortly."]}),e.jsx("div",{className:"mt-6 flex gap-4",children:e.jsx(L,{variant:"outline",children:"Learn more"})})]})})}function ld(s){return typeof s>"u"}function rd(s){return s===null}function id(s){return rd(s)||ld(s)}class od{storage;prefixKey;constructor(a){this.storage=a.storage,this.prefixKey=a.prefixKey}getKey(a){return`${this.prefixKey}${a}`.toUpperCase()}set(a,t,l=null){const n=JSON.stringify({value:t,time:Date.now(),expire:l!==null?new Date().getTime()+l*1e3:null});this.storage.setItem(this.getKey(a),n)}get(a,t=null){const l=this.storage.getItem(this.getKey(a));if(!l)return{value:t,time:0};try{const n=JSON.parse(l),{value:r,time:o,expire:c}=n;return id(c)||c>new Date().getTime()?{value:r,time:o}:(this.remove(a),{value:t,time:0})}catch{return this.remove(a),{value:t,time:0}}}remove(a){this.storage.removeItem(this.getKey(a))}clear(){this.storage.clear()}}function hr({prefixKey:s="",storage:a=sessionStorage}){return new od({prefixKey:s,storage:a})}const pr="Xboard_",cd=function(s={}){return hr({prefixKey:s.prefixKey||"",storage:localStorage})},dd=function(s={}){return hr({prefixKey:s.prefixKey||"",storage:sessionStorage})},La=cd({prefixKey:pr});dd({prefixKey:pr});const gr="access_token";function Bt(){return La.get(gr)}function fr(){La.remove(gr)}const Zn=["/sign-in","/sign-in-2","/sign-up","/forgot-password","/otp"];function md({children:s}){const a=Rs(),t=un(),l=Bt();return m.useEffect(()=>{if(!l.value&&!Zn.includes(t.pathname)){const n=encodeURIComponent(t.pathname+t.search);a(`/sign-in?redirect=${n}`)}},[l.value,t.pathname,t.search,a]),Zn.includes(t.pathname)||l.value?e.jsx(e.Fragment,{children:s}):null}const De=m.forwardRef(({className:s,orientation:a="horizontal",decorative:t=!0,...l},n)=>e.jsx(ml,{ref:n,decorative:t,orientation:a,className:y("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...l}));De.displayName=ml.displayName;const ud=tt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Xs=m.forwardRef(({className:s,...a},t)=>e.jsx(ul,{ref:t,className:y(ud(),s),...a}));Xs.displayName=ul.displayName;const Ce=Li,jr=m.createContext({}),v=({...s})=>e.jsx(jr.Provider,{value:{name:s.name},children:e.jsx(Ei,{...s})}),Ea=()=>{const s=m.useContext(jr),a=m.useContext(vr),{getFieldState:t,formState:l}=Pi(),n=t(s.name,l);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:r}=a;return{id:r,name:s.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...n}},vr=m.createContext({}),f=m.forwardRef(({className:s,...a},t)=>{const l=m.useId();return e.jsx(vr.Provider,{value:{id:l},children:e.jsx("div",{ref:t,className:y("space-y-2",s),...a})})});f.displayName="FormItem";const j=m.forwardRef(({className:s,...a},t)=>{const{error:l,formItemId:n}=Ea();return e.jsx(Xs,{ref:t,className:y(l&&"text-destructive",s),htmlFor:n,...a})});j.displayName="FormLabel";const b=m.forwardRef(({...s},a)=>{const{error:t,formItemId:l,formDescriptionId:n,formMessageId:r}=Ea();return e.jsx(mn,{ref:a,id:l,"aria-describedby":t?`${n} ${r}`:`${n}`,"aria-invalid":!!t,...s})});b.displayName="FormControl";const M=m.forwardRef(({className:s,...a},t)=>{const{formDescriptionId:l}=Ea();return e.jsx("p",{ref:t,id:l,className:y("text-[0.8rem] text-muted-foreground",s),...a})});M.displayName="FormDescription";const P=m.forwardRef(({className:s,children:a,...t},l)=>{const{error:n,formMessageId:r}=Ea(),o=n?String(n?.message):a;return o?e.jsx("p",{ref:l,id:r,className:y("text-[0.8rem] font-medium text-destructive",s),...t,children:o}):null});P.displayName="FormMessage";const Wt=Ii,kt=m.forwardRef(({className:s,...a},t)=>e.jsx(xl,{ref:t,className:y("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...a}));kt.displayName=xl.displayName;const es=m.forwardRef(({className:s,...a},t)=>e.jsx(hl,{ref:t,className:y("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...a}));es.displayName=hl.displayName;const Ls=m.forwardRef(({className:s,...a},t)=>e.jsx(pl,{ref:t,className:y("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));Ls.displayName=pl.displayName;function Se(s=void 0,a="YYYY-MM-DD HH:mm:ss"){return s==null?"":(Math.floor(s).toString().length===10&&(s=s*1e3),Ri(s).format(a))}function xd(s=void 0,a="YYYY-MM-DD"){return Se(s,a)}function gt(s){const a=typeof s=="string"?parseFloat(s):s;return isNaN(a)?"0.00":a.toFixed(2)}function Js(s,a=!0){if(s==null)return a?"¥0.00":"0.00";const t=typeof s=="string"?parseFloat(s):s;if(isNaN(t))return a?"¥0.00":"0.00";const n=(t/100).toFixed(2).replace(/\.?0+$/,r=>r.includes(".")?".00":r);return a?`¥${n}`:n}function ba(s){return new Promise(a=>{(async()=>{try{if(navigator.clipboard)await navigator.clipboard.writeText(s);else{const l=document.createElement("textarea");l.value=s,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.select();const n=document.execCommand("copy");if(document.body.removeChild(l),!n)throw new Error("execCommand failed")}a(!0)}catch(l){console.error(l),a(!1)}})()})}function Oe(s){const a=s/1024,t=a/1024,l=t/1024,n=l/1024;return n>=1?gt(n)+" TB":l>=1?gt(l)+" GB":t>=1?gt(t)+" MB":gt(a)+" KB"}const hd="locale";function pd(){return La.get(hd)}function br(){fr();const s=window.location.pathname,a=s&&!["/404","/sign-in"].includes(s),t=new URL(window.location.href),n=`${t.pathname.split("/")[1]?`/${t.pathname.split("/")[1]}`:""}#/sign-in`;window.location.href=n+(a?`?redirect=${s}`:"")}const gd=["/passport/auth/login","/passport/auth/token2Login","/passport/auth/register","/guest/comm/config","/passport/comm/sendEmailVerify","/passport/auth/forget"];function fd(){const s=window.settings?.base_url||"/";return s.endsWith("/")?s+"api/v2":s+"/api/v2"}const ft=Vi.create({baseURL:fd(),timeout:12e3,headers:{"Content-Type":"application/json"}});ft.interceptors.request.use(s=>{s.method?.toLowerCase()==="get"&&(s.params={...s.params,t:Date.now()});const a=Bt();if(!gd.includes(s.url?.split("?")[0]||"")){if(!a.value)return br(),Promise.reject({code:-1,message:"未登录"});s.headers.Authorization=a.value}return s.headers["Content-Language"]=pd().value||"zh-CN",s},s=>Promise.reject(s));ft.interceptors.response.use(s=>s?.data||{code:-1,message:"未知错误"},s=>{const a=s.response?.status,t=s.response?.data?.message;return(a===401||a===403)&&br(),$.error(t||{401:"登录已过期",403:"没有权限",404:"资源或接口不存在"}[a]||"未知异常"),Promise.reject(s.response?.data||{data:null,code:-1,message:"未知错误"})});const F={get:(s,a)=>ft.get(s,a),post:(s,a,t)=>ft.post(s,a,t),put:(s,a,t)=>ft.put(s,a,t),delete:(s,a)=>ft.delete(s,a)},jd="access_token";function vd(s){La.set(jd,s)}const Ws=window?.settings?.secure_path,ya={getStats:()=>F.get(Ws+"/monitor/api/stats"),getOverride:()=>F.get(Ws+"/stat/getOverride"),getOrderStat:s=>F.get(Ws+"/stat/getOrder",{params:s}),getStatsData:()=>F.get(Ws+"/stat/getStats"),getNodeTrafficData:s=>F.get(Ws+"/stat/getTrafficRank",{params:s}),getServerLastRank:()=>F.get(Ws+"/stat/getServerLastRank"),getServerYesterdayRank:()=>F.get(Ws+"/stat/getServerYesterdayRank")},Lt=window?.settings?.secure_path,At={getList:()=>F.get(Lt+"/theme/getThemes"),getConfig:s=>F.post(Lt+"/theme/getThemeConfig",{name:s}),updateConfig:(s,a)=>F.post(Lt+"/theme/saveThemeConfig",{name:s,config:a}),upload:s=>{const a=new FormData;return a.append("file",s),F.post(Lt+"/theme/upload",a,{headers:{"Content-Type":"multipart/form-data"}})},drop:s=>F.post(Lt+"/theme/delete",{name:s})},mt=window?.settings?.secure_path,Zs={getList:()=>F.get(mt+"/server/manage/getNodes"),save:s=>F.post(mt+"/server/manage/save",s),drop:s=>F.post(mt+"/server/manage/drop",s),copy:s=>F.post(mt+"/server/manage/copy",s),update:s=>F.post(mt+"/server/manage/update",s),sort:s=>F.post(mt+"/server/manage/sort",s)},Ka=window?.settings?.secure_path,rt={getList:()=>F.get(Ka+"/server/group/fetch"),save:s=>F.post(Ka+"/server/group/save",s),drop:s=>F.post(Ka+"/server/group/drop",s)},Ba=window?.settings?.secure_path,Ia={getList:()=>F.get(Ba+"/server/route/fetch"),save:s=>F.post(Ba+"/server/route/save",s),drop:s=>F.post(Ba+"/server/route/drop",s)},Ys=window?.settings?.secure_path,et={getList:()=>F.get(Ys+"/payment/fetch"),getMethodList:()=>F.get(Ys+"/payment/getPaymentMethods"),getMethodForm:s=>F.post(Ys+"/payment/getPaymentForm",s),save:s=>F.post(Ys+"/payment/save",s),drop:s=>F.post(Ys+"/payment/drop",s),updateStatus:s=>F.post(Ys+"/payment/show",s),sort:s=>F.post(Ys+"/payment/sort",s)},Et=window?.settings?.secure_path,Gt={getList:()=>F.get(`${Et}/notice/fetch`),save:s=>F.post(`${Et}/notice/save`,s),drop:s=>F.post(`${Et}/notice/drop`,{id:s}),updateStatus:s=>F.post(`${Et}/notice/show`,{id:s}),sort:s=>F.post(`${Et}/notice/sort`,{ids:s})},ut=window?.settings?.secure_path,bt={getList:()=>F.get(ut+"/knowledge/fetch"),getInfo:s=>F.get(ut+"/knowledge/fetch?id="+s),save:s=>F.post(ut+"/knowledge/save",s),drop:s=>F.post(ut+"/knowledge/drop",s),updateStatus:s=>F.post(ut+"/knowledge/show",s),sort:s=>F.post(ut+"/knowledge/sort",s)},It=window?.settings?.secure_path,ss={getList:()=>F.get(It+"/plan/fetch"),save:s=>F.post(It+"/plan/save",s),update:s=>F.post(It+"/plan/update",s),drop:s=>F.post(It+"/plan/drop",s),sort:s=>F.post(It+"/plan/sort",{ids:s})},xt=window?.settings?.secure_path,Qs={getList:s=>F.post(xt+"/order/fetch",s),getInfo:s=>F.post(xt+"/order/detail",s),markPaid:s=>F.post(xt+"/order/paid",s),makeCancel:s=>F.post(xt+"/order/cancel",s),update:s=>F.post(xt+"/order/update",s),assign:s=>F.post(xt+"/order/assign",s)},sa=window?.settings?.secure_path,Na={getList:s=>F.post(sa+"/coupon/fetch",s),save:s=>F.post(sa+"/coupon/generate",s),drop:s=>F.post(sa+"/coupon/drop",s),update:s=>F.post(sa+"/coupon/update",s)},ys=window?.settings?.secure_path,_s={getList:s=>F.post(`${ys}/user/fetch`,s),update:s=>F.post(`${ys}/user/update`,s),resetSecret:s=>F.post(`${ys}/user/resetSecret`,{id:s}),generate:s=>s.download_csv?F.post(`${ys}/user/generate`,s,{responseType:"blob"}):F.post(`${ys}/user/generate`,s),getStats:s=>F.post(`${ys}/stat/getStatUser`,s),destroy:s=>F.post(`${ys}/user/destroy`,{id:s}),sendMail:s=>F.post(`${ys}/user/sendMail`,s),dumpCSV:s=>F.post(`${ys}/user/dumpCSV`,s,{responseType:"blob"}),batchBan:s=>F.post(`${ys}/user/ban`,s)},ta=window?.settings?.secure_path,jt={getList:s=>F.post(ta+"/ticket/fetch",s),getInfo:s=>F.get(ta+"/ticket/fetch?id= "+s),reply:s=>F.post(ta+"/ticket/reply",s),close:s=>F.post(ta+"/ticket/close",{id:s})},Me=window?.settings?.secure_path,ce={getSettings:(s="")=>F.get(Me+"/config/fetch?key="+s),saveSettings:s=>F.post(Me+"/config/save",s),getEmailTemplate:()=>F.get(Me+"/config/getEmailTemplate"),sendTestMail:()=>F.post(Me+"/config/testSendMail"),setTelegramWebhook:()=>F.post(Me+"/config/setTelegramWebhook"),updateSystemConfig:s=>F.post(Me+"/config/save",s),getSystemStatus:()=>F.get(`${Me}/system/getSystemStatus`),getQueueStats:()=>F.get(`${Me}/system/getQueueStats`),getQueueWorkload:()=>F.get(`${Me}/system/getQueueWorkload`),getQueueMasters:()=>F.get(`${Me}/system/getQueueMasters`),getHorizonFailedJobs:s=>F.get(`${Me}/system/getHorizonFailedJobs`,{params:s}),getSystemLog:s=>F.get(`${Me}/system/getSystemLog`,{params:s}),getLogFiles:()=>F.get(`${Me}/log/files`),getLogContent:s=>F.get(`${Me}/log/fetch`,{params:s}),getLogClearStats:s=>F.get(`${Me}/system/getLogClearStats`,{params:s}),clearSystemLog:s=>F.post(`${Me}/system/clearSystemLog`,s)},Ds=window?.settings?.secure_path,Ps={getPluginList:()=>F.get(`${Ds}/plugin/getPlugins`),uploadPlugin:s=>{const a=new FormData;return a.append("file",s),F.post(`${Ds}/plugin/upload`,a,{headers:{"Content-Type":"multipart/form-data"}})},deletePlugin:s=>F.post(`${Ds}/plugin/delete`,{code:s}),installPlugin:s=>F.post(`${Ds}/plugin/install`,{code:s}),uninstallPlugin:s=>F.post(`${Ds}/plugin/uninstall`,{code:s}),enablePlugin:s=>F.post(`${Ds}/plugin/enable`,{code:s}),disablePlugin:s=>F.post(`${Ds}/plugin/disable`,{code:s}),getPluginConfig:s=>F.get(`${Ds}/plugin/config`,{params:{code:s}}),updatePluginConfig:(s,a)=>F.post(`${Ds}/plugin/config`,{code:s,config:a})};window?.settings?.secure_path;const bd=x.object({subscribe_template_singbox:x.string().optional().default(""),subscribe_template_clash:x.string().optional().default(""),subscribe_template_clashmeta:x.string().optional().default(""),subscribe_template_stash:x.string().optional().default(""),subscribe_template_surge:x.string().optional().default(""),subscribe_template_surfboard:x.string().optional().default("")}),el=[{key:"singbox",label:"Sing-box",language:"json"},{key:"clash",label:"Clash",language:"yaml"},{key:"clashmeta",label:"Clash Meta",language:"yaml"},{key:"stash",label:"Stash",language:"yaml"},{key:"surge",label:"Surge",language:"ini"},{key:"surfboard",label:"Surfboard",language:"ini"}],sl={subscribe_template_singbox:"",subscribe_template_clash:"",subscribe_template_clashmeta:"",subscribe_template_stash:"",subscribe_template_surge:"",subscribe_template_surfboard:""};function yd(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),[n,r]=m.useState("singbox"),o=Ne({resolver:we(bd),defaultValues:sl,mode:"onChange"}),{data:c,isLoading:u}=le({queryKey:["settings","client"],queryFn:()=>ce.getSettings("subscribe_template")}),{mutateAsync:i}=fs({mutationFn:ce.saveSettings,onSuccess:()=>{$.success(s("common.autoSaved"))},onError:C=>{console.error("保存失败:",C),$.error(s("common.saveFailed"))}});m.useEffect(()=>{if(c?.data?.subscribe_template){const C=c.data.subscribe_template;Object.entries(C).forEach(([S,w])=>{if(S in sl){const N=typeof w=="string"?w:"";o.setValue(S,N)}}),l.current=o.getValues()}},[c,o]);const d=m.useCallback(ke.debounce(async C=>{if(!l.current||!ke.isEqual(C,l.current)){t(!0);try{await i(C),l.current=C}catch(S){console.error("保存设置失败:",S)}finally{t(!1)}}},1500),[i]),h=m.useCallback(()=>{const C=o.getValues();d(C)},[o,d]),k=m.useCallback((C,S)=>e.jsx(v,{control:o.control,name:C,render:({field:w})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s(`subscribe_template.${C.replace("subscribe_template_","")}.title`)}),e.jsx(b,{children:e.jsx(Fi,{height:"500px",defaultLanguage:S,value:w.value||"",onChange:N=>{w.onChange(N||""),h()},options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),e.jsx(M,{children:s(`subscribe_template.${C.replace("subscribe_template_","")}.description`)}),e.jsx(P,{})]})}),[o.control,s,h]);return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.loading")})}):e.jsx(Ce,{...o,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Wt,{value:n,onValueChange:r,className:"w-full",children:[e.jsx(kt,{className:"",children:el.map(({key:C,label:S})=>e.jsx(es,{value:C,className:"text-xs",children:S},C))}),el.map(({key:C,language:S})=>e.jsx(Ls,{value:C,className:"mt-4",children:k(`subscribe_template_${C}`,S)},C))]}),a&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"h-2 w-2 animate-pulse rounded-full bg-blue-500"}),s("common.saving")]})]})})}function Nd(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("subscribe_template.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("subscribe_template.description")})]}),e.jsx(De,{}),e.jsx(yd,{})]})}const _d=()=>e.jsx(md,{children:e.jsx(xn,{})}),wd=Mi([{path:"/sign-in",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Ad);return{default:s}},void 0,import.meta.url)).default})},{element:e.jsx(_d,{}),children:[{path:"/",lazy:async()=>({Component:(await be(()=>Promise.resolve().then(()=>Jd),void 0,import.meta.url)).default}),errorElement:e.jsx(dt,{}),children:[{index:!0,lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>gm);return{default:s}},void 0,import.meta.url)).default})},{path:"config",errorElement:e.jsx(dt,{}),children:[{path:"system",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>bm);return{default:s}},void 0,import.meta.url)).default}),children:[{index:!0,lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>wm);return{default:s}},void 0,import.meta.url)).default})},{path:"safe",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Dm);return{default:s}},void 0,import.meta.url)).default})},{path:"subscribe",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Rm);return{default:s}},void 0,import.meta.url)).default})},{path:"invite",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>zm);return{default:s}},void 0,import.meta.url)).default})},{path:"frontend",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Um);return{default:s}},void 0,import.meta.url)).default})},{path:"server",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Ym);return{default:s}},void 0,import.meta.url)).default})},{path:"email",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>eu);return{default:s}},void 0,import.meta.url)).default})},{path:"telegram",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>lu);return{default:s}},void 0,import.meta.url)).default})},{path:"APP",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>du);return{default:s}},void 0,import.meta.url)).default})},{path:"subscribe-template",element:e.jsx(Nd,{})}]},{path:"payment",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>fu);return{default:s}},void 0,import.meta.url)).default})},{path:"plugin",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>bu);return{default:s}},void 0,import.meta.url)).default})},{path:"theme",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>wu);return{default:s}},void 0,import.meta.url)).default})},{path:"notice",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Lu);return{default:s}},void 0,import.meta.url)).default})},{path:"knowledge",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>zu);return{default:s}},void 0,import.meta.url)).default})}]},{path:"server",errorElement:e.jsx(dt,{}),children:[{path:"manage",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>px);return{default:s}},void 0,import.meta.url)).default})},{path:"group",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>bx);return{default:s}},void 0,import.meta.url)).default})},{path:"route",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Sx);return{default:s}},void 0,import.meta.url)).default})}]},{path:"finance",errorElement:e.jsx(dt,{}),children:[{path:"plan",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Vx);return{default:s}},void 0,import.meta.url)).default})},{path:"order",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Yx);return{default:s}},void 0,import.meta.url)).default})},{path:"coupon",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>nh);return{default:s}},void 0,import.meta.url)).default})}]},{path:"user",errorElement:e.jsx(dt,{}),children:[{path:"manage",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>Rh);return{default:s}},void 0,import.meta.url)).default})},{path:"ticket",lazy:async()=>({Component:(await be(async()=>{const{default:s}=await Promise.resolve().then(()=>ep);return{default:s}},void 0,import.meta.url)).default})}]}]}]},{path:"/500",Component:dt},{path:"/404",Component:Xn},{path:"/503",Component:nd},{path:"*",Component:Xn}]);function Cd(){return F.get("/user/info")}const Ga={token:Bt()?.value||"",userInfo:null,isLoggedIn:!!Bt()?.value,loading:!1,error:null},qt=Oi("user/fetchUserInfo",async()=>(await Cd()).data,{condition:(s,{getState:a})=>{const{user:t}=a();return!!t.token&&!t.loading}}),yr=zi({name:"user",initialState:Ga,reducers:{setToken(s,a){s.token=a.payload,s.isLoggedIn=!!a.payload},resetUserState:()=>Ga},extraReducers:s=>{s.addCase(qt.pending,a=>{a.loading=!0,a.error=null}).addCase(qt.fulfilled,(a,t)=>{a.loading=!1,a.userInfo=t.payload,a.error=null}).addCase(qt.rejected,(a,t)=>{if(a.loading=!1,a.error=t.error.message||"Failed to fetch user info",!a.token)return Ga})}}),{setToken:Sd,resetUserState:kd}=yr.actions,Td=s=>s.user.userInfo,Dd=yr.reducer,Nr=$i({reducer:{user:Dd}});Bt()?.value&&Nr.dispatch(qt());Ai.use(qi).use(Hi).init({resources:{"en-US":window.XBOARD_TRANSLATIONS?.["en-US"]||{},"zh-CN":window.XBOARD_TRANSLATIONS?.["zh-CN"]||{},"ko-KR":window.XBOARD_TRANSLATIONS?.["ko-KR"]||{}},fallbackLng:"zh-CN",supportedLngs:["en-US","zh-CN","ko-KR"],detection:{order:["querystring","localStorage","navigator"],lookupQuerystring:"lang",lookupLocalStorage:"i18nextLng",caches:["localStorage"]},interpolation:{escapeValue:!1}});const Pd=new Ui;Ki.createRoot(document.getElementById("root")).render(e.jsx(Bi.StrictMode,{children:e.jsx(Gi,{client:Pd,children:e.jsx(Wi,{store:Nr,children:e.jsxs(ed,{defaultTheme:"light",storageKey:"vite-ui-theme",children:[e.jsx(Yi,{router:wd}),e.jsx(Ji,{richColors:!0,position:"top-right"})]})})})}));const Ye=m.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:y("rounded-xl border bg-card text-card-foreground shadow",s),...a}));Ye.displayName="Card";const ts=m.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:y("flex flex-col space-y-1.5 p-6",s),...a}));ts.displayName="CardHeader";const Ns=m.forwardRef(({className:s,...a},t)=>e.jsx("h3",{ref:t,className:y("font-semibold leading-none tracking-tight",s),...a}));Ns.displayName="CardTitle";const st=m.forwardRef(({className:s,...a},t)=>e.jsx("p",{ref:t,className:y("text-sm text-muted-foreground",s),...a}));st.displayName="CardDescription";const as=m.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:y("p-6 pt-0",s),...a}));as.displayName="CardContent";const Ld=m.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:y("flex items-center p-6 pt-0",s),...a}));Ld.displayName="CardFooter";const D=m.forwardRef(({className:s,type:a,...t},l)=>e.jsx("input",{type:a,className:y("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:l,...t}));D.displayName="Input";const _r=m.forwardRef(({className:s,...a},t)=>{const[l,n]=m.useState(!1);return e.jsxs("div",{className:"relative rounded-md",children:[e.jsx("input",{type:l?"text":"password",className:y("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a}),e.jsx(L,{type:"button",size:"icon",variant:"ghost",className:"absolute right-1 top-1/2 h-6 w-6 -translate-y-1/2 rounded-md text-muted-foreground",onClick:()=>n(r=>!r),children:l?e.jsx(Qi,{size:18}):e.jsx(Xi,{size:18})})]})});_r.displayName="PasswordInput";const Ed=s=>F.post("/passport/auth/login",s);function Id({className:s,onForgotPassword:a,...t}){const l=Rs(),n=gl(),{t:r}=V("auth"),o=x.object({email:x.string().min(1,{message:r("signIn.validation.emailRequired")}),password:x.string().min(1,{message:r("signIn.validation.passwordRequired")}).min(7,{message:r("signIn.validation.passwordLength")})}),c=Ne({resolver:we(o),defaultValues:{email:"",password:""}});async function u(i){try{const{data:d}=await Ed(i);vd(d.auth_data),n(Sd(d.auth_data)),await n(qt()).unwrap(),l("/")}catch(d){console.error("Login failed:",d),d.response?.data?.message&&c.setError("root",{message:d.response.data.message})}}return e.jsx("div",{className:y("grid gap-6",s),...t,children:e.jsx(Ce,{...c,children:e.jsx("form",{onSubmit:c.handleSubmit(u),className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[c.formState.errors.root&&e.jsx("div",{className:"text-sm text-destructive",children:c.formState.errors.root.message}),e.jsx(v,{control:c.control,name:"email",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:r("signIn.email")}),e.jsx(b,{children:e.jsx(D,{placeholder:r("signIn.emailPlaceholder"),autoComplete:"email",...i})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"password",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:r("signIn.password")}),e.jsx(b,{children:e.jsx(_r,{placeholder:r("signIn.passwordPlaceholder"),autoComplete:"current-password",...i})}),e.jsx(P,{})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(L,{variant:"link",type:"button",className:"px-0 text-sm font-normal text-muted-foreground hover:text-primary",onClick:a,children:r("signIn.forgotPassword")})}),e.jsx(L,{className:"w-full",size:"lg",loading:c.formState.isSubmitting,children:r("signIn.submit")})]})})})})}const ge=fl,is=jl,Rd=vl,qs=hn,wr=m.forwardRef(({className:s,...a},t)=>e.jsx(Ca,{ref:t,className:y("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));wr.displayName=Ca.displayName;const pe=m.forwardRef(({className:s,children:a,...t},l)=>e.jsxs(Rd,{children:[e.jsx(wr,{}),e.jsxs(Sa,{ref:l,className:y("max-h-[95%] overflow-auto fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[a,e.jsxs(hn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));pe.displayName=Sa.displayName;const ve=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});ve.displayName="DialogHeader";const Le=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Le.displayName="DialogFooter";const fe=m.forwardRef(({className:s,...a},t)=>e.jsx(ka,{ref:t,className:y("text-lg font-semibold leading-none tracking-tight",s),...a}));fe.displayName=ka.displayName;const Re=m.forwardRef(({className:s,...a},t)=>e.jsx(Ta,{ref:t,className:y("text-sm text-muted-foreground",s),...a}));Re.displayName=Ta.displayName;const yt=tt("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),K=m.forwardRef(({className:s,variant:a,size:t,asChild:l=!1,...n},r)=>{const o=l?mn:"button";return e.jsx(o,{className:y(yt({variant:a,size:t,className:s})),ref:r,...n})});K.displayName="Button";const Es=so,Is=to,Vd=ao,Fd=m.forwardRef(({className:s,inset:a,children:t,...l},n)=>e.jsxs(bl,{ref:n,className:y("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",s),...l,children:[t,e.jsx(pn,{className:"ml-auto h-4 w-4"})]}));Fd.displayName=bl.displayName;const Md=m.forwardRef(({className:s,...a},t)=>e.jsx(yl,{ref:t,className:y("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));Md.displayName=yl.displayName;const ws=m.forwardRef(({className:s,sideOffset:a=4,...t},l)=>e.jsx(Zi,{children:e.jsx(Nl,{ref:l,sideOffset:a,className:y("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));ws.displayName=Nl.displayName;const _e=m.forwardRef(({className:s,inset:a,...t},l)=>e.jsx(_l,{ref:l,className:y("relative flex cursor-default cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...t}));_e.displayName=_l.displayName;const Od=m.forwardRef(({className:s,children:a,checked:t,...l},n)=>e.jsxs(wl,{ref:n,className:y("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...l,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Cl,{children:e.jsx(at,{className:"h-4 w-4"})})}),a]}));Od.displayName=wl.displayName;const zd=m.forwardRef(({className:s,children:a,...t},l)=>e.jsxs(Sl,{ref:l,className:y("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Cl,{children:e.jsx(eo,{className:"h-4 w-4 fill-current"})})}),a]}));zd.displayName=Sl.displayName;const yn=m.forwardRef(({className:s,inset:a,...t},l)=>e.jsx(kl,{ref:l,className:y("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));yn.displayName=kl.displayName;const Nt=m.forwardRef(({className:s,...a},t)=>e.jsx(Tl,{ref:t,className:y("-mx-1 my-1 h-px bg-muted",s),...a}));Nt.displayName=Tl.displayName;const cn=({className:s,...a})=>e.jsx("span",{className:y("ml-auto text-xs tracking-widest opacity-60",s),...a});cn.displayName="DropdownMenuShortcut";const Wa=[{code:"en-US",name:"English",flag:no,shortName:"EN"},{code:"zh-CN",name:"中文",flag:lo,shortName:"CN"},{code:"ko-KR",name:"한국어",flag:ro,shortName:"KR"}];function Cr(){const{i18n:s}=V(),a=n=>{s.changeLanguage(n)},t=Wa.find(n=>n.code===s.language)||Wa[1],l=t.flag;return e.jsxs(Es,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(K,{variant:"ghost",size:"sm",className:"h-8 px-2 gap-1",children:[e.jsx(l,{className:"h-4 w-5 rounded-sm shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:t.shortName})]})}),e.jsx(ws,{align:"end",className:"w-[120px]",children:Wa.map(n=>{const r=n.flag,o=n.code===s.language;return e.jsxs(_e,{onClick:()=>a(n.code),className:y("flex items-center gap-2 px-2 py-1.5 cursor-pointer",o&&"bg-accent"),children:[e.jsx(r,{className:"h-4 w-5 rounded-sm shadow-sm"}),e.jsx("span",{className:y("text-sm",o&&"font-medium"),children:n.name})]},n.code)})})]})}function $d(){const[s,a]=m.useState(!1),{t}=V("auth"),l=t("signIn.resetPassword.command");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container relative flex min-h-svh flex-col items-center justify-center bg-primary-foreground px-4 py-8 lg:max-w-none lg:px-0",children:[e.jsx("div",{className:"absolute right-4 top-4 md:right-8 md:top-8",children:e.jsx(Cr,{})}),e.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px] md:w-[420px] lg:p-8",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold sm:text-3xl",children:window?.settings?.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:window?.settings?.description})]}),e.jsxs(Ye,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-left",children:[e.jsx("h1",{className:"text-xl font-semibold tracking-tight sm:text-2xl",children:t("signIn.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("signIn.description")})]}),e.jsx(Id,{onForgotPassword:()=>a(!0)})]})]})]}),e.jsx(ge,{open:s,onOpenChange:a,children:e.jsx(pe,{className:"max-w-[90vw] sm:max-w-lg",children:e.jsxs(ve,{children:[e.jsx(fe,{children:t("signIn.resetPassword.title")}),e.jsx(Re,{children:t("signIn.resetPassword.description")}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"max-w-full overflow-x-auto rounded-md bg-secondary p-4 pr-12 text-sm",children:l}),e.jsx(K,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 h-8 w-8 hover:bg-secondary-foreground/10",onClick:()=>ba(l).then(()=>{$.success(t("common:copy.success"))}),children:e.jsx(io,{className:"h-4 w-4"})})]})})]})})})]})}const Ad=Object.freeze(Object.defineProperty({__proto__:null,default:$d},Symbol.toStringTag,{value:"Module"})),Ve=m.forwardRef(({className:s,fadedBelow:a=!1,fixedHeight:t=!1,...l},n)=>e.jsx("div",{ref:n,className:y("relative flex h-full w-full flex-col",a&&"after:pointer-events-none after:absolute after:bottom-0 after:left-0 after:hidden after:h-32 after:w-full after:bg-[linear-gradient(180deg,_transparent_10%,_hsl(var(--background))_70%)] after:md:block",t&&"md:h-svh",s),...l}));Ve.displayName="Layout";const Fe=m.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:y("flex h-[var(--header-height)] flex-none items-center gap-4 bg-background p-4 md:px-8",s),...a}));Fe.displayName="LayoutHeader";const Ae=m.forwardRef(({className:s,fixedHeight:a,...t},l)=>e.jsx("div",{ref:l,className:y("flex-1 overflow-hidden px-4 py-6 md:px-8",a&&"h-[calc(100%-var(--header-height))]",s),...t}));Ae.displayName="LayoutBody";const Sr=oo,kr=co,Tr=mo,je=uo,de=xo,me=ho,oe=m.forwardRef(({className:s,sideOffset:a=4,...t},l)=>e.jsx(Dl,{ref:l,sideOffset:a,className:y("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));oe.displayName=Dl.displayName;function Ra(){const{pathname:s}=un();return{checkActiveNav:t=>{if(t==="/"&&s==="/")return!0;const l=t.replace(/^\//,""),n=s.replace(/^\//,"");return l?n.startsWith(l):!1}}}function Dr({key:s,defaultValue:a}){const[t,l]=m.useState(()=>{const n=localStorage.getItem(s);return n!==null?JSON.parse(n):a});return m.useEffect(()=>{localStorage.setItem(s,JSON.stringify(t))},[t,s]),[t,l]}function qd(){const[s,a]=Dr({key:"collapsed-sidebar-items",defaultValue:[]}),t=n=>!s.includes(n);return{isExpanded:t,toggleItem:n=>{t(n)?a([...s,n]):a(s.filter(r=>r!==n))}}}function Hd({links:s,isCollapsed:a,className:t,closeNav:l}){const{t:n}=V(),r=({sub:o,...c})=>{const u=`${n(c.title)}-${c.href}`;return a&&o?m.createElement(Bd,{...c,sub:o,key:u,closeNav:l}):a?m.createElement(Kd,{...c,key:u,closeNav:l}):o?m.createElement(Ud,{...c,sub:o,key:u,closeNav:l}):m.createElement(Pr,{...c,key:u,closeNav:l})};return e.jsx("div",{"data-collapsed":a,className:y("group border-b bg-background py-2 transition-[max-height,padding] duration-500 data-[collapsed=true]:py-2 md:border-none",t),children:e.jsx(je,{delayDuration:0,children:e.jsx("nav",{className:"grid gap-1 group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:s.map(r)})})})}function Pr({title:s,icon:a,label:t,href:l,closeNav:n,subLink:r=!1}){const{checkActiveNav:o}=Ra(),{t:c}=V();return e.jsxs(nt,{to:l,onClick:n,className:y(St({variant:o(l)?"secondary":"ghost",size:"sm"}),"h-12 justify-start text-wrap rounded-none px-6",r&&"h-10 w-full border-l border-l-slate-500 px-2"),"aria-current":o(l)?"page":void 0,children:[e.jsx("div",{className:"mr-2",children:a}),c(s),t&&e.jsx("div",{className:"ml-2 rounded-lg bg-primary px-1 text-[0.625rem] text-primary-foreground",children:c(t)})]})}function Ud({title:s,icon:a,label:t,sub:l,closeNav:n}){const{checkActiveNav:r}=Ra(),{isExpanded:o,toggleItem:c}=qd(),{t:u}=V(),i=!!l?.find(k=>r(k.href)),d=u(s),h=o(d)||i;return e.jsxs(Sr,{open:h,onOpenChange:()=>c(d),children:[e.jsxs(kr,{className:y(St({variant:i?"secondary":"ghost",size:"sm"}),"group h-12 w-full justify-start rounded-none px-6"),children:[e.jsx("div",{className:"mr-2",children:a}),u(s),t&&e.jsx("div",{className:"ml-2 rounded-lg bg-primary px-1 text-[0.625rem] text-primary-foreground",children:u(t)}),e.jsx("span",{className:y('ml-auto transition-all group-data-[state="open"]:-rotate-180'),children:e.jsx(Pl,{stroke:1})})]}),e.jsx(Tr,{className:"collapsibleDropdown",asChild:!0,children:e.jsx("ul",{children:l.map(k=>e.jsx("li",{className:"my-1 ml-8",children:e.jsx(Pr,{...k,subLink:!0,closeNav:n})},u(k.title)))})})]})}function Kd({title:s,icon:a,label:t,href:l,closeNav:n}){const{checkActiveNav:r}=Ra(),{t:o}=V();return e.jsxs(de,{delayDuration:0,children:[e.jsx(me,{asChild:!0,children:e.jsxs(nt,{to:l,onClick:n,className:y(St({variant:r(l)?"secondary":"ghost",size:"icon"}),"h-12 w-12"),children:[a,e.jsx("span",{className:"sr-only",children:o(s)})]})}),e.jsxs(oe,{side:"right",className:"flex items-center gap-4",children:[o(s),t&&e.jsx("span",{className:"ml-auto text-muted-foreground",children:o(t)})]})]})}function Bd({title:s,icon:a,label:t,sub:l,closeNav:n}){const{checkActiveNav:r}=Ra(),{t:o}=V(),c=!!l?.find(u=>r(u.href));return e.jsxs(Es,{children:[e.jsxs(de,{delayDuration:0,children:[e.jsx(me,{asChild:!0,children:e.jsx(Is,{asChild:!0,children:e.jsx(L,{variant:c?"secondary":"ghost",size:"icon",className:"h-12 w-12",children:a})})}),e.jsxs(oe,{side:"right",className:"flex items-center gap-4",children:[o(s)," ",t&&e.jsx("span",{className:"ml-auto text-muted-foreground",children:o(t)}),e.jsx(Pl,{size:18,className:"-rotate-90 text-muted-foreground"})]})]}),e.jsxs(ws,{side:"right",align:"start",sideOffset:4,children:[e.jsxs(yn,{children:[o(s)," ",t?`(${o(t)})`:""]}),e.jsx(Nt,{}),l.map(({title:u,icon:i,label:d,href:h})=>e.jsx(_e,{asChild:!0,children:e.jsxs(nt,{to:h,onClick:n,className:`${r(h)?"bg-secondary":""}`,children:[i," ",e.jsx("span",{className:"ml-2 max-w-52 text-wrap",children:o(u)}),d&&e.jsx("span",{className:"ml-auto text-xs",children:o(d)})]})},`${o(u)}-${h}`))]})]})}const Lr=[{title:"nav:dashboard",label:"",href:"/",icon:e.jsx(po,{size:18})},{title:"nav:systemManagement",label:"",href:"",icon:e.jsx(go,{size:18}),sub:[{title:"nav:systemConfig",label:"",href:"/config/system",icon:e.jsx(Ll,{size:18})},{title:"nav:pluginManagement",label:"",href:"/config/plugin",icon:e.jsx(gn,{size:18})},{title:"nav:themeConfig",label:"",href:"/config/theme",icon:e.jsx(fo,{size:18})},{title:"nav:noticeManagement",label:"",href:"/config/notice",icon:e.jsx(jo,{size:18})},{title:"nav:paymentConfig",label:"",href:"/config/payment",icon:e.jsx(Hn,{size:18})},{title:"nav:knowledgeManagement",label:"",href:"/config/knowledge",icon:e.jsx(vo,{size:18})}]},{title:"nav:nodeManagement",label:"",href:"",icon:e.jsx(El,{size:18}),sub:[{title:"nav:nodeManagement",label:"",href:"/server/manage",icon:e.jsx(bo,{size:18})},{title:"nav:permissionGroupManagement",label:"",href:"/server/group",icon:e.jsx(Il,{size:18})},{title:"nav:routeManagement",label:"",href:"/server/route",icon:e.jsx(yo,{size:18})}]},{title:"nav:subscriptionManagement",label:"",href:"",icon:e.jsx(No,{size:18}),sub:[{title:"nav:planManagement",label:"",href:"/finance/plan",icon:e.jsx(_o,{size:18})},{title:"nav:orderManagement",label:"",href:"/finance/order",icon:e.jsx(Hn,{size:18})},{title:"nav:couponManagement",label:"",href:"/finance/coupon",icon:e.jsx(wo,{size:18})}]},{title:"nav:userManagement",label:"",href:"",icon:e.jsx(Co,{size:18}),sub:[{title:"nav:userManagement",label:"",href:"/user/manage",icon:e.jsx(So,{size:18})},{title:"nav:ticketManagement",label:"",href:"/user/ticket",icon:e.jsx(Rl,{size:18})}]}];function Gd({className:s,isCollapsed:a,setIsCollapsed:t}){const[l,n]=m.useState(!1),{t:r}=V();return m.useEffect(()=>{l?document.body.classList.add("overflow-hidden"):document.body.classList.remove("overflow-hidden")},[l]),e.jsxs("aside",{className:y(`fixed left-0 right-0 top-0 z-50 flex h-auto flex-col border-r-2 border-r-muted transition-[width] md:bottom-0 md:right-auto md:h-svh ${a?"md:w-14":"md:w-64"}`,s),children:[e.jsx("div",{onClick:()=>n(!1),className:`absolute inset-0 transition-[opacity] delay-100 duration-700 ${l?"h-svh opacity-50":"h-0 opacity-0"} w-full bg-black md:hidden`}),e.jsxs(Ve,{className:`flex h-full flex-col  ${l?"h-[100vh] md:h-full":""}`,children:[e.jsxs(Fe,{className:"sticky top-0 justify-between px-4 py-3 shadow md:px-4",children:[e.jsxs("div",{className:`flex items-center ${a?"":"gap-2"}`,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",className:`transition-all ${a?"h-6 w-6":"h-8 w-8"}`,children:[e.jsx("rect",{width:"256",height:"256",fill:"none"}),e.jsx("line",{x1:"208",y1:"128",x2:"128",y2:"208",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),e.jsx("line",{x1:"192",y1:"40",x2:"40",y2:"192",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),e.jsx("span",{className:"sr-only",children:"Website Name"})]}),e.jsx("div",{className:`flex flex-col justify-end truncate ${a?"invisible w-0":"visible w-auto"}`,children:e.jsx("span",{className:"font-medium",children:window?.settings?.title})})]}),e.jsx(L,{variant:"ghost",size:"icon",className:"md:hidden","aria-label":r("common:toggleNavigation"),"aria-controls":"sidebar-menu","aria-expanded":l,onClick:()=>n(o=>!o),children:l?e.jsx(ko,{}):e.jsx(To,{})})]}),e.jsx(Hd,{id:"sidebar-menu",className:y("flex-1 overflow-auto overscroll-contain",l?"block":"hidden md:block","md:py-2"),closeNav:()=>n(!1),isCollapsed:a,links:Lr}),e.jsx("div",{className:y("border-t border-border/50 bg-background","px-4 py-2.5 text-xs text-muted-foreground",l?"block":"hidden md:block",a?"text-center":"text-left"),children:e.jsxs("div",{className:y("flex items-center gap-1.5",a?"justify-center":"justify-start"),children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),e.jsxs("span",{className:y("whitespace-nowrap tracking-wide","transition-opacity duration-200",a&&"md:opacity-0"),children:["v",window?.settings?.version]})]})}),e.jsx(L,{onClick:()=>t(o=>!o),size:"icon",variant:"outline",className:"absolute -right-5 top-1/2 hidden rounded-full md:inline-flex","aria-label":r("common:toggleSidebar"),children:e.jsx(Do,{stroke:1.5,className:`h-5 w-5 ${a?"rotate-180":""}`})})]})]})}function Wd(){const[s,a]=Dr({key:"collapsed-sidebar",defaultValue:!1});return m.useEffect(()=>{const t=()=>{a(window.innerWidth<768?!1:s)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[s,a]),[s,a]}function Yd(){const[s,a]=Wd();return e.jsxs("div",{className:"relative h-full overflow-hidden bg-background",children:[e.jsx(Gd,{isCollapsed:s,setIsCollapsed:a}),e.jsx("main",{id:"content",className:`overflow-x-hidden pt-16 transition-[margin] md:overflow-y-hidden md:pt-0 ${s?"md:ml-14":"md:ml-64"} h-full`,children:e.jsx(xn,{})})]})}const Jd=Object.freeze(Object.defineProperty({__proto__:null,default:Yd},Symbol.toStringTag,{value:"Module"})),Us=m.forwardRef(({className:s,...a},t)=>e.jsx(He,{ref:t,className:y("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...a}));Us.displayName=He.displayName;const Qd=({children:s,...a})=>e.jsx(ge,{...a,children:e.jsx(pe,{className:"overflow-hidden p-0",children:e.jsx(Us,{className:"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5",children:s})})}),it=m.forwardRef(({className:s,...a},t)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Po,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(He.Input,{ref:t,className:y("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...a})]}));it.displayName=He.Input.displayName;const Ks=m.forwardRef(({className:s,...a},t)=>e.jsx(He.List,{ref:t,className:y("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...a}));Ks.displayName=He.List.displayName;const ot=m.forwardRef((s,a)=>e.jsx(He.Empty,{ref:a,className:"py-6 text-center text-sm",...s}));ot.displayName=He.Empty.displayName;const ns=m.forwardRef(({className:s,...a},t)=>e.jsx(He.Group,{ref:t,className:y("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...a}));ns.displayName=He.Group.displayName;const Tt=m.forwardRef(({className:s,...a},t)=>e.jsx(He.Separator,{ref:t,className:y("-mx-1 h-px bg-border",s),...a}));Tt.displayName=He.Separator.displayName;const $e=m.forwardRef(({className:s,...a},t)=>e.jsx(He.Item,{ref:t,className:y("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a}));$e.displayName=He.Item.displayName;function Xd(){const s=[];for(const a of Lr)if(a.href&&s.push(a),a.sub)for(const t of a.sub)s.push({...t,parent:a.title});return s}function Xe(){const[s,a]=m.useState(!1),t=Rs(),l=Xd(),{t:n}=V("search"),{t:r}=V("nav");m.useEffect(()=>{const c=u=>{u.key==="k"&&(u.metaKey||u.ctrlKey)&&(u.preventDefault(),a(i=>!i))};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[]);const o=m.useCallback(c=>{a(!1),t(c)},[t]);return e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"outline",className:"relative h-9 w-9 p-0 xl:h-10 xl:w-60 xl:justify-start xl:px-3 xl:py-2",onClick:()=>a(!0),children:[e.jsx(fn,{className:"h-4 w-4 xl:mr-2"}),e.jsx("span",{className:"hidden xl:inline-flex",children:n("placeholder")}),e.jsx("span",{className:"sr-only",children:n("shortcut.label")}),e.jsx("kbd",{className:"pointer-events-none absolute right-1.5 top-2 hidden h-6 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 xl:flex",children:n("shortcut.key")})]}),e.jsxs(Qd,{open:s,onOpenChange:a,children:[e.jsx(it,{placeholder:n("placeholder")}),e.jsxs(Ks,{children:[e.jsx(ot,{children:n("noResults")}),e.jsx(ns,{heading:n("title"),children:l.map(c=>e.jsxs($e,{value:`${c.parent?c.parent+" ":""}${c.title}`,onSelect:()=>o(c.href),children:[e.jsx("div",{className:"mr-2",children:c.icon}),e.jsx("span",{children:r(c.title)}),c.parent&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:r(c.parent)})]},c.href))})]})]})]})}function Ue(){const{theme:s,setTheme:a}=sd();return m.useEffect(()=>{const t=s==="dark"?"#020817":"#fff",l=document.querySelector("meta[name='theme-color']");l&&l.setAttribute("content",t)},[s]),e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"icon",variant:"ghost",className:"rounded-full",onClick:()=>a(s==="light"?"dark":"light"),children:s==="light"?e.jsx(Lo,{size:20}):e.jsx(Eo,{size:20})}),e.jsx(Cr,{})]})}const Er=m.forwardRef(({className:s,...a},t)=>e.jsx(Vl,{ref:t,className:y("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));Er.displayName=Vl.displayName;const Ir=m.forwardRef(({className:s,...a},t)=>e.jsx(Fl,{ref:t,className:y("aspect-square h-full w-full",s),...a}));Ir.displayName=Fl.displayName;const Rr=m.forwardRef(({className:s,...a},t)=>e.jsx(Ml,{ref:t,className:y("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Rr.displayName=Ml.displayName;function Ke(){const s=Rs(),a=gl(),t=Io(Td),{t:l}=V(["common"]),n=()=>{fr(),a(kd()),s("/sign-in")},r=t?.email?.split("@")[0]||l("common:user"),o=r.substring(0,2).toUpperCase();return e.jsxs(Es,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(L,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:e.jsxs(Er,{className:"h-8 w-8",children:[e.jsx(Ir,{src:t?.avatar_url,alt:r}),e.jsx(Rr,{children:o})]})})}),e.jsxs(ws,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(yn,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:r}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t?.email||l("common:defaultEmail")})]})}),e.jsx(Nt,{}),e.jsx(_e,{asChild:!0,children:e.jsxs(nt,{to:"/config/system",children:[l("common:settings"),e.jsx(cn,{children:"⌘S"})]})}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:n,children:[l("common:logout"),e.jsx(cn,{children:"⇧⌘Q"})]})]})]})}const J=Ro,Be=qo,Q=Vo,W=m.forwardRef(({className:s,children:a,...t},l)=>e.jsxs(Ol,{ref:l,className:y("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[a,e.jsx(Fo,{asChild:!0,children:e.jsx(jn,{className:"h-4 w-4 opacity-50"})})]}));W.displayName=Ol.displayName;const Vr=m.forwardRef(({className:s,...a},t)=>e.jsx(zl,{ref:t,className:y("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Mo,{className:"h-4 w-4"})}));Vr.displayName=zl.displayName;const Fr=m.forwardRef(({className:s,...a},t)=>e.jsx($l,{ref:t,className:y("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(jn,{className:"h-4 w-4"})}));Fr.displayName=$l.displayName;const Y=m.forwardRef(({className:s,children:a,position:t="popper",...l},n)=>e.jsx(Oo,{children:e.jsxs(Al,{ref:n,className:y("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...l,children:[e.jsx(Vr,{}),e.jsx(zo,{className:y("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(Fr,{})]})}));Y.displayName=Al.displayName;const Zd=m.forwardRef(({className:s,...a},t)=>e.jsx(ql,{ref:t,className:y("px-2 py-1.5 text-sm font-semibold",s),...a}));Zd.displayName=ql.displayName;const A=m.forwardRef(({className:s,children:a,...t},l)=>e.jsxs(Hl,{ref:l,className:y("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx($o,{children:e.jsx(at,{className:"h-4 w-4"})})}),e.jsx(Ao,{children:a})]}));A.displayName=Hl.displayName;const em=m.forwardRef(({className:s,...a},t)=>e.jsx(Ul,{ref:t,className:y("-mx-1 my-1 h-px bg-muted",s),...a}));em.displayName=Ul.displayName;function ct({className:s,classNames:a,showOutsideDays:t=!0,...l}){return e.jsx(Ho,{showOutsideDays:t,className:y("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:y(yt({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:y("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",l.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:y(yt({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:({className:n,...r})=>e.jsx(Kl,{className:y("h-4 w-4",n),...r}),IconRight:({className:n,...r})=>e.jsx(pn,{className:y("h-4 w-4",n),...r})},...l})}ct.displayName="Calendar";const Cs=Ko,Ss=Bo,bs=m.forwardRef(({className:s,align:a="center",sideOffset:t=4,...l},n)=>e.jsx(Uo,{children:e.jsx(Bl,{ref:n,align:a,sideOffset:t,className:y("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})}));bs.displayName=Bl.displayName;const zs={income:{main:"hsl(var(--primary))",gradient:{start:"hsl(var(--primary))",end:"transparent"}},commission:{main:"hsl(var(--secondary))",gradient:{start:"hsl(var(--secondary))",end:"transparent"}}},Ot=s=>(s/100).toFixed(2),sm=({active:s,payload:a,label:t})=>{const{t:l}=V();return s&&a&&a.length?e.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-sm",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:t}),a.map((n,r)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"h-2 w-2 rounded-full",style:{backgroundColor:n.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[l(n.name),":"]}),e.jsx("span",{className:"font-medium",children:n.name.includes(l("dashboard:overview.amount"))?`¥${Ot(n.value)}`:l("dashboard:overview.transactions",{count:n.value})})]},r))]}):null},tm=[{value:"7d",label:"dashboard:overview.last7Days"},{value:"30d",label:"dashboard:overview.last30Days"},{value:"90d",label:"dashboard:overview.last90Days"},{value:"180d",label:"dashboard:overview.last180Days"},{value:"365d",label:"dashboard:overview.lastYear"},{value:"custom",label:"dashboard:overview.customRange"}],am=(s,a)=>{const t=new Date;if(s==="custom"&&a)return{startDate:a.from,endDate:a.to};let l;switch(s){case"7d":l=ps(t,7);break;case"30d":l=ps(t,30);break;case"90d":l=ps(t,90);break;case"180d":l=ps(t,180);break;case"365d":l=ps(t,365);break;default:l=ps(t,30)}return{startDate:l,endDate:t}};function nm(){const[s,a]=m.useState("amount"),[t,l]=m.useState("30d"),[n,r]=m.useState({from:ps(new Date,7),to:new Date}),{t:o}=V(),{startDate:c,endDate:u}=am(t,n),{data:i}=le({queryKey:["orderStat",{start_date:hs(c,"yyyy-MM-dd"),end_date:hs(u,"yyyy-MM-dd")}],queryFn:async()=>{const{data:d}=await ya.getOrderStat({start_date:hs(c,"yyyy-MM-dd"),end_date:hs(u,"yyyy-MM-dd")});return d},refetchInterval:3e4});return e.jsxs(Ye,{children:[e.jsx(ts,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ns,{children:o("dashboard:overview.title")}),e.jsxs(st,{children:[i?.summary.start_date," ",o("dashboard:overview.to")," ",i?.summary.end_date]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsxs(J,{value:t,onValueChange:d=>l(d),children:[e.jsx(W,{className:"w-[120px]",children:e.jsx(Q,{placeholder:o("dashboard:overview.selectTimeRange")})}),e.jsx(Y,{children:tm.map(d=>e.jsx(A,{value:d.value,children:o(d.label)},d.value))})]}),t==="custom"&&e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(K,{variant:"outline",className:y("min-w-0 justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n?.from?n.to?e.jsxs(e.Fragment,{children:[hs(n.from,"yyyy-MM-dd")," -"," ",hs(n.to,"yyyy-MM-dd")]}):hs(n.from,"yyyy-MM-dd"):o("dashboard:overview.selectDate")})]})}),e.jsx(bs,{className:"w-auto p-0",align:"end",children:e.jsx(ct,{mode:"range",defaultMonth:n?.from,selected:{from:n?.from,to:n?.to},onSelect:d=>{d?.from&&d?.to&&r({from:d.from,to:d.to})},numberOfMonths:2})})]})]}),e.jsx(Wt,{value:s,onValueChange:d=>a(d),children:e.jsxs(kt,{children:[e.jsx(es,{value:"amount",children:o("dashboard:overview.amount")}),e.jsx(es,{value:"count",children:o("dashboard:overview.count")})]})})]})]})}),e.jsxs(as,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o("dashboard:overview.totalIncome")}),e.jsxs("div",{className:"text-2xl font-bold",children:["¥",Ot(i?.summary?.paid_total||0)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o("dashboard:overview.totalTransactions",{count:i?.summary?.paid_count||0})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[o("dashboard:overview.avgOrderAmount")," ¥",Ot(i?.summary?.avg_paid_amount||0)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o("dashboard:overview.totalCommission")}),e.jsxs("div",{className:"text-2xl font-bold",children:["¥",Ot(i?.summary?.commission_total||0)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o("dashboard:overview.totalTransactions",{count:i?.summary?.commission_count||0})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[o("dashboard:overview.commissionRate")," ",i?.summary?.commission_rate.toFixed(2)||0,"%"]})]})]}),e.jsx("div",{className:"h-[400px] w-full",children:e.jsx(Go,{width:"100%",height:"100%",children:e.jsxs(Wo,{data:i?.list||[],margin:{top:20,right:20,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"incomeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:zs.income.gradient.start,stopOpacity:.2}),e.jsx("stop",{offset:"100%",stopColor:zs.income.gradient.end,stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"commissionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:zs.commission.gradient.start,stopOpacity:.2}),e.jsx("stop",{offset:"100%",stopColor:zs.commission.gradient.end,stopOpacity:.1})]})]}),e.jsx(Yo,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:d=>hs(new Date(d),"MM-dd",{locale:Zo})}),e.jsx(Jo,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:d=>s==="amount"?`¥${Ot(d)}`:o("dashboard:overview.transactions",{count:d})}),e.jsx(Qo,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))",opacity:.3}),e.jsx(Xo,{content:e.jsx(sm,{})}),s==="amount"?e.jsxs(e.Fragment,{children:[e.jsx(Un,{type:"monotone",dataKey:"paid_total",name:o("dashboard:overview.orderAmount"),stroke:zs.income.main,fill:"url(#incomeGradient)",strokeWidth:2}),e.jsx(Un,{type:"monotone",dataKey:"commission_total",name:o("dashboard:overview.commissionAmount"),stroke:zs.commission.main,fill:"url(#commissionGradient)",strokeWidth:2})]}):e.jsxs(e.Fragment,{children:[e.jsx(Kn,{dataKey:"paid_count",name:o("dashboard:overview.orderCount"),fill:zs.income.main,radius:[4,4,0,0],maxBarSize:40}),e.jsx(Kn,{dataKey:"commission_count",name:o("dashboard:overview.commissionCount"),fill:zs.commission.main,radius:[4,4,0,0],maxBarSize:40})]})]})})})]})]})}function he({className:s,...a}){return e.jsx("div",{className:y("animate-pulse rounded-md bg-primary/10",s),...a})}function lm(){return e.jsxs(Ye,{children:[e.jsxs(ts,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(he,{className:"h-4 w-[120px]"}),e.jsx(he,{className:"h-4 w-4"})]}),e.jsxs(as,{children:[e.jsx(he,{className:"h-8 w-[140px] mb-2"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(he,{className:"h-4 w-[100px]"})]})]})]})}function rm(){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:8}).map((s,a)=>e.jsx(lm,{},a))})}var ne=(s=>(s[s.PENDING=0]="PENDING",s[s.PROCESSING=1]="PROCESSING",s[s.CANCELLED=2]="CANCELLED",s[s.COMPLETED=3]="COMPLETED",s[s.DISCOUNTED=4]="DISCOUNTED",s))(ne||{});const Rt={0:"待支付",1:"开通中",2:"已取消",3:"已完成",4:"已折抵"},Vt={0:"yellow-500",1:"blue-500",2:"red-500",3:"green-500",4:"green-500"};var gs=(s=>(s[s.NEW=1]="NEW",s[s.RENEWAL=2]="RENEWAL",s[s.UPGRADE=3]="UPGRADE",s[s.RESET_FLOW=4]="RESET_FLOW",s))(gs||{}),ye=(s=>(s[s.PENDING=0]="PENDING",s[s.PROCESSING=1]="PROCESSING",s[s.VALID=2]="VALID",s[s.INVALID=3]="INVALID",s))(ye||{});const aa={0:"待确认",1:"发放中",2:"有效",3:"无效"},na={0:"yellow-500",1:"blue-500",2:"green-500",3:"red-500"};var Ie=(s=>(s.MONTH_PRICE="month_price",s.QUARTER_PRICE="quarter_price",s.HALF_YEAR_PRICE="half_year_price",s.YEAR_PRICE="year_price",s.TWO_YEAR_PRICE="two_year_price",s.THREE_YEAR_PRICE="three_year_price",s.ONETIME_PRICE="onetime_price",s.RESET_PRICE="reset_price",s))(Ie||{});const im={month_price:"月付",quarter_price:"季付",half_year_price:"半年付",year_price:"年付",two_year_price:"两年付",three_year_price:"三年付",onetime_price:"一次性",reset_price:"流量重置包"};var ie=(s=>(s.Shadowsocks="shadowsocks",s.Vmess="vmess",s.Trojan="trojan",s.Hysteria="hysteria",s.Vless="vless",s.Tuic="tuic",s.Socks="socks",s.Naive="naive",s.Http="http",s.Mieru="mieru",s.AnyTLS="anytls",s))(ie||{});const cs=[{type:"shadowsocks",label:"Shadowsocks"},{type:"vmess",label:"VMess"},{type:"trojan",label:"Trojan"},{type:"hysteria",label:"Hysteria"},{type:"vless",label:"VLess"},{type:"tuic",label:"TUIC"},{type:"socks",label:"SOCKS"},{type:"naive",label:"Naive"},{type:"http",label:"HTTP"},{type:"mieru",label:"Mieru"},{type:"anytls",label:"AnyTLS"}],Ge={shadowsocks:"#489851",vmess:"#CB3180",trojan:"#EBB749",hysteria:"#5684e6",vless:"#1a1a1a",tuic:"#00C853",socks:"#2196F3",naive:"#9C27B0",http:"#FF5722",mieru:"#4CAF50",anytls:"#7E57C2"};var Ze=(s=>(s[s.AMOUNT=1]="AMOUNT",s[s.PERCENTAGE=2]="PERCENTAGE",s))(Ze||{});const om={1:"按金额优惠",2:"按比例优惠"};var Hs=(s=>(s[s.OPENING=0]="OPENING",s[s.CLOSED=1]="CLOSED",s))(Hs||{}),qe=(s=>(s[s.LOW=0]="LOW",s[s.MIDDLE=1]="MIDDLE",s[s.HIGH=2]="HIGH",s))(qe||{}),Ht=(s=>(s.MONTH="monthly",s.QUARTER="quarterly",s.HALF_YEAR="half_yearly",s.YEAR="yearly",s.TWO_YEAR="two_yearly",s.THREE_YEAR="three_yearly",s.ONETIME="onetime",s.RESET="reset_traffic",s))(Ht||{});function $s({title:s,value:a,icon:t,trend:l,description:n,onClick:r,highlight:o,className:c}){return e.jsxs(Ye,{className:y("transition-colors",r&&"cursor-pointer hover:bg-muted/50",o&&"border-primary/50",c),onClick:r,children:[e.jsxs(ts,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ns,{className:"text-sm font-medium",children:s}),t]}),e.jsxs(as,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),l?e.jsxs("div",{className:"flex items-center pt-1",children:[e.jsx(nc,{className:y("h-4 w-4",l.isPositive?"text-emerald-500":"text-red-500")}),e.jsxs("span",{className:y("ml-1 text-xs",l.isPositive?"text-emerald-500":"text-red-500"),children:[l.isPositive?"+":"-",Math.abs(l.value),"%"]}),e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:l.label})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:n})]})]})}function cm({className:s}){const a=Rs(),{t}=V(),{data:l,isLoading:n}=le({queryKey:["dashboardStats"],queryFn:async()=>(await ya.getStatsData()).data,refetchInterval:1e3*60*5});if(n||!l)return e.jsx(rm,{});const r=()=>{const o=new URLSearchParams;o.set("commission_status",ye.PENDING.toString()),o.set("status",ne.COMPLETED.toString()),o.set("commission_balance","gt:0"),a(`/finance/order?${o.toString()}`)};return e.jsxs("div",{className:y("grid gap-4 md:grid-cols-2 lg:grid-cols-4",s),children:[e.jsx($s,{title:t("dashboard:stats.todayIncome"),value:Js(l.todayIncome),icon:e.jsx(ec,{className:"h-4 w-4 text-emerald-500"}),trend:{value:l.dayIncomeGrowth,label:t("dashboard:stats.vsYesterday"),isPositive:l.dayIncomeGrowth>0}}),e.jsx($s,{title:t("dashboard:stats.monthlyIncome"),value:Js(l.currentMonthIncome),icon:e.jsx(Gl,{className:"h-4 w-4 text-blue-500"}),trend:{value:l.monthIncomeGrowth,label:t("dashboard:stats.vsLastMonth"),isPositive:l.monthIncomeGrowth>0}}),e.jsx($s,{title:t("dashboard:stats.pendingTickets"),value:l.ticketPendingTotal,icon:e.jsx(sc,{className:y("h-4 w-4",l.ticketPendingTotal>0?"text-orange-500":"text-muted-foreground")}),description:l.ticketPendingTotal>0?t("dashboard:stats.hasPendingTickets"):t("dashboard:stats.noPendingTickets"),onClick:()=>a("/user/ticket"),highlight:l.ticketPendingTotal>0}),e.jsx($s,{title:t("dashboard:stats.pendingCommission"),value:l.commissionPendingTotal,icon:e.jsx(tc,{className:y("h-4 w-4",l.commissionPendingTotal>0?"text-blue-500":"text-muted-foreground")}),description:l.commissionPendingTotal>0?t("dashboard:stats.hasPendingCommission"):t("dashboard:stats.noPendingCommission"),onClick:r,highlight:l.commissionPendingTotal>0}),e.jsx($s,{title:t("dashboard:stats.monthlyNewUsers"),value:l.currentMonthNewUsers,icon:e.jsx(pa,{className:"h-4 w-4 text-blue-500"}),trend:{value:l.userGrowth,label:t("dashboard:stats.vsLastMonth"),isPositive:l.userGrowth>0}}),e.jsx($s,{title:t("dashboard:stats.totalUsers"),value:l.totalUsers,icon:e.jsx(pa,{className:"h-4 w-4 text-muted-foreground"}),description:t("dashboard:stats.activeUsers",{count:l.activeUsers})}),e.jsx($s,{title:t("dashboard:stats.monthlyUpload"),value:Oe(l.monthTraffic.upload),icon:e.jsx(Kt,{className:"h-4 w-4 text-emerald-500"}),description:t("dashboard:stats.todayTraffic",{value:Oe(l.todayTraffic.upload)})}),e.jsx($s,{title:t("dashboard:stats.monthlyDownload"),value:Oe(l.monthTraffic.download),icon:e.jsx(ac,{className:"h-4 w-4 text-blue-500"}),description:t("dashboard:stats.todayTraffic",{value:Oe(l.todayTraffic.download)})})]})}const _t=m.forwardRef(({className:s,children:a,...t},l)=>e.jsxs(Wl,{ref:l,className:y("relative overflow-hidden",s),...t,children:[e.jsx(lc,{className:"h-full w-full rounded-[inherit]",children:a}),e.jsx(_a,{}),e.jsx(rc,{})]}));_t.displayName=Wl.displayName;const _a=m.forwardRef(({className:s,orientation:a="vertical",...t},l)=>e.jsx(Yl,{ref:l,orientation:a,className:y("flex touch-none select-none transition-colors",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(ic,{className:"relative flex-1 rounded-full bg-border"})}));_a.displayName=Yl.displayName;const dn={today:{getValue:()=>{const s=cc();return{start:s,end:dc(s,1)}}},last7days:{getValue:()=>{const s=new Date;return{start:ps(s,7),end:s}}},last30days:{getValue:()=>{const s=new Date;return{start:ps(s,30),end:s}}},custom:{getValue:()=>null}};function tl({selectedRange:s,customDateRange:a,onRangeChange:t,onCustomRangeChange:l}){const{t:n}=V(),r={today:n("dashboard:trafficRank.today"),last7days:n("dashboard:trafficRank.last7days"),last30days:n("dashboard:trafficRank.last30days"),custom:n("dashboard:trafficRank.customRange")};return e.jsxs("div",{className:"flex min-w-0 flex-wrap items-center gap-1",children:[e.jsxs(J,{value:s,onValueChange:t,children:[e.jsx(W,{className:"w-[120px]",children:e.jsx(Q,{placeholder:n("dashboard:trafficRank.selectTimeRange")})}),e.jsx(Y,{position:"popper",className:"z-50",children:Object.entries(dn).map(([o])=>e.jsx(A,{value:o,children:r[o]},o))})]}),s==="custom"&&e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(K,{variant:"outline",className:y("min-w-0 justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:a?.from?a.to?e.jsxs(e.Fragment,{children:[hs(a.from,"yyyy-MM-dd")," -"," ",hs(a.to,"yyyy-MM-dd")]}):hs(a.from,"yyyy-MM-dd"):e.jsx("span",{children:n("dashboard:trafficRank.selectDateRange")})})]})}),e.jsx(bs,{className:"w-auto p-0",align:"end",children:e.jsx(ct,{mode:"range",defaultMonth:a?.from,selected:{from:a?.from,to:a?.to},onSelect:o=>{o?.from&&o?.to&&l({from:o.from,to:o.to})},numberOfMonths:2})})]})]})}const ht=s=>`${(s/1024/1024/1024).toFixed(2)} GB`;function dm({className:s}){const{t:a}=V(),[t,l]=m.useState("today"),[n,r]=m.useState({from:ps(new Date,7),to:new Date}),[o,c]=m.useState("today"),[u,i]=m.useState({from:ps(new Date,7),to:new Date}),d=m.useMemo(()=>t==="custom"?{start:n.from,end:n.to}:dn[t].getValue(),[t,n]),h=m.useMemo(()=>o==="custom"?{start:u.from,end:u.to}:dn[o].getValue(),[o,u]),{data:k}=le({queryKey:["nodeTrafficRank",d.start,d.end],queryFn:()=>ya.getNodeTrafficData({type:"node",start_time:ke.round(d.start.getTime()/1e3),end_time:ke.round(d.end.getTime()/1e3)}),refetchInterval:3e4}),{data:C}=le({queryKey:["userTrafficRank",h.start,h.end],queryFn:()=>ya.getNodeTrafficData({type:"user",start_time:ke.round(h.start.getTime()/1e3),end_time:ke.round(h.end.getTime()/1e3)}),refetchInterval:3e4});return e.jsxs("div",{className:y("grid gap-4 md:grid-cols-2",s),children:[e.jsxs(Ye,{children:[e.jsx(ts,{className:"flex-none pb-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(Ns,{className:"flex items-center text-base font-medium",children:[e.jsx(oc,{className:"mr-2 h-4 w-4"}),a("dashboard:trafficRank.nodeTrafficRank")]}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx(tl,{selectedRange:t,customDateRange:n,onRangeChange:l,onCustomRangeChange:r}),e.jsx(Bn,{className:"h-4 w-4 flex-shrink-0 text-muted-foreground"})]})]})}),e.jsx(as,{className:"flex-1",children:k?.data?e.jsxs(_t,{className:"h-[400px] pr-4",children:[e.jsx("div",{className:"space-y-3",children:k.data.map(S=>e.jsx(je,{delayDuration:200,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx("div",{className:"flex cursor-pointer items-center justify-between space-x-2 rounded-lg bg-muted/50 p-2 transition-colors hover:bg-muted/70",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate text-sm font-medium",children:S.name}),e.jsxs("span",{className:y("ml-2 flex items-center text-xs font-medium",S.change>=0?"text-green-600":"text-red-600"),children:[S.change>=0?e.jsx(tn,{className:"mr-1 h-3 w-3"}):e.jsx(an,{className:"mr-1 h-3 w-3"}),Math.abs(S.change),"%"]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 flex-1 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${S.value/k.data[0].value*100}%`}})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:ht(S.value)})]})]})})}),e.jsx(oe,{side:"right",className:"space-y-2 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[a("dashboard:trafficRank.currentTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:ht(S.value)}),e.jsxs("span",{className:"text-muted-foreground",children:[a("dashboard:trafficRank.previousTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:ht(S.previousValue)}),e.jsxs("span",{className:"text-muted-foreground",children:[a("dashboard:trafficRank.changeRate"),"："]}),e.jsxs("span",{className:y("font-medium",S.change>=0?"text-green-600":"text-red-600"),children:[S.change>=0?"+":"",S.change,"%"]})]})})]})},S.id))}),e.jsx(_a,{orientation:"vertical"})]}):e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:a("common:loading")})})})]}),e.jsxs(Ye,{children:[e.jsx(ts,{className:"flex-none pb-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(Ns,{className:"flex items-center text-base font-medium",children:[e.jsx(pa,{className:"mr-2 h-4 w-4"}),a("dashboard:trafficRank.userTrafficRank")]}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx(tl,{selectedRange:o,customDateRange:u,onRangeChange:c,onCustomRangeChange:i}),e.jsx(Bn,{className:"h-4 w-4 flex-shrink-0 text-muted-foreground"})]})]})}),e.jsx(as,{className:"flex-1",children:C?.data?e.jsxs(_t,{className:"h-[400px] pr-4",children:[e.jsx("div",{className:"space-y-3",children:C.data.map(S=>e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx("div",{className:"flex cursor-pointer items-center justify-between space-x-2 rounded-lg bg-muted/50 p-2 transition-colors hover:bg-muted/70",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate text-sm font-medium",children:S.name}),e.jsxs("span",{className:y("ml-2 flex items-center text-xs font-medium",S.change>=0?"text-green-600":"text-red-600"),children:[S.change>=0?e.jsx(tn,{className:"mr-1 h-3 w-3"}):e.jsx(an,{className:"mr-1 h-3 w-3"}),Math.abs(S.change),"%"]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 flex-1 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${S.value/C.data[0].value*100}%`}})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:ht(S.value)})]})]})})}),e.jsx(oe,{side:"right",className:"space-y-2 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[a("dashboard:trafficRank.currentTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:ht(S.value)}),e.jsxs("span",{className:"text-muted-foreground",children:[a("dashboard:trafficRank.previousTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:ht(S.previousValue)}),e.jsxs("span",{className:"text-muted-foreground",children:[a("dashboard:trafficRank.changeRate"),"："]}),e.jsxs("span",{className:y("font-medium",S.change>=0?"text-green-600":"text-red-600"),children:[S.change>=0?"+":"",S.change,"%"]})]})})]})},S.id))}),e.jsx(_a,{orientation:"vertical"})]}):e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:a("common:loading")})})})]})]})}const mm=tt("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/10",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function G({className:s,variant:a,...t}){return e.jsx("div",{className:y(mm({variant:a}),s),...t})}const ma=m.forwardRef(({className:s,value:a,...t},l)=>e.jsx(Jl,{ref:l,className:y("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...t,children:e.jsx(mc,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));ma.displayName=Jl.displayName;const Nn=m.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:y("w-full caption-bottom text-sm",s),...a})}));Nn.displayName="Table";const _n=m.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:y("[&_tr]:border-b",s),...a}));_n.displayName="TableHeader";const wn=m.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:y("[&_tr:last-child]:border-0",s),...a}));wn.displayName="TableBody";const um=m.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:y("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));um.displayName="TableFooter";const As=m.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:y("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));As.displayName="TableRow";const Cn=m.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:y("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Cn.displayName="TableHead";const vt=m.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:y("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));vt.displayName="TableCell";const xm=m.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:y("mt-4 text-sm text-muted-foreground",s),...a}));xm.displayName="TableCaption";function Sn({table:s}){const[a,t]=m.useState(""),{t:l}=V("common");m.useEffect(()=>{t((s.getState().pagination.pageIndex+1).toString())},[s.getState().pagination.pageIndex]);const n=r=>{const o=parseInt(r);!isNaN(o)&&o>=1&&o<=s.getPageCount()?s.setPageIndex(o-1):t((s.getState().pagination.pageIndex+1).toString())};return e.jsxs("div",{className:"flex flex-col-reverse gap-4 px-2 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex-1 text-sm text-muted-foreground",children:l("table.pagination.selected",{selected:s.getFilteredSelectedRowModel().rows.length,total:s.getFilteredRowModel().rows.length})}),e.jsxs("div",{className:"flex flex-col-reverse items-center gap-4 sm:flex-row sm:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:l("table.pagination.itemsPerPage")}),e.jsxs(J,{value:`${s.getState().pagination.pageSize}`,onValueChange:r=>{s.setPageSize(Number(r))},children:[e.jsx(W,{className:"h-8 w-[70px]",children:e.jsx(Q,{placeholder:s.getState().pagination.pageSize})}),e.jsx(Y,{side:"top",children:[10,20,30,40,50,100,500].map(r=>e.jsx(A,{value:`${r}`,children:r},r))})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm font-medium",children:[e.jsx("span",{children:l("table.pagination.page")}),e.jsx(D,{type:"text",value:a,onChange:r=>t(r.target.value),onBlur:r=>n(r.target.value),onKeyDown:r=>{r.key==="Enter"&&n(r.currentTarget.value)},className:"h-8 w-[50px] text-center"}),e.jsx("span",{children:l("table.pagination.pageOf",{total:s.getPageCount()})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(L,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.firstPage")}),e.jsx(uc,{className:"h-4 w-4"})]}),e.jsxs(L,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.previousPage")}),e.jsx(Kl,{className:"h-4 w-4"})]}),e.jsxs(L,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.nextPage")}),e.jsx(pn,{className:"h-4 w-4"})]}),e.jsxs(L,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.lastPage")}),e.jsx(xc,{className:"h-4 w-4"})]})]})]})]})}function os({table:s,toolbar:a,draggable:t=!1,onDragStart:l,onDragEnd:n,onDragOver:r,onDragLeave:o,onDrop:c,showPagination:u=!0,isLoading:i=!1}){const{t:d}=V("common"),h=m.useRef(null),k=s.getAllColumns().filter(N=>N.getIsPinned()==="left"),C=s.getAllColumns().filter(N=>N.getIsPinned()==="right"),S=N=>k.slice(0,N).reduce((g,T)=>g+(T.getSize()??0),0),w=N=>C.slice(N+1).reduce((g,T)=>g+(T.getSize()??0),0);return e.jsxs("div",{className:"space-y-4",children:[typeof a=="function"?a(s):a,e.jsx("div",{ref:h,className:"relative overflow-auto rounded-md border bg-card",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs(Nn,{children:[e.jsx(_n,{children:s.getHeaderGroups().map(N=>e.jsx(As,{className:"hover:bg-transparent",children:N.headers.map((g,T)=>{const E=g.column.getIsPinned()==="left",p=g.column.getIsPinned()==="right",_=E?S(k.indexOf(g.column)):void 0,I=p?w(C.indexOf(g.column)):void 0;return e.jsx(Cn,{colSpan:g.colSpan,style:{width:g.getSize(),...E&&{left:_},...p&&{right:I}},className:y("h-11 bg-card px-4 text-muted-foreground",(E||p)&&["sticky z-20","before:absolute before:bottom-0 before:top-0 before:w-[1px] before:bg-border",E&&"before:right-0",p&&"before:left-0"]),children:g.isPlaceholder?null:ga(g.column.columnDef.header,g.getContext())},g.id)})},N.id))}),e.jsx(wn,{children:s.getRowModel().rows?.length?s.getRowModel().rows.map((N,g)=>e.jsx(As,{"data-state":N.getIsSelected()&&"selected",className:"hover:bg-muted/50",draggable:t,onDragStart:T=>l?.(T,g),onDragEnd:n,onDragOver:r,onDragLeave:o,onDrop:T=>c?.(T,g),children:N.getVisibleCells().map((T,E)=>{const p=T.column.getIsPinned()==="left",_=T.column.getIsPinned()==="right",I=p?S(k.indexOf(T.column)):void 0,H=_?w(C.indexOf(T.column)):void 0;return e.jsx(vt,{style:{width:T.column.getSize(),...p&&{left:I},..._&&{right:H}},className:y("bg-card",(p||_)&&["sticky z-20","before:absolute before:bottom-0 before:top-0 before:w-[1px] before:bg-border",p&&"before:right-0",_&&"before:left-0"]),children:ga(T.column.columnDef.cell,T.getContext())},T.id)})},N.id)):e.jsx(As,{children:e.jsx(vt,{colSpan:s.getAllColumns().length,className:"h-24 text-center",children:d("table.noData")})})})]})})}),u&&e.jsx(Sn,{table:s})]})}const ua=s=>{if(!s)return"";let a;if(typeof s=="string"){if(a=parseInt(s),isNaN(a))return s}else a=s;return(a.toString().length===10?new Date(a*1e3):new Date(a)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},Ft=Ql(),Mt=Ql();function la({data:s,isLoading:a,searchKeyword:t,selectedLevel:l,total:n,currentPage:r,pageSize:o,onViewDetail:c,onPageChange:u}){const{t:i}=V(),d=C=>{switch(C.toLowerCase()){case"info":return e.jsx($t,{className:"h-4 w-4 text-blue-500"});case"warning":return e.jsx(da,{className:"h-4 w-4 text-yellow-500"});case"error":return e.jsx(ln,{className:"h-4 w-4 text-red-500"});default:return e.jsx($t,{className:"h-4 w-4 text-slate-500"})}},h=m.useMemo(()=>[Ft.accessor("level",{id:"level",header:()=>i("dashboard:systemLog.level","级别"),size:80,cell:({getValue:C,row:S})=>{const w=C();return e.jsxs("div",{className:"flex items-center gap-1",children:[d(w),e.jsx("span",{className:y(w.toLowerCase()==="error"&&"text-red-600",w.toLowerCase()==="warning"&&"text-yellow-600",w.toLowerCase()==="info"&&"text-blue-600"),children:w})]})}}),Ft.accessor("created_at",{id:"created_at",header:()=>i("dashboard:systemLog.time","时间"),size:160,cell:({getValue:C})=>ua(C())}),Ft.accessor(C=>C.title||C.message||"",{id:"title",header:()=>i("dashboard:systemLog.logTitle","标题"),cell:({getValue:C})=>e.jsx("span",{className:"inline-block max-w-[300px] truncate",children:C()})}),Ft.accessor("method",{id:"method",header:()=>i("dashboard:systemLog.method","请求方法"),size:100,cell:({getValue:C})=>{const S=C();return S?e.jsx(G,{variant:"outline",className:y(S==="GET"&&"border-blue-200 bg-blue-50 text-blue-700",S==="POST"&&"border-green-200 bg-green-50 text-green-700",S==="PUT"&&"border-amber-200 bg-amber-50 text-amber-700",S==="DELETE"&&"border-red-200 bg-red-50 text-red-700"),children:S}):null}}),Ft.display({id:"actions",header:()=>i("dashboard:systemLog.action","操作"),size:80,cell:({row:C})=>e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>c(C.original),"aria-label":i("dashboard:systemLog.viewDetail","查看详情"),children:e.jsx(nn,{className:"h-4 w-4"})})})],[i,c]),k=Je({data:s,columns:h,getCoreRowModel:Qe(),getPaginationRowModel:rs(),pageCount:Math.ceil(n/o),manualPagination:!0,state:{pagination:{pageIndex:r-1,pageSize:o}},onPaginationChange:C=>{if(typeof C=="function"){const S=C({pageIndex:r-1,pageSize:o});u(S.pageIndex+1)}else u(C.pageIndex+1)}});return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx(os,{table:k,showPagination:!1,isLoading:a}),e.jsx(Sn,{table:k}),(t||l&&l!=="all")&&e.jsx("div",{className:"text-center text-sm text-muted-foreground",children:t&&l&&l!=="all"?`筛选结果: 包含"${t}"且级别为"${l}"的日志共 ${n} 条`:t?`搜索结果: 包含"${t}"的日志共 ${n} 条`:`筛选结果: 级别为"${l}"的日志共 ${n} 条`})]})}function hm(){const{t:s}=V(),[a,t]=m.useState(0),[l,n]=m.useState(!1),[r,o]=m.useState(1),[c]=m.useState(10),[u,i]=m.useState(null),[d,h]=m.useState(!1),[k,C]=m.useState(!1),[S,w]=m.useState(1),[N]=m.useState(10),[g,T]=m.useState(null),[E,p]=m.useState(!1),[_,I]=m.useState(""),[H,O]=m.useState(""),[B,ue]=m.useState("all"),[ee,te]=m.useState(!1),[q,R]=m.useState(30),[X,ms]=m.useState("all"),[Te,re]=m.useState(1e3),[us,Ts]=m.useState(!1),[Bs,Dt]=m.useState(null),[Yt,Pt]=m.useState(!1);m.useEffect(()=>{const U=setTimeout(()=>{O(_),_!==H&&w(1)},500);return()=>clearTimeout(U)},[_]);const{data:Ms,isLoading:Ha,refetch:se,isRefetching:xe}=le({queryKey:["systemStatus",a],queryFn:async()=>(await ce.getSystemStatus()).data,refetchInterval:3e4}),{data:ae,isLoading:Gs,refetch:sp,isRefetching:Fn}=le({queryKey:["queueStats",a],queryFn:async()=>(await ce.getQueueStats()).data,refetchInterval:3e4}),{data:Mn,isLoading:ui,refetch:xi}=le({queryKey:["failedJobs",r,c],queryFn:async()=>{const U=await ce.getHorizonFailedJobs({current:r,page_size:c});return{data:U.data,total:U.total||0}},enabled:l}),{data:On,isLoading:Jt,refetch:hi}=le({queryKey:["systemLogs",S,N,B,H],queryFn:async()=>{const U={current:S,page_size:N};B&&B!=="all"&&(U.level=B),H.trim()&&(U.keyword=H.trim());const Os=await ce.getSystemLog(U);return{data:Os.data,total:Os.total||0}},enabled:k}),zn=Mn?.data||[],pi=Mn?.total||0,Qt=On?.data||[],Xt=On?.total||0,gi=m.useMemo(()=>[Mt.display({id:"failed_at",header:()=>s("dashboard:queue.details.time","时间"),cell:({row:U})=>ua(U.original.failed_at)}),Mt.display({id:"queue",header:()=>s("dashboard:queue.details.queue","队列"),cell:({row:U})=>U.original.queue}),Mt.display({id:"name",header:()=>s("dashboard:queue.details.name","任务名称"),cell:({row:U})=>e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx("span",{className:"inline-block max-w-[150px] truncate",children:U.original.name})}),e.jsx(oe,{children:e.jsx("span",{children:U.original.name})})]})})}),Mt.display({id:"exception",header:()=>s("dashboard:queue.details.exception","异常信息"),cell:({row:U})=>e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx("span",{className:"inline-block max-w-[200px] truncate",children:U.original.exception.split(`
`)[0]})}),e.jsx(oe,{className:"max-w-[300px] whitespace-pre-wrap",children:e.jsx("span",{children:U.original.exception})})]})})}),Mt.display({id:"actions",header:()=>s("dashboard:queue.details.action","操作"),size:80,cell:({row:U})=>e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>bi(U.original),"aria-label":s("dashboard:queue.details.viewDetail","查看详情"),children:e.jsx(nn,{className:"h-4 w-4"})})})],[s]),$n=Je({data:zn,columns:gi,getCoreRowModel:Qe(),getPaginationRowModel:rs(),pageCount:Math.ceil(pi/c),manualPagination:!0,state:{pagination:{pageIndex:r-1,pageSize:c}},onPaginationChange:U=>{if(typeof U=="function"){const Os=U({pageIndex:r-1,pageSize:c});An(Os.pageIndex+1)}else An(U.pageIndex+1)}}),fi=()=>{t(U=>U+1)},An=U=>{o(U)},Zt=U=>{w(U)},ji=U=>{ue(U),w(1)},vi=()=>{I(""),O(""),ue("all"),w(1)},ea=U=>{T(U),p(!0)},bi=U=>{i(U),h(!0)},yi=async()=>{try{const U=await ce.getLogClearStats({days:q,level:X==="all"?void 0:X});Dt(U.data),Pt(!0)}catch(U){console.error("获取清理统计失败:",U),$.error("获取清理统计失败")}},Ni=async()=>{Ts(!0);try{const U=await ce.clearSystemLog({days:q,level:X==="all"?void 0:X,limit:Te});U.data.status==="success"?($.success(`清理完成！已清理 ${U.data.cleared_count} 条日志`),te(!1),Pt(!1),Dt(null),se()):$.error(U.data.message||"清理失败")}catch(U){console.error("清理日志失败:",U),$.error("清理日志失败")}finally{Ts(!1)}};if(Ha||Gs)return e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx(fa,{className:"h-6 w-6 animate-spin"})});const _i=U=>U?e.jsx(Xl,{className:"h-5 w-5 text-green-500"}):e.jsx(Zl,{className:"h-5 w-5 text-red-500"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Ye,{children:[e.jsxs(ts,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Ns,{className:"flex items-center gap-2",children:[e.jsx(hc,{className:"h-5 w-5"}),s("dashboard:queue.title")]}),e.jsx(st,{children:s("dashboard:queue.status.description")})]}),e.jsx(K,{variant:"outline",size:"icon",onClick:fi,disabled:xe||Fn,children:e.jsx(Ua,{className:y("h-4 w-4",(xe||Fn)&&"animate-spin")})})]}),e.jsx(as,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_i(ae?.status||!1),e.jsx("span",{className:"font-medium",children:s("dashboard:queue.status.running")})]}),e.jsx(G,{variant:ae?.status?"secondary":"destructive",children:ae?.status?s("dashboard:queue.status.normal"):s("dashboard:queue.status.abnormal")})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.status.waitTime",{seconds:ae?.wait?.default||0})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.recentJobs")}),e.jsx("p",{className:"text-2xl font-bold",children:ae?.recentJobs||0}),e.jsx(ma,{value:(ae?.recentJobs||0)/(ae?.periods?.recentJobs||1)*100,className:"h-1"})]})}),e.jsx(oe,{children:e.jsx("p",{children:s("dashboard:queue.details.statisticsPeriod",{hours:ae?.periods?.recentJobs||0})})})]})}),e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.jobsPerMinute")}),e.jsx("p",{className:"text-2xl font-bold",children:ae?.jobsPerMinute||0}),e.jsx(ma,{value:(ae?.jobsPerMinute||0)/(ae?.queueWithMaxThroughput?.throughput||1)*100,className:"h-1"})]})}),e.jsx(oe,{children:e.jsx("p",{children:s("dashboard:queue.details.maxThroughput",{value:ae?.queueWithMaxThroughput?.throughput||0})})})]})})]})]})})]}),e.jsxs(Ye,{children:[e.jsxs(ts,{children:[e.jsxs(Ns,{className:"flex items-center gap-2",children:[e.jsx(pc,{className:"h-5 w-5"}),s("dashboard:queue.jobDetails")]}),e.jsx(st,{children:s("dashboard:queue.details.description")})]}),e.jsx(as,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.failedJobs7Days")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"cursor-pointer text-2xl font-bold text-destructive hover:underline",title:s("dashboard:queue.details.viewFailedJobs"),onClick:()=>n(!0),style:{userSelect:"none"},children:ae?.failedJobs||0}),e.jsx(nn,{className:"h-4 w-4 cursor-pointer text-muted-foreground hover:text-destructive",onClick:()=>n(!0),"aria-label":s("dashboard:queue.details.viewFailedJobs")})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("dashboard:queue.details.retentionPeriod",{hours:ae?.periods?.failedJobs||0})})]}),e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.longestRunningQueue")}),e.jsxs("p",{className:"text-2xl font-bold",children:[ae?.queueWithMaxRuntime?.runtime||0,"s"]}),e.jsx("div",{className:"truncate text-xs text-muted-foreground",children:ae?.queueWithMaxRuntime?.name||"N/A"})]})]}),e.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.activeProcesses")}),e.jsxs("span",{className:"font-medium",children:[ae?.processes||0," /"," ",(ae?.processes||0)+(ae?.pausedMasters||0)]})]}),e.jsx(ma,{value:(ae?.processes||0)/((ae?.processes||0)+(ae?.pausedMasters||0))*100,className:"mt-2 h-1"})]})]})})]})]}),e.jsxs(Ye,{children:[e.jsxs(ts,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Ns,{className:"flex items-center gap-2",children:[e.jsx(Gn,{className:"h-5 w-5"}),s("dashboard:systemLog.title","系统日志")]}),e.jsx(st,{children:s("dashboard:systemLog.description","查看系统运行日志记录")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{variant:"outline",onClick:()=>C(!0),children:s("dashboard:systemLog.viewAll","查看全部")}),e.jsxs(K,{variant:"outline",onClick:()=>te(!0),className:"text-destructive hover:text-destructive",children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),s("dashboard:systemLog.clearLogs","清理日志")]})]})]}),e.jsx(as,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2 rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-900 dark:bg-blue-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5 text-blue-500"}),e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300",children:s("dashboard:systemLog.tabs.info","信息")})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:Ms?.logs?.info||0})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border border-yellow-200 bg-yellow-50 p-3 dark:border-yellow-900 dark:bg-yellow-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(da,{className:"h-5 w-5 text-yellow-500"}),e.jsx("p",{className:"font-medium text-yellow-700 dark:text-yellow-300",children:s("dashboard:systemLog.tabs.warning","警告")})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:Ms?.logs?.warning||0})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-900 dark:bg-red-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ln,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300",children:s("dashboard:systemLog.tabs.error","错误")})]}),e.jsx("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:Ms?.logs?.error||0})]})]}),Ms?.logs&&Ms.logs.total>0&&e.jsxs("div",{className:"mt-3 text-center text-sm text-muted-foreground",children:[s("dashboard:systemLog.totalLogs","总日志数"),":"," ",Ms.logs.total]})]})})]}),e.jsx(ge,{open:l,onOpenChange:n,children:e.jsxs(pe,{className:"max-h-[90vh] max-w-4xl overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(fe,{children:s("dashboard:queue.details.failedJobsDetailTitle","失败任务详情")})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx(os,{table:$n,showPagination:!1,isLoading:ui}),e.jsx(Sn,{table:$n}),zn.length===0&&e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:s("dashboard:queue.details.noFailedJobs","暂无失败任务")})]}),e.jsxs(Le,{children:[e.jsxs(K,{variant:"outline",onClick:()=>xi(),children:[e.jsx(Ua,{className:"mr-2 h-4 w-4"}),s("dashboard:common.refresh","刷新")]}),e.jsx(qs,{asChild:!0,children:e.jsx(K,{variant:"outline",children:s("common.close","关闭")})})]})]})}),e.jsx(ge,{open:d,onOpenChange:h,children:e.jsxs(pe,{className:"max-h-[90vh] max-w-4xl overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(fe,{children:s("dashboard:queue.details.jobDetailTitle","任务详情")})}),u&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.id","任务ID")}),e.jsx("p",{className:"break-all rounded-md bg-muted/50 p-2 text-sm",children:u.id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.time","时间")}),e.jsx("p",{className:"rounded-md bg-muted/50 p-2 text-sm",children:u.failed_at})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.queue","队列")}),e.jsx("p",{className:"rounded-md bg-muted/50 p-2 text-sm",children:u.queue})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.connection","连接")}),e.jsx("p",{className:"rounded-md bg-muted/50 p-2 text-sm",children:u.connection})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.name","任务名称")}),e.jsx("p",{className:"break-all rounded-md bg-muted/50 p-2 text-sm",children:u.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.exception","异常信息")}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto rounded-md bg-red-50 p-3 dark:bg-red-950/30",children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs text-red-700 dark:text-red-300",children:u.exception})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:queue.details.payload","任务数据")}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto rounded-md bg-muted/50 p-3",children:e.jsx("pre",{className:"whitespace-pre-wrap break-all text-xs",children:(()=>{try{return JSON.stringify(JSON.parse(u.payload),null,2)}catch{return u.payload}})()})})]})]}),e.jsx(Le,{children:e.jsx(K,{variant:"outline",onClick:()=>h(!1),children:s("common.close","关闭")})})]})}),e.jsx(ge,{open:k,onOpenChange:C,children:e.jsxs(pe,{className:"max-h-[90vh] max-w-4xl overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(fe,{children:s("dashboard:systemLog.title","系统日志")})}),e.jsxs(Wt,{value:B,onValueChange:ji,className:"w-full overflow-x-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-2 p-1 md:flex-row md:items-center md:justify-between",children:[e.jsxs(kt,{className:"grid w-auto grid-cols-4",children:[e.jsxs(es,{value:"all",className:"flex items-center gap-2",children:[e.jsx(Gn,{className:"h-4 w-4"}),s("dashboard:systemLog.tabs.all","全部")]}),e.jsxs(es,{value:"info",className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-4 w-4 text-blue-500"}),s("dashboard:systemLog.tabs.info","信息")]}),e.jsxs(es,{value:"warning",className:"flex items-center gap-2",children:[e.jsx(da,{className:"h-4 w-4 text-yellow-500"}),s("dashboard:systemLog.tabs.warning","警告")]}),e.jsxs(es,{value:"error",className:"flex items-center gap-2",children:[e.jsx(ln,{className:"h-4 w-4 text-red-500"}),s("dashboard:systemLog.tabs.error","错误")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fn,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:s("dashboard:systemLog.search","搜索日志内容..."),value:_,onChange:U=>I(U.target.value),className:"w-full md:w-64"})]})]}),e.jsx(Ls,{value:"all",className:"mt-0",children:e.jsx(la,{data:Qt,isLoading:Jt,searchKeyword:H,selectedLevel:B,total:Xt,currentPage:S,pageSize:N,onViewDetail:ea,onPageChange:Zt})}),e.jsx(Ls,{value:"info",className:"mt-0 overflow-x-auto",children:e.jsx(la,{data:Qt,isLoading:Jt,searchKeyword:H,selectedLevel:B,total:Xt,currentPage:S,pageSize:N,onViewDetail:ea,onPageChange:Zt})}),e.jsx(Ls,{value:"warning",className:"mt-0",children:e.jsx(la,{data:Qt,isLoading:Jt,searchKeyword:H,selectedLevel:B,total:Xt,currentPage:S,pageSize:N,onViewDetail:ea,onPageChange:Zt})}),e.jsx(Ls,{value:"error",className:"mt-0",children:e.jsx(la,{data:Qt,isLoading:Jt,searchKeyword:H,selectedLevel:B,total:Xt,currentPage:S,pageSize:N,onViewDetail:ea,onPageChange:Zt})})]}),e.jsxs(Le,{children:[e.jsxs(K,{variant:"outline",onClick:()=>hi(),children:[e.jsx(Ua,{className:"mr-2 h-4 w-4"}),s("dashboard:common.refresh","刷新")]}),e.jsx(K,{variant:"outline",onClick:vi,children:s("dashboard:systemLog.filter.reset","重置筛选")}),e.jsx(qs,{asChild:!0,children:e.jsx(K,{variant:"outline",children:s("common.close","关闭")})})]})]})}),e.jsx(ge,{open:E,onOpenChange:p,children:e.jsxs(pe,{className:"max-h-[90vh] max-w-4xl overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(fe,{children:s("dashboard:systemLog.detailTitle","日志详情")})}),g&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.level","级别")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($t,{className:"h-4 w-4"}),e.jsx("p",{className:"font-medium",children:g.level})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.time","时间")}),e.jsx("p",{children:ua(g.created_at)||ua(g.updated_at)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.logTitle","标题")}),e.jsx("div",{className:"whitespace-pre-wrap rounded-md bg-muted/50 p-3",children:g.title||g.message||""})]}),(g.host||g.ip)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[g.host&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.host","主机")}),e.jsx("p",{className:"break-all rounded-md bg-muted/50 p-2 text-sm",children:g.host})]}),g.ip&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.ip","IP地址")}),e.jsx("p",{className:"rounded-md bg-muted/50 p-2 text-sm",children:g.ip})]})]}),g.uri&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.uri","URI")}),e.jsx("div",{className:"overflow-x-auto rounded-md bg-muted/50 p-3",children:e.jsx("code",{className:"text-sm",children:g.uri})})]}),g.method&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.method","请求方法")}),e.jsx("div",{children:e.jsx(G,{variant:"outline",className:"text-base font-medium",children:g.method})})]}),g.data&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.requestData","请求数据")}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto rounded-md bg-muted/50 p-3",children:e.jsx("pre",{className:"whitespace-pre-wrap break-all text-xs",children:(()=>{try{return JSON.stringify(JSON.parse(g.data),null,2)}catch{return g.data}})()})})]}),g.context&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:s("dashboard:systemLog.exception","异常信息")}),e.jsx("div",{className:"max-h-[250px] overflow-y-auto rounded-md bg-red-50 p-3 dark:bg-red-950/30",children:e.jsx("pre",{className:"whitespace-pre-wrap break-all text-xs text-red-700 dark:text-red-300",children:(()=>{try{const U=JSON.parse(g.context);if(U.exception){const Os=U.exception,wi=Os["\0*\0message"]||"",Ci=Os["\0*\0file"]||"",Si=Os["\0*\0line"]||"";return`${wi}

File: ${Ci}
Line: ${Si}`}return JSON.stringify(U,null,2)}catch{return g.context}})()})})]})]}),e.jsx(Le,{children:e.jsx(qs,{asChild:!0,children:e.jsx(K,{variant:"outline",children:s("common.close","关闭")})})})]})}),e.jsx(ge,{open:ee,onOpenChange:te,children:e.jsxs(pe,{className:"max-w-2xl",children:[e.jsx(ve,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-destructive"}),s("dashboard:systemLog.clearLogs","清理日志")]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Xs,{htmlFor:"clearDays",children:s("dashboard:systemLog.clearDays","清理天数")}),e.jsx(D,{id:"clearDays",type:"number",min:"1",max:"365",value:q,onChange:U=>R(parseInt(U.target.value)||30),placeholder:"30"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("dashboard:systemLog.clearDaysDesc","清理多少天前的日志 (1-365天)")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Xs,{htmlFor:"clearLevel",children:s("dashboard:systemLog.clearLevel","日志级别")}),e.jsxs(J,{value:X,onValueChange:ms,children:[e.jsx(W,{children:e.jsx(Q,{})}),e.jsxs(Y,{children:[e.jsx(A,{value:"all",children:s("dashboard:systemLog.tabs.all","全部")}),e.jsx(A,{value:"info",children:s("dashboard:systemLog.tabs.info","信息")}),e.jsx(A,{value:"warning",children:s("dashboard:systemLog.tabs.warning","警告")}),e.jsx(A,{value:"error",children:s("dashboard:systemLog.tabs.error","错误")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Xs,{htmlFor:"clearLimit",children:s("dashboard:systemLog.clearLimit","单次限制")}),e.jsx(D,{id:"clearLimit",type:"number",min:"100",max:"10000",value:Te,onChange:U=>re(parseInt(U.target.value)||1e3),placeholder:"1000"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("dashboard:systemLog.clearLimitDesc","单次清理数量限制 (100-10000条)")})]})]}),e.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4 dark:border-amber-900 dark:bg-amber-950/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gl,{className:"h-5 w-5 text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-800 dark:text-amber-200",children:s("dashboard:systemLog.clearPreview","清理预览")})]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:yi,disabled:us,children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),s("dashboard:systemLog.getStats","获取统计")]})]}),Yt&&Bs&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:systemLog.cutoffDate","截止日期")}),e.jsx("p",{className:"font-mono text-sm",children:Bs.cutoff_date})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:systemLog.totalLogs","总日志数")}),e.jsx("p",{className:"font-mono text-sm font-medium",children:Bs.total_logs.toLocaleString()})]})]}),e.jsxs("div",{className:"rounded-md bg-red-50 p-3 dark:bg-red-950/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(da,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:[s("dashboard:systemLog.willClear","将要清理"),"：",e.jsx("span",{className:"ml-1 font-bold",children:Bs.logs_to_clear.toLocaleString()}),s("dashboard:systemLog.logsUnit"," 条日志")]})]}),e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-300",children:s("dashboard:systemLog.clearWarning","此操作不可撤销，请谨慎操作！")})]})]})]})]}),e.jsxs(Le,{children:[e.jsx(K,{variant:"outline",onClick:()=>{te(!1),Pt(!1),Dt(null)},children:s("common.cancel","取消")}),e.jsx(K,{variant:"destructive",onClick:Ni,disabled:us||!Yt||!Bs,children:us?e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"mr-2 h-4 w-4 animate-spin"}),s("dashboard:systemLog.clearing","清理中...")]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),s("dashboard:systemLog.confirmClear","确认清理")]})})]})]})})]})}function pm(){const{t:s}=V();return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:s("dashboard:title")})}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Xe,{}),e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsx(Ae,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(cm,{}),e.jsx(nm,{}),e.jsx(dm,{}),e.jsx(hm,{})]})})})]})}const gm=Object.freeze(Object.defineProperty({__proto__:null,default:pm},Symbol.toStringTag,{value:"Module"}));function fm({className:s,items:a,...t}){const{pathname:l}=un(),n=Rs(),[r,o]=m.useState(l??"/settings"),c=i=>{o(i),n(i)},{t:u}=V("settings");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1 md:hidden",children:e.jsxs(J,{value:r,onValueChange:c,children:[e.jsx(W,{className:"h-12 sm:w-48",children:e.jsx(Q,{placeholder:"Theme"})}),e.jsx(Y,{children:a.map(i=>e.jsx(A,{value:i.href,children:e.jsxs("div",{className:"flex gap-x-4 px-2 py-1",children:[e.jsx("span",{className:"scale-125",children:i.icon}),e.jsx("span",{className:"text-md",children:u(i.title)})]})},i.href))})]})}),e.jsx("div",{className:"hidden w-full overflow-x-auto bg-background px-1 py-2 md:block",children:e.jsx("nav",{className:y("flex space-x-2 lg:flex-col lg:space-x-0 lg:space-y-1",s),...t,children:a.map(i=>e.jsxs(nt,{to:i.href,className:y(St({variant:"ghost"}),l===i.href?"bg-muted hover:bg-muted":"hover:bg-transparent hover:underline","justify-start"),children:[e.jsx("span",{className:"mr-2",children:i.icon}),u(i.title)]},i.href))})})]})}const jm=[{title:"site.title",key:"site",icon:e.jsx(gc,{size:18}),href:"/config/system",description:"site.description"},{title:"safe.title",key:"safe",icon:e.jsx(Il,{size:18}),href:"/config/system/safe",description:"safe.description"},{title:"subscribe.title",key:"subscribe",icon:e.jsx(Rl,{size:18}),href:"/config/system/subscribe",description:"subscribe.description"},{title:"invite.title",key:"invite",icon:e.jsx(fc,{size:18}),href:"/config/system/invite",description:"invite.description"},{title:"server.title",key:"server",icon:e.jsx(El,{size:18}),href:"/config/system/server",description:"server.description"},{title:"email.title",key:"email",icon:e.jsx(jc,{size:18}),href:"/config/system/email",description:"email.description"},{title:"telegram.title",key:"telegram",icon:e.jsx(vc,{size:18}),href:"/config/system/telegram",description:"telegram.description"},{title:"app.title",key:"app",icon:e.jsx(Ll,{size:18}),href:"/config/system/app",description:"app.description"},{title:"subscribe_template.title",key:"subscribe_template",icon:e.jsx(bc,{size:18}),href:"/config/system/subscribe-template",description:"subscribe_template.description"}];function vm(){const{t:s}=V("settings");return e.jsxs(Ve,{fadedBelow:!0,fixedHeight:!0,children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:s("title")}),e.jsx("div",{className:"text-muted-foreground",children:s("description")})]}),e.jsx(De,{className:"my-6"}),e.jsxs("div",{className:"flex flex-1 flex-col space-y-8 overflow-auto lg:flex-row lg:space-x-12 lg:space-y-0",children:[e.jsx("aside",{className:"sticky top-0 lg:w-1/5",children:e.jsx(fm,{items:jm})}),e.jsx("div",{className:"flex-1 w-full p-1 pr-4",children:e.jsx("div",{className:"pb-16",children:e.jsx(xn,{})})})]})]})]})}const bm=Object.freeze(Object.defineProperty({__proto__:null,default:vm},Symbol.toStringTag,{value:"Module"})),Z=m.forwardRef(({className:s,...a},t)=>e.jsx(er,{className:y("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:t,children:e.jsx(yc,{className:y("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Z.displayName=er.displayName;const ks=m.forwardRef(({className:s,...a},t)=>e.jsx("textarea",{className:y("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a}));ks.displayName="Textarea";const ym=x.object({logo:x.string().nullable().default(""),force_https:x.number().nullable().default(0),stop_register:x.number().nullable().default(0),app_name:x.string().nullable().default(""),app_description:x.string().nullable().default(""),app_url:x.string().nullable().default(""),subscribe_url:x.string().nullable().default(""),try_out_plan_id:x.number().nullable().default(0),try_out_hour:x.coerce.number().nullable().default(0),tos_url:x.string().nullable().default(""),currency:x.string().nullable().default(""),currency_symbol:x.string().nullable().default("")});function Nm(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),{data:n}=le({queryKey:["settings","site"],queryFn:()=>ce.getSettings("site")}),{data:r}=le({queryKey:["plans"],queryFn:()=>ss.getList()}),o=Ne({resolver:we(ym),defaultValues:{},mode:"onBlur"}),{mutateAsync:c}=fs({mutationFn:ce.saveSettings,onSuccess:d=>{d.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(n?.data?.site){const d=n?.data?.site;Object.entries(d).forEach(([h,k])=>{o.setValue(h,k)}),l.current=d}},[n]);const u=m.useCallback(ke.debounce(async d=>{if(!ke.isEqual(d,l.current)){t(!0);try{const h=Object.entries(d).reduce((k,[C,S])=>(k[C]=S===null?"":S,k),{});await c(h),l.current=d}finally{t(!1)}}},1e3),[c]),i=m.useCallback(d=>{u(d)},[u]);return m.useEffect(()=>{const d=o.watch(h=>{i(h)});return()=>d.unsubscribe()},[o.watch,i]),e.jsx(Ce,{...o,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:o.control,name:"app_name",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.siteName.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.siteName.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.siteName.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"app_description",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.siteDescription.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.siteDescription.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.siteDescription.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"app_url",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.siteUrl.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.siteUrl.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.siteUrl.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"force_https",render:({field:d})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("site.form.forceHttps.label")}),e.jsx(M,{children:s("site.form.forceHttps.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:!!d.value,onCheckedChange:h=>{d.onChange(Number(h)),i(o.getValues())}})})]})}),e.jsx(v,{control:o.control,name:"logo",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.logo.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.logo.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.logo.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"subscribe_url",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.subscribeUrl.label")}),e.jsx(b,{children:e.jsx(ks,{placeholder:s("site.form.subscribeUrl.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.subscribeUrl.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"tos_url",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.tosUrl.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.tosUrl.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.tosUrl.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"stop_register",render:({field:d})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("site.form.stopRegister.label")}),e.jsx(M,{children:s("site.form.stopRegister.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:!!d.value,onCheckedChange:h=>{d.onChange(Number(h)),i(o.getValues())}})})]})}),e.jsx(v,{control:o.control,name:"try_out_plan_id",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.tryOut.label")}),e.jsx(b,{children:e.jsxs(J,{value:d.value?.toString(),onValueChange:h=>{d.onChange(Number(h)),i(o.getValues())},children:[e.jsx(W,{children:e.jsx(Q,{placeholder:s("site.form.tryOut.placeholder")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("site.form.tryOut.placeholder")}),r?.data?.map(h=>e.jsx(A,{value:h.id.toString(),children:h.name},h.id.toString()))]})]})}),e.jsx(M,{children:s("site.form.tryOut.description")}),e.jsx(P,{})]})}),!!o.watch("try_out_plan_id")&&e.jsx(v,{control:o.control,name:"try_out_hour",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"",children:s("site.form.tryOut.duration.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.tryOut.duration.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.tryOut.duration.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"currency",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.currency.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.currency.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.currency.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:o.control,name:"currency_symbol",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("site.form.currencySymbol.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("site.form.currencySymbol.placeholder"),...d,value:d.value||"",onChange:h=>{d.onChange(h),i(o.getValues())}})}),e.jsx(M,{children:s("site.form.currencySymbol.description")}),e.jsx(P,{})]})}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("site.form.saving")})]})})}function _m(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("site.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("site.description")})]}),e.jsx(De,{}),e.jsx(Nm,{})]})}const wm=Object.freeze(Object.defineProperty({__proto__:null,default:_m},Symbol.toStringTag,{value:"Module"})),Cm=x.object({email_verify:x.boolean().nullable(),safe_mode_enable:x.boolean().nullable(),secure_path:x.string().nullable(),email_whitelist_enable:x.boolean().nullable(),email_whitelist_suffix:x.array(x.string().nullable()).nullable(),email_gmail_limit_enable:x.boolean().nullable(),recaptcha_enable:x.boolean().nullable(),recaptcha_key:x.string().nullable(),recaptcha_site_key:x.string().nullable(),register_limit_by_ip_enable:x.boolean().nullable(),register_limit_count:x.coerce.string().transform(s=>s===""?null:s).nullable(),register_limit_expire:x.coerce.string().transform(s=>s===""?null:s).nullable(),password_limit_enable:x.boolean().nullable(),password_limit_count:x.coerce.string().transform(s=>s===""?null:s).nullable(),password_limit_expire:x.coerce.string().transform(s=>s===""?null:s).nullable()}),Sm={email_verify:!1,safe_mode_enable:!1,secure_path:"",email_whitelist_enable:!1,email_whitelist_suffix:[],email_gmail_limit_enable:!1,recaptcha_enable:!1,recaptcha_key:"",recaptcha_site_key:"",register_limit_by_ip_enable:!1,register_limit_count:"",register_limit_expire:"",password_limit_enable:!1,password_limit_count:"",password_limit_expire:""};function km(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),n=Ne({resolver:we(Cm),defaultValues:Sm,mode:"onBlur"}),{data:r}=le({queryKey:["settings","safe"],queryFn:()=>ce.getSettings("safe")}),{mutateAsync:o}=fs({mutationFn:ce.saveSettings,onSuccess:i=>{i.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(r?.data.safe){const i=r.data.safe;Object.entries(i).forEach(([d,h])=>{typeof h=="number"?n.setValue(d,String(h)):n.setValue(d,h)}),l.current=i}},[r]);const c=m.useCallback(ke.debounce(async i=>{if(!ke.isEqual(i,l.current)){t(!0);try{await o(i),l.current=i}finally{t(!1)}}},1e3),[o]),u=m.useCallback(i=>{c(i)},[c]);return m.useEffect(()=>{const i=n.watch(d=>{u(d)});return()=>i.unsubscribe()},[n.watch,u]),e.jsx(Ce,{...n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"email_verify",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.emailVerify.label")}),e.jsx(M,{children:s("safe.form.emailVerify.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"email_gmail_limit_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.gmailLimit.label")}),e.jsx(M,{children:s("safe.form.gmailLimit.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"safe_mode_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.safeMode.label")}),e.jsx(M,{children:s("safe.form.safeMode.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"secure_path",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.securePath.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.securePath.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.securePath.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"email_whitelist_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.emailWhitelist.label")}),e.jsx(M,{children:s("safe.form.emailWhitelist.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),n.watch("email_whitelist_enable")&&e.jsx(v,{control:n.control,name:"email_whitelist_suffix",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.emailWhitelist.suffixes.label")}),e.jsx(b,{children:e.jsx(ks,{placeholder:s("safe.form.emailWhitelist.suffixes.placeholder"),...i,value:(i.value||[]).join(`
`),onChange:d=>{const h=d.target.value.split(`
`).filter(Boolean);i.onChange(h),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.emailWhitelist.suffixes.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"recaptcha_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.recaptcha.enable.label")}),e.jsx(M,{children:s("safe.form.recaptcha.enable.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),n.watch("recaptcha_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(v,{control:n.control,name:"recaptcha_site_key",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.recaptcha.siteKey.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.recaptcha.siteKey.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.recaptcha.siteKey.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"recaptcha_key",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.recaptcha.key.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.recaptcha.key.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.recaptcha.key.description")}),e.jsx(P,{})]})})]}),e.jsx(v,{control:n.control,name:"register_limit_by_ip_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.registerLimit.enable.label")}),e.jsx(M,{children:s("safe.form.registerLimit.enable.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),n.watch("register_limit_by_ip_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(v,{control:n.control,name:"register_limit_count",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.registerLimit.count.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.registerLimit.count.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.registerLimit.count.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"register_limit_expire",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.registerLimit.expire.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.registerLimit.expire.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.registerLimit.expire.description")}),e.jsx(P,{})]})})]}),e.jsx(v,{control:n.control,name:"password_limit_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("safe.form.passwordLimit.enable.label")}),e.jsx(M,{children:s("safe.form.passwordLimit.enable.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),n.watch("password_limit_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(v,{control:n.control,name:"password_limit_count",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.passwordLimit.count.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.passwordLimit.count.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.passwordLimit.count.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"password_limit_expire",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("safe.form.passwordLimit.expire.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("safe.form.passwordLimit.expire.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(M,{children:s("safe.form.passwordLimit.expire.description")}),e.jsx(P,{})]})})]}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("safe.form.saving")})]})})}function Tm(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("safe.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("safe.description")})]}),e.jsx(De,{}),e.jsx(km,{})]})}const Dm=Object.freeze(Object.defineProperty({__proto__:null,default:Tm},Symbol.toStringTag,{value:"Module"})),Pm=x.object({plan_change_enable:x.boolean().nullable().default(!1),reset_traffic_method:x.coerce.number().nullable().default(0),surplus_enable:x.boolean().nullable().default(!1),new_order_event_id:x.coerce.number().nullable().default(0),renew_order_event_id:x.coerce.number().nullable().default(0),change_order_event_id:x.coerce.number().nullable().default(0),show_info_to_server_enable:x.boolean().nullable().default(!1),show_protocol_to_server_enable:x.boolean().nullable().default(!1),default_remind_expire:x.boolean().nullable().default(!1),default_remind_traffic:x.boolean().nullable().default(!1),subscribe_path:x.string().nullable().default("s")}),Lm={plan_change_enable:!1,reset_traffic_method:0,surplus_enable:!1,new_order_event_id:0,renew_order_event_id:0,change_order_event_id:0,show_info_to_server_enable:!1,show_protocol_to_server_enable:!1,default_remind_expire:!1,default_remind_traffic:!1,subscribe_path:"s"};function Em(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),n=Ne({resolver:we(Pm),defaultValues:Lm,mode:"onBlur"}),{data:r}=le({queryKey:["settings","subscribe"],queryFn:()=>ce.getSettings("subscribe")}),{mutateAsync:o}=fs({mutationFn:ce.saveSettings,onSuccess:i=>{i.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(r?.data?.subscribe){const i=r?.data?.subscribe;Object.entries(i).forEach(([d,h])=>{n.setValue(d,h)}),l.current=i}},[r]);const c=m.useCallback(ke.debounce(async i=>{if(!ke.isEqual(i,l.current)){t(!0);try{await o(i),l.current=i}finally{t(!1)}}},1e3),[o]),u=m.useCallback(i=>{c(i)},[c]);return m.useEffect(()=>{const i=n.watch(d=>{u(d)});return()=>i.unsubscribe()},[n.watch,u]),e.jsx(Ce,{...n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"plan_change_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.plan_change_enable.title")}),e.jsx(M,{children:s("subscribe.plan_change_enable.description")}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"reset_traffic_method",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.reset_traffic_method.title")}),e.jsxs(J,{onValueChange:i.onChange,value:i.value?.toString()||"0",children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:"请选择重置方式"})})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("subscribe.reset_traffic_method.options.monthly_first")}),e.jsx(A,{value:"1",children:s("subscribe.reset_traffic_method.options.monthly_reset")}),e.jsx(A,{value:"2",children:s("subscribe.reset_traffic_method.options.no_reset")}),e.jsx(A,{value:"3",children:s("subscribe.reset_traffic_method.options.yearly_first")}),e.jsx(A,{value:"4",children:s("subscribe.reset_traffic_method.options.yearly_reset")})]})]}),e.jsx(M,{children:s("subscribe.reset_traffic_method.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"surplus_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.surplus_enable.title")}),e.jsx(M,{children:s("subscribe.surplus_enable.description")}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"new_order_event_id",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.new_order_event.title")}),e.jsx("div",{className:"relative w-max",children:e.jsx(b,{children:e.jsxs(J,{onValueChange:i.onChange,value:i.value?.toString(),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:"请选择"})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("subscribe.new_order_event.options.no_action")}),e.jsx(A,{value:"1",children:s("subscribe.new_order_event.options.reset_traffic")})]})]})})}),e.jsx(M,{children:s("subscribe.new_order_event.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"renew_order_event_id",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.renew_order_event.title")}),e.jsx("div",{className:"relative w-max",children:e.jsx(b,{children:e.jsxs(J,{onValueChange:i.onChange,value:i.value?.toString(),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:"请选择"})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("subscribe.renew_order_event.options.no_action")}),e.jsx(A,{value:"1",children:s("subscribe.renew_order_event.options.reset_traffic")})]})]})})}),e.jsx(M,{children:s("subscribe.renew_order_event.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"change_order_event_id",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.change_order_event.title")}),e.jsx("div",{className:"relative w-max",children:e.jsx(b,{children:e.jsxs(J,{onValueChange:i.onChange,value:i.value?.toString(),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:"请选择"})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("subscribe.change_order_event.options.no_action")}),e.jsx(A,{value:"1",children:s("subscribe.change_order_event.options.reset_traffic")})]})]})})}),e.jsx(M,{children:s("subscribe.change_order_event.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"subscribe_path",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("subscribe.subscribe_path.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:"subscribe",...i,value:i.value||"",onChange:d=>{i.onChange(d),u(n.getValues())}})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s("subscribe.subscribe_path.description"),e.jsx("br",{}),s("subscribe.subscribe_path.current_format",{path:i.value||"s"})]}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"show_info_to_server_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("subscribe.show_info_to_server.title")}),e.jsx(M,{children:s("subscribe.show_info_to_server.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"show_protocol_to_server_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("subscribe.show_protocol_to_server.title")}),e.jsx(M,{children:s("subscribe.show_protocol_to_server.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function Im(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("subscribe.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("subscribe.description")})]}),e.jsx(De,{}),e.jsx(Em,{})]})}const Rm=Object.freeze(Object.defineProperty({__proto__:null,default:Im},Symbol.toStringTag,{value:"Module"})),Vm=x.object({invite_force:x.boolean().default(!1),invite_commission:x.coerce.string().default("0"),invite_gen_limit:x.coerce.string().default("0"),invite_never_expire:x.boolean().default(!1),commission_first_time_enable:x.boolean().default(!1),commission_auto_check_enable:x.boolean().default(!1),commission_withdraw_limit:x.coerce.string().default("0"),commission_withdraw_method:x.array(x.string()).default(["支付宝","USDT","Paypal"]),withdraw_close_enable:x.boolean().default(!1),commission_distribution_enable:x.boolean().default(!1),commission_distribution_l1:x.coerce.number().default(0),commission_distribution_l2:x.coerce.number().default(0),commission_distribution_l3:x.coerce.number().default(0)}),Fm={invite_force:!1,invite_commission:"0",invite_gen_limit:"0",invite_never_expire:!1,commission_first_time_enable:!1,commission_auto_check_enable:!1,commission_withdraw_limit:"0",commission_withdraw_method:["支付宝","USDT","Paypal"],withdraw_close_enable:!1,commission_distribution_enable:!1,commission_distribution_l1:0,commission_distribution_l2:0,commission_distribution_l3:0};function Mm(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),n=Ne({resolver:we(Vm),defaultValues:Fm,mode:"onBlur"}),{data:r}=le({queryKey:["settings","invite"],queryFn:()=>ce.getSettings("invite")}),{mutateAsync:o}=fs({mutationFn:ce.saveSettings,onSuccess:i=>{i.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(r?.data?.invite){const i=r?.data?.invite;Object.entries(i).forEach(([d,h])=>{typeof h=="number"?n.setValue(d,String(h)):n.setValue(d,h)}),l.current=i}},[r]);const c=m.useCallback(ke.debounce(async i=>{if(!ke.isEqual(i,l.current)){t(!0);try{await o(i),l.current=i}finally{t(!1)}}},1e3),[o]),u=m.useCallback(i=>{c(i)},[c]);return m.useEffect(()=>{const i=n.watch(d=>{u(d)});return()=>i.unsubscribe()},[n.watch,u]),e.jsx(Ce,{...n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"invite_force",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("invite.invite_force.title")}),e.jsx(M,{children:s("invite.invite_force.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"invite_commission",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("invite.invite_commission.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("invite.invite_commission.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("invite.invite_commission.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"invite_gen_limit",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("invite.invite_gen_limit.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("invite.invite_gen_limit.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("invite.invite_gen_limit.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"invite_never_expire",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("invite.invite_never_expire.title")}),e.jsx(M,{children:s("invite.invite_never_expire.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"commission_first_time_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("invite.commission_first_time.title")}),e.jsx(M,{children:s("invite.commission_first_time.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"commission_auto_check_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("invite.commission_auto_check.title")}),e.jsx(M,{children:s("invite.commission_auto_check.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"commission_withdraw_limit",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("invite.commission_withdraw_limit.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("invite.commission_withdraw_limit.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("invite.commission_withdraw_limit.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"commission_withdraw_method",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("invite.commission_withdraw_method.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("invite.commission_withdraw_method.placeholder"),...i,value:Array.isArray(i.value)?i.value.join(","):"",onChange:d=>{const h=d.target.value.split(",").filter(Boolean);i.onChange(h),u(n.getValues())}})}),e.jsx(M,{children:s("invite.commission_withdraw_method.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"withdraw_close_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("invite.withdraw_close.title")}),e.jsx(M,{children:s("invite.withdraw_close.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),e.jsx(v,{control:n.control,name:"commission_distribution_enable",render:({field:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("invite.commission_distribution.title")}),e.jsx(M,{children:s("invite.commission_distribution.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:d=>{i.onChange(d),u(n.getValues())}})})]})}),n.watch("commission_distribution_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(v,{control:n.control,name:"commission_distribution_l1",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:s("invite.commission_distribution.l1")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:s("invite.commission_distribution.placeholder"),...i,value:i.value||"",onChange:d=>{const h=d.target.value?Number(d.target.value):0;i.onChange(h),u(n.getValues())}})}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"commission_distribution_l2",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:s("invite.commission_distribution.l2")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:s("invite.commission_distribution.placeholder"),...i,value:i.value||"",onChange:d=>{const h=d.target.value?Number(d.target.value):0;i.onChange(h),u(n.getValues())}})}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"commission_distribution_l3",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:s("invite.commission_distribution.l3")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:s("invite.commission_distribution.placeholder"),...i,value:i.value||"",onChange:d=>{const h=d.target.value?Number(d.target.value):0;i.onChange(h),u(n.getValues())}})}),e.jsx(P,{})]})})]}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("invite.saving")})]})})}function Om(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("invite.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("invite.description")})]}),e.jsx(De,{}),e.jsx(Mm,{})]})}const zm=Object.freeze(Object.defineProperty({__proto__:null,default:Om},Symbol.toStringTag,{value:"Module"})),$m=x.object({frontend_theme:x.string().nullable(),frontend_theme_sidebar:x.string().nullable(),frontend_theme_header:x.string().nullable(),frontend_theme_color:x.string().nullable(),frontend_background_url:x.string().url().nullable()}),Am={frontend_theme:"",frontend_theme_sidebar:"",frontend_theme_header:"",frontend_theme_color:"",frontend_background_url:""};function qm(){const{data:s}=le({queryKey:["settings","frontend"],queryFn:()=>ce.getSettings("frontend")}),a=Ne({resolver:we($m),defaultValues:Am,mode:"onChange"});m.useEffect(()=>{if(s?.data?.frontend){const l=s?.data?.frontend;Object.entries(l).forEach(([n,r])=>{a.setValue(n,r)})}},[s]);function t(l){ce.saveSettings(l).then(({data:n})=>{n&&$.success("更新成功")})}return e.jsx(Ce,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(t),className:"space-y-8",children:[e.jsx(v,{control:a.control,name:"frontend_theme_sidebar",render:({field:l})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:"边栏风格"}),e.jsx(M,{children:"边栏风格"})]}),e.jsx(b,{children:e.jsx(Z,{checked:l.value,onCheckedChange:l.onChange})})]})}),e.jsx(v,{control:a.control,name:"frontend_theme_header",render:({field:l})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:"头部风格"}),e.jsx(M,{children:"边栏风格"})]}),e.jsx(b,{children:e.jsx(Z,{checked:l.value,onCheckedChange:l.onChange})})]})}),e.jsx(v,{control:a.control,name:"frontend_theme_color",render:({field:l})=>e.jsxs(f,{children:[e.jsx(j,{children:"主题色"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(b,{children:e.jsxs("select",{className:y(St({variant:"outline"}),"w-[200px] appearance-none font-normal"),...l,children:[e.jsx("option",{value:"default",children:"默认"}),e.jsx("option",{value:"black",children:"黑色"}),e.jsx("option",{value:"blackblue",children:"暗蓝色"}),e.jsx("option",{value:"green",children:"奶绿色"})]})}),e.jsx(jn,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(M,{children:"主题色"}),e.jsx(P,{})]})}),e.jsx(v,{control:a.control,name:"frontend_background_url",render:({field:l})=>e.jsxs(f,{children:[e.jsx(j,{children:"背景"}),e.jsx(b,{children:e.jsx(D,{placeholder:"请输入图片地址",...l})}),e.jsx(M,{children:"将会在后台登录页面进行展示。"}),e.jsx(P,{})]})}),e.jsx(L,{type:"submit",children:"保存设置"})]})})}function Hm(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"个性化设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"自定义系统界面外观，包括主题风格、布局、颜色方案、背景图等个性化选项。"})]}),e.jsx(De,{}),e.jsx(qm,{})]})}const Um=Object.freeze(Object.defineProperty({__proto__:null,default:Hm},Symbol.toStringTag,{value:"Module"})),Km=x.object({server_pull_interval:x.coerce.number().nullable(),server_push_interval:x.coerce.number().nullable(),server_token:x.string().nullable(),device_limit_mode:x.coerce.number().nullable()}),Bm={server_pull_interval:0,server_push_interval:0,server_token:"",device_limit_mode:0};function Gm(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),n=Ne({resolver:we(Km),defaultValues:Bm,mode:"onBlur"}),{data:r}=le({queryKey:["settings","server"],queryFn:()=>ce.getSettings("server")}),{mutateAsync:o}=fs({mutationFn:ce.saveSettings,onSuccess:d=>{d.data&&$.success(s("common.AutoSaved"))}});m.useEffect(()=>{if(r?.data.server){const d=r.data.server;Object.entries(d).forEach(([h,k])=>{n.setValue(h,k)}),l.current=d}},[r]);const c=m.useCallback(ke.debounce(async d=>{if(!ke.isEqual(d,l.current)){t(!0);try{await o(d),l.current=d}finally{t(!1)}}},1e3),[o]),u=m.useCallback(d=>{c(d)},[c]);m.useEffect(()=>{const d=n.watch(h=>{u(h)});return()=>d.unsubscribe()},[n.watch,u]);const i=()=>{const d=Math.floor(Math.random()*17)+16,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let k="";for(let C=0;C<d;C++)k+=h.charAt(Math.floor(Math.random()*h.length));n.setValue("server_token",k)};return e.jsx(Ce,{...n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"server_token",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("server.server_token.title")}),e.jsx(b,{children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{placeholder:s("server.server_token.placeholder"),...d,value:d.value||"",className:"pr-10"}),e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(K,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2",onClick:h=>{h.preventDefault(),i()},children:e.jsx(Nc,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})}),e.jsx(oe,{children:e.jsx("p",{children:s("server.server_token.generate_tooltip")})})]})})]})}),e.jsx(M,{children:s("server.server_token.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"server_pull_interval",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("server.server_pull_interval.title")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:s("server.server_pull_interval.placeholder"),...d,value:d.value||"",onChange:h=>{const k=h.target.value?Number(h.target.value):null;d.onChange(k)}})}),e.jsx(M,{children:s("server.server_pull_interval.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"server_push_interval",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("server.server_push_interval.title")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:s("server.server_push_interval.placeholder"),...d,value:d.value||"",onChange:h=>{const k=h.target.value?Number(h.target.value):null;d.onChange(k)}})}),e.jsx(M,{children:s("server.server_push_interval.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"device_limit_mode",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("server.device_limit_mode.title")}),e.jsxs(J,{onValueChange:d.onChange,value:d.value?.toString()||"0",children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:s("server.device_limit_mode.placeholder")})})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("server.device_limit_mode.strict")}),e.jsx(A,{value:"1",children:s("server.device_limit_mode.relaxed")})]})]}),e.jsx(M,{children:s("server.device_limit_mode.description")}),e.jsx(P,{})]})}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("server.saving")})]})})}function Wm(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("server.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("server.description")})]}),e.jsx(De,{}),e.jsx(Gm,{})]})}const Ym=Object.freeze(Object.defineProperty({__proto__:null,default:Wm},Symbol.toStringTag,{value:"Module"}));function Jm({open:s,onOpenChange:a,result:t}){const l=!t.error;return e.jsx(ge,{open:s,onOpenChange:a,children:e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(Xl,{className:"h-5 w-5 text-green-500"}):e.jsx(Zl,{className:"h-5 w-5 text-destructive"}),e.jsx(fe,{children:l?"邮件发送成功":"邮件发送失败"})]}),e.jsx(Re,{children:l?"测试邮件已成功发送，请检查收件箱":"发送测试邮件时遇到错误"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium",children:"发送详情"}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"收件地址"}),e.jsx("div",{children:t.email}),e.jsx("div",{className:"text-muted-foreground",children:"邮件主题"}),e.jsx("div",{children:t.subject}),e.jsx("div",{className:"text-muted-foreground",children:"模板名称"}),e.jsx("div",{children:t.template_name})]})]}),t.error&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium text-destructive",children:"错误信息"}),e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive break-all",children:t.error})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium",children:"配置信息"}),e.jsx(_t,{className:"h-[200px] rounded-md border p-4",children:e.jsx("div",{className:"grid gap-2 text-sm",children:e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"驱动"}),e.jsx("div",{children:t.config.driver}),e.jsx("div",{className:"text-muted-foreground",children:"服务器"}),e.jsx("div",{children:t.config.host}),e.jsx("div",{className:"text-muted-foreground",children:"端口"}),e.jsx("div",{children:t.config.port}),e.jsx("div",{className:"text-muted-foreground",children:"加密方式"}),e.jsx("div",{children:t.config.encryption||"无"}),e.jsx("div",{className:"text-muted-foreground",children:"发件人"}),e.jsx("div",{children:t.config.from.address?`${t.config.from.address}${t.config.from.name?` (${t.config.from.name})`:""}`:"未设置"}),e.jsx("div",{className:"text-muted-foreground",children:"用户名"}),e.jsx("div",{children:t.config.username||"未设置"})]})})})]})]})]})})}const Qm=x.object({email_template:x.string().nullable().default("classic"),email_host:x.string().nullable().default(""),email_port:x.coerce.number().nullable().default(465),email_username:x.string().nullable().default(""),email_password:x.string().nullable().default(""),email_encryption:x.string().nullable().default(""),email_from_address:x.string().email().nullable().default(""),remind_mail_enable:x.boolean().nullable().default(!1)});function Xm(){const{t:s}=V("settings"),[a,t]=m.useState(null),[l,n]=m.useState(!1),r=m.useRef(null),[o,c]=m.useState(!1),u=Ne({resolver:we(Qm),defaultValues:{},mode:"onBlur"}),{data:i}=le({queryKey:["settings","email"],queryFn:()=>ce.getSettings("email")}),{data:d}=le({queryKey:["emailTemplate"],queryFn:()=>ce.getEmailTemplate()}),{mutateAsync:h}=fs({mutationFn:ce.saveSettings,onSuccess:N=>{N.data&&$.success(s("common.autoSaved"))}}),{mutate:k,isPending:C}=fs({mutationFn:ce.sendTestMail,onMutate:()=>{t(null),n(!1)},onSuccess:N=>{t(N.data),n(!0),N.data.error?$.error(s("email.test.error")):$.success(s("email.test.success"))}});m.useEffect(()=>{if(i?.data.email){const N=i.data.email;Object.entries(N).forEach(([g,T])=>{u.setValue(g,T)}),r.current=N}},[i]);const S=m.useCallback(ke.debounce(async N=>{if(!ke.isEqual(N,r.current)){c(!0);try{await h(N),r.current=N}finally{c(!1)}}},1e3),[h]),w=m.useCallback(N=>{S(N)},[S]);return m.useEffect(()=>{const N=u.watch(g=>{w(g)});return()=>N.unsubscribe()},[u.watch,w]),e.jsxs(e.Fragment,{children:[e.jsx(Ce,{...u,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:u.control,name:"email_host",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_host.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...N,value:N.value||""})}),e.jsx(M,{children:s("email.email_host.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"email_port",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_port.title")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:s("common.placeholder"),...N,value:N.value||"",onChange:g=>{const T=g.target.value?Number(g.target.value):null;N.onChange(T)}})}),e.jsx(M,{children:s("email.email_port.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"email_encryption",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_encryption.title")}),e.jsxs(J,{onValueChange:g=>{const T=g==="none"?"":g;N.onChange(T)},value:N.value===""||N.value===null||N.value===void 0?"none":N.value,children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:"请选择加密方式"})})}),e.jsxs(Y,{children:[e.jsx(A,{value:"none",children:s("email.email_encryption.none")}),e.jsx(A,{value:"ssl",children:s("email.email_encryption.ssl")}),e.jsx(A,{value:"tls",children:s("email.email_encryption.tls")})]})]}),e.jsx(M,{children:s("email.email_encryption.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"email_username",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_username.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...N,value:N.value||""})}),e.jsx(M,{children:s("email.email_username.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"email_password",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_password.title")}),e.jsx(b,{children:e.jsx(D,{type:"password",placeholder:s("common.placeholder"),...N,value:N.value||""})}),e.jsx(M,{children:s("email.email_password.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"email_from_address",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_from.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...N,value:N.value||""})}),e.jsx(M,{children:s("email.email_from.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"email_template",render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("email.email_template.title")}),e.jsxs(J,{onValueChange:g=>{N.onChange(g),w(u.getValues())},value:N.value||void 0,children:[e.jsx(b,{children:e.jsx(W,{className:"w-[200px]",children:e.jsx(Q,{placeholder:s("email.email_template.placeholder")})})}),e.jsx(Y,{children:d?.data?.map(g=>e.jsx(A,{value:g,children:g},g))})]}),e.jsx(M,{children:s("email.email_template.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"remind_mail_enable",render:({field:N})=>e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:s("email.remind_mail.title")}),e.jsx(M,{children:s("email.remind_mail.description")})]}),e.jsx(b,{children:e.jsx(Z,{checked:N.value||!1,onCheckedChange:g=>{N.onChange(g),w(u.getValues())}})})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(L,{onClick:()=>k(),loading:C,disabled:C,children:s(C?"email.test.sending":"email.test.title")})})]})}),o&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("saving")}),a&&e.jsx(Jm,{open:l,onOpenChange:n,result:a})]})}function Zm(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("email.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("email.description")})]}),e.jsx(De,{}),e.jsx(Xm,{})]})}const eu=Object.freeze(Object.defineProperty({__proto__:null,default:Zm},Symbol.toStringTag,{value:"Module"})),su=x.object({telegram_bot_enable:x.boolean().nullable(),telegram_bot_token:x.string().nullable(),telegram_discuss_link:x.string().nullable()}),tu={telegram_bot_enable:!1,telegram_bot_token:"",telegram_discuss_link:""};function au(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),n=Ne({resolver:we(su),defaultValues:tu,mode:"onBlur"}),{data:r}=le({queryKey:["settings","telegram"],queryFn:()=>ce.getSettings("telegram")}),{mutateAsync:o}=fs({mutationFn:ce.saveSettings,onSuccess:h=>{h.data&&$.success(s("common.autoSaved"))}}),{mutate:c,isPending:u}=fs({mutationFn:ce.setTelegramWebhook,onSuccess:h=>{h.data&&$.success(s("telegram.webhook.success"))}});m.useEffect(()=>{if(r?.data.telegram){const h=r.data.telegram;Object.entries(h).forEach(([k,C])=>{n.setValue(k,C)}),l.current=h}},[r]);const i=m.useCallback(ke.debounce(async h=>{if(!ke.isEqual(h,l.current)){t(!0);try{await o(h),l.current=h}finally{t(!1)}}},1e3),[o]),d=m.useCallback(h=>{i(h)},[i]);return m.useEffect(()=>{const h=n.watch(k=>{d(k)});return()=>h.unsubscribe()},[n.watch,d]),e.jsx(Ce,{...n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"telegram_bot_token",render:({field:h})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("telegram.bot_token.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("telegram.bot_token.placeholder"),...h,value:h.value||""})}),e.jsx(M,{children:s("telegram.bot_token.description")}),e.jsx(P,{})]})}),n.watch("telegram_bot_token")&&e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("telegram.webhook.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{loading:u,disabled:u,onClick:()=>c(),children:s(u?"telegram.webhook.setting":"telegram.webhook.button")}),a&&e.jsx("span",{className:"text-sm text-muted-foreground",children:s("common.saving")})]}),e.jsx(M,{children:s("telegram.webhook.description")}),e.jsx(P,{})]}),e.jsx(v,{control:n.control,name:"telegram_bot_enable",render:({field:h})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("telegram.bot_enable.title")}),e.jsx(M,{children:s("telegram.bot_enable.description")}),e.jsx(b,{children:e.jsx(Z,{checked:h.value||!1,onCheckedChange:k=>{h.onChange(k),d(n.getValues())}})}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"telegram_discuss_link",render:({field:h})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("telegram.discuss_link.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("telegram.discuss_link.placeholder"),...h,value:h.value||""})}),e.jsx(M,{children:s("telegram.discuss_link.description")}),e.jsx(P,{})]})}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function nu(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("telegram.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("telegram.description")})]}),e.jsx(De,{}),e.jsx(au,{})]})}const lu=Object.freeze(Object.defineProperty({__proto__:null,default:nu},Symbol.toStringTag,{value:"Module"})),ru=x.object({windows_version:x.string().nullable(),windows_download_url:x.string().nullable(),macos_version:x.string().nullable(),macos_download_url:x.string().nullable(),android_version:x.string().nullable(),android_download_url:x.string().nullable()}),iu={windows_version:"",windows_download_url:"",macos_version:"",macos_download_url:"",android_version:"",android_download_url:""};function ou(){const{t:s}=V("settings"),[a,t]=m.useState(!1),l=m.useRef(null),n=Ne({resolver:we(ru),defaultValues:iu,mode:"onBlur"}),{data:r}=le({queryKey:["settings","app"],queryFn:()=>ce.getSettings("app")}),{mutateAsync:o}=fs({mutationFn:ce.saveSettings,onSuccess:i=>{i.data&&$.success(s("app.save_success"))}});m.useEffect(()=>{if(r?.data.app){const i=r.data.app;Object.entries(i).forEach(([d,h])=>{n.setValue(d,h)}),l.current=i}},[r]);const c=m.useCallback(ke.debounce(async i=>{if(!ke.isEqual(i,l.current)){t(!0);try{await o(i),l.current=i}finally{t(!1)}}},1e3),[o]),u=m.useCallback(i=>{c(i)},[c]);return m.useEffect(()=>{const i=n.watch(d=>{u(d)});return()=>i.unsubscribe()},[n.watch,u]),e.jsx(Ce,{...n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"windows_version",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("app.windows.version.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("app.windows.version.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"windows_download_url",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("app.windows.download.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("app.windows.download.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"macos_version",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("app.macos.version.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("app.macos.version.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"macos_download_url",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("app.macos.download.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("app.macos.download.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"android_version",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("app.android.version.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("app.android.version.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"android_download_url",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{className:"text-base",children:s("app.android.download.title")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(M,{children:s("app.android.download.description")}),e.jsx(P,{})]})}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function cu(){const{t:s}=V("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("app.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("app.description")})]}),e.jsx(De,{}),e.jsx(ou,{})]})}const du=Object.freeze(Object.defineProperty({__proto__:null,default:cu},Symbol.toStringTag,{value:"Module"})),mu=s=>x.object({id:x.number().nullable(),name:x.string().min(2,s("form.validation.name.min")).max(30,s("form.validation.name.max")),icon:x.string().optional().nullable(),notify_domain:x.string().refine(t=>!t||/^https?:\/\/\S+/.test(t),s("form.validation.notify_domain.url")).optional().nullable(),handling_fee_fixed:x.coerce.number().min(0).optional().nullable(),handling_fee_percent:x.coerce.number().min(0).max(100).optional().nullable(),payment:x.string().min(1,s("form.validation.payment.required")),config:x.record(x.string(),x.string())}),al={id:null,name:"",icon:"",notify_domain:"",handling_fee_fixed:0,handling_fee_percent:0,payment:"",config:{}};function Mr({refetch:s,dialogTrigger:a,type:t="add",defaultFormValues:l=al}){const{t:n}=V("payment"),[r,o]=m.useState(!1),[c,u]=m.useState(!1),[i,d]=m.useState([]),[h,k]=m.useState([]),C=mu(n),S=Ne({resolver:we(C),defaultValues:l,mode:"onChange"}),w=S.watch("payment");m.useEffect(()=>{r&&(async()=>{const{data:T}=await et.getMethodList();d(T)})()},[r]),m.useEffect(()=>{if(!w||!r)return;(async()=>{const T={payment:w,...t==="edit"&&{id:Number(S.getValues("id"))}};et.getMethodForm(T).then(({data:E})=>{k(E);const p=E.reduce((_,I)=>(I.field_name&&(_[I.field_name]=I.value??""),_),{});S.setValue("config",p)})})()},[w,r,S,t]);const N=async g=>{u(!0);try{(await et.save(g)).data&&($.success(n("form.messages.success")),S.reset(al),s(),o(!1))}finally{u(!1)}};return e.jsxs(ge,{open:r,onOpenChange:o,children:[e.jsx(is,{asChild:!0,children:a||e.jsxs(L,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(ze,{icon:"ion:add"})," ",e.jsx("div",{children:n("form.add.button")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsx(ve,{children:e.jsx(fe,{children:n(t==="add"?"form.add.title":"form.edit.title")})}),e.jsx(Ce,{...S,children:e.jsxs("form",{onSubmit:S.handleSubmit(N),className:"space-y-4",children:[e.jsx(v,{control:S.control,name:"name",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:n("form.fields.name.placeholder"),...g})}),e.jsx(M,{children:n("form.fields.name.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:S.control,name:"icon",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.icon.label")}),e.jsx(b,{children:e.jsx(D,{...g,value:g.value||"",placeholder:n("form.fields.icon.placeholder")})}),e.jsx(M,{children:n("form.fields.icon.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:S.control,name:"notify_domain",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.notify_domain.label")}),e.jsx(b,{children:e.jsx(D,{...g,value:g.value||"",placeholder:n("form.fields.notify_domain.placeholder")})}),e.jsx(M,{children:n("form.fields.notify_domain.description")}),e.jsx(P,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(v,{control:S.control,name:"handling_fee_percent",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.handling_fee_percent.label")}),e.jsx(b,{children:e.jsx(D,{type:"number",...g,value:g.value||"",placeholder:n("form.fields.handling_fee_percent.placeholder")})}),e.jsx(P,{})]})}),e.jsx(v,{control:S.control,name:"handling_fee_fixed",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.handling_fee_fixed.label")}),e.jsx(b,{children:e.jsx(D,{type:"number",...g,value:g.value||"",placeholder:n("form.fields.handling_fee_fixed.placeholder")})}),e.jsx(P,{})]})})]}),e.jsx(v,{control:S.control,name:"payment",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.payment.label")}),e.jsxs(J,{onValueChange:g.onChange,defaultValue:g.value,children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:n("form.fields.payment.placeholder")})})}),e.jsx(Y,{children:i.map(T=>e.jsx(A,{value:T,children:T},T))})]}),e.jsx(M,{children:n("form.fields.payment.description")}),e.jsx(P,{})]})}),h.length>0&&e.jsx("div",{className:"space-y-4",children:h.map(g=>e.jsx(v,{control:S.control,name:`config.${g.field_name}`,render:({field:T})=>e.jsxs(f,{children:[e.jsx(j,{children:g.label}),e.jsx(b,{children:e.jsx(D,{...T,value:T.value||""})}),e.jsx(P,{})]})},g.field_name))}),e.jsxs(Le,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(L,{type:"button",variant:"outline",children:n("form.buttons.cancel")})}),e.jsx(L,{type:"submit",disabled:c,children:n("form.buttons.submit")})]})]})})]})]})}function z({column:s,title:a,tooltip:t,className:l}){return s.getCanSort()?e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(L,{variant:"ghost",size:"default",className:y("-ml-3 flex h-8 items-center gap-2 text-nowrap font-medium hover:bg-muted/60",l),onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:[e.jsx("span",{children:a}),t&&e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(Wn,{className:"h-4 w-4 cursor-pointer text-muted-foreground"})}),e.jsx(oe,{children:t})]})}),s.getIsSorted()==="asc"?e.jsx(tn,{className:"h-4 w-4 text-foreground/70"}):s.getIsSorted()==="desc"?e.jsx(an,{className:"h-4 w-4 text-foreground/70"}):e.jsx(_c,{className:"h-4 w-4 text-muted-foreground/70 transition-colors hover:text-foreground/70"})]})})}):e.jsxs("div",{className:y("flex items-center space-x-1 text-nowrap py-2 font-medium text-muted-foreground",l),children:[e.jsx("span",{children:a}),t&&e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsx(Wn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(oe,{children:t})]})})]})}const kn=wc,Or=Cc,uu=Sc,zr=m.forwardRef(({className:s,...a},t)=>e.jsx(sr,{className:y("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));zr.displayName=sr.displayName;const Va=m.forwardRef(({className:s,...a},t)=>e.jsxs(uu,{children:[e.jsx(zr,{}),e.jsx(tr,{ref:t,className:y("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));Va.displayName=tr.displayName;const Fa=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col space-y-2 text-center sm:text-left",s),...a});Fa.displayName="AlertDialogHeader";const Ma=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Ma.displayName="AlertDialogFooter";const Oa=m.forwardRef(({className:s,...a},t)=>e.jsx(ar,{ref:t,className:y("text-lg font-semibold",s),...a}));Oa.displayName=ar.displayName;const za=m.forwardRef(({className:s,...a},t)=>e.jsx(nr,{ref:t,className:y("text-sm text-muted-foreground",s),...a}));za.displayName=nr.displayName;const $a=m.forwardRef(({className:s,...a},t)=>e.jsx(lr,{ref:t,className:y(yt(),s),...a}));$a.displayName=lr.displayName;const Aa=m.forwardRef(({className:s,...a},t)=>e.jsx(rr,{ref:t,className:y(yt({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));Aa.displayName=rr.displayName;function ls({onConfirm:s,children:a,title:t="确认操作",description:l="确定要执行此操作吗？",cancelText:n="取消",confirmText:r="确认",variant:o="default",className:c}){return e.jsxs(kn,{children:[e.jsx(Or,{asChild:!0,children:a}),e.jsxs(Va,{className:y("sm:max-w-[425px]",c),children:[e.jsxs(Fa,{children:[e.jsx(Oa,{children:t}),e.jsx(za,{children:l})]}),e.jsxs(Ma,{children:[e.jsx(Aa,{asChild:!0,children:e.jsx(L,{variant:"outline",children:n})}),e.jsx($a,{asChild:!0,children:e.jsx(L,{variant:o,onClick:s,children:r})})]})]})]})}const $r=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M11.29 15.29a2 2 0 0 0-.12.15a.8.8 0 0 0-.09.18a.6.6 0 0 0-.06.18a1.4 1.4 0 0 0 0 .2a.84.84 0 0 0 .08.38a.9.9 0 0 0 .54.54a.94.94 0 0 0 .76 0a.9.9 0 0 0 .54-.54A1 1 0 0 0 13 16a1 1 0 0 0-.29-.71a1 1 0 0 0-1.42 0M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8 8 0 0 1-8 8m0-13a3 3 0 0 0-2.6 1.5a1 1 0 1 0 1.73 1A1 1 0 0 1 12 9a1 1 0 0 1 0 2a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-.18A3 3 0 0 0 12 7"})}),xu=({refetch:s,isSortMode:a=!1})=>{const{t}=V("payment");return[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:a?"cursor-move":"opacity-0",children:e.jsx(Da,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:l})=>e.jsx(z,{column:l,title:t("table.columns.id")}),cell:({row:l})=>e.jsx(G,{variant:"outline",children:l.getValue("id")}),enableSorting:!0,size:60},{accessorKey:"enable",header:({column:l})=>e.jsx(z,{column:l,title:t("table.columns.enable")}),cell:({row:l})=>e.jsx(Z,{defaultChecked:l.getValue("enable"),onCheckedChange:async()=>{const{data:n}=await et.updateStatus({id:l.original.id});n||s()}}),enableSorting:!1,size:100},{accessorKey:"name",header:({column:l})=>e.jsx(z,{column:l,title:t("table.columns.name")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[200px] truncate font-medium",children:l.getValue("name")})}),enableSorting:!1,size:200},{accessorKey:"payment",header:({column:l})=>e.jsx(z,{column:l,title:t("table.columns.payment")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[200px] truncate font-medium",children:l.getValue("payment")})}),enableSorting:!1,size:200},{accessorKey:"notify_url",header:({column:l})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{column:l,title:t("table.columns.notify_url")}),e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{className:"ml-1",children:e.jsx($r,{className:"h-4 w-4"})}),e.jsx(oe,{children:t("table.columns.notify_url_tooltip")})]})})]}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[300px] truncate font-medium",children:l.getValue("notify_url")})}),enableSorting:!1,size:3e3},{id:"actions",header:({column:l})=>e.jsx(z,{className:"justify-end",column:l,title:t("table.columns.actions")}),cell:({row:l})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(Mr,{refetch:s,dialogTrigger:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:t("table.actions.edit")})]}),type:"edit",defaultFormValues:l.original}),e.jsx(ls,{title:t("table.actions.delete.title"),description:t("table.actions.delete.description"),onConfirm:async()=>{const{data:n}=await et.drop({id:l.original.id});n&&s()},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"}),e.jsx("span",{className:"sr-only",children:t("table.actions.delete.title")})]})})]}),size:100}]};function hu({table:s,refetch:a,saveOrder:t,isSortMode:l}){const{t:n}=V("payment"),r=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[l?e.jsx("p",{className:"text-sm text-muted-foreground",children:n("table.toolbar.sort.hint")}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mr,{refetch:a}),e.jsx(D,{placeholder:n("table.toolbar.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:o=>s.getColumn("name")?.setFilterValue(o.target.value),className:"h-8 w-[250px]"}),r&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),children:[n("table.toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(L,{variant:l?"default":"outline",onClick:t,size:"sm",children:n(l?"table.toolbar.sort.save":"table.toolbar.sort.edit")})})]})}function pu(){const[s,a]=m.useState([]),[t,l]=m.useState([]),[n,r]=m.useState(!1),[o,c]=m.useState([]),[u,i]=m.useState({"drag-handle":!1}),[d,h]=m.useState({pageSize:20,pageIndex:0}),{refetch:k}=le({queryKey:["paymentList"],queryFn:async()=>{const{data:g}=await et.getList();return c(g?.map(T=>({...T,enable:!!T.enable}))||[]),g}});m.useEffect(()=>{i({"drag-handle":n,actions:!n}),h({pageSize:n?99999:10,pageIndex:0})},[n]);const C=(g,T)=>{n&&(g.dataTransfer.setData("text/plain",T.toString()),g.currentTarget.classList.add("opacity-50"))},S=(g,T)=>{if(!n)return;g.preventDefault(),g.currentTarget.classList.remove("bg-muted");const E=parseInt(g.dataTransfer.getData("text/plain"));if(E===T)return;const p=[...o],[_]=p.splice(E,1);p.splice(T,0,_),c(p)},w=async()=>{n?et.sort({ids:o.map(g=>g.id)}).then(()=>{k(),r(!1),$.success("排序保存成功")}):r(!0)},N=Je({data:o,columns:xu({refetch:k,isSortMode:n}),state:{sorting:t,columnFilters:s,columnVisibility:u,pagination:d},onSortingChange:l,onColumnFiltersChange:a,onColumnVisibilityChange:i,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),initialState:{columnPinning:{right:["actions"]}},pageCount:n?1:void 0});return e.jsx(os,{table:N,toolbar:g=>e.jsx(hu,{table:g,refetch:k,saveOrder:w,isSortMode:n}),draggable:n,onDragStart:C,onDragEnd:g=>g.currentTarget.classList.remove("opacity-50"),onDragOver:g=>{g.preventDefault(),g.currentTarget.classList.add("bg-muted")},onDragLeave:g=>g.currentTarget.classList.remove("bg-muted"),onDrop:S,showPagination:!n})}function gu(){const{t:s}=V("payment");return e.jsxs(Ve,{children:[e.jsxs(Fe,{className:"flex items-center justify-between",children:[e.jsx(Xe,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{children:[e.jsx("header",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")})}),e.jsx("p",{className:"text-muted-foreground",children:s("description")})]})}),e.jsx("section",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(pu,{})})]})]})}const fu=Object.freeze(Object.defineProperty({__proto__:null,default:gu},Symbol.toStringTag,{value:"Module"}));function ju({pluginName:s,onClose:a,onSuccess:t}){const{t:l}=V("plugin"),[n,r]=m.useState(!0),[o,c]=m.useState(!1),[u,i]=m.useState(null),d=kc({config:Tc(Dc())}),h=Ne({resolver:we(d),defaultValues:{config:{}}});m.useEffect(()=>{(async()=>{try{const{data:w}=await Ps.getPluginConfig(s);i(w),h.reset({config:Object.fromEntries(Object.entries(w).map(([N,g])=>[N,g.value]))})}catch{$.error(l("messages.configLoadError"))}finally{r(!1)}})()},[s]);const k=async S=>{c(!0);try{await Ps.updatePluginConfig(s,S.config),$.success(l("messages.configSaveSuccess")),t()}catch{$.error(l("messages.configSaveError"))}finally{c(!1)}},C=(S,w)=>{switch(w.type){case"string":return e.jsx(v,{control:h.control,name:`config.${S}`,render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{children:w.label||w.description}),e.jsx(b,{children:e.jsx(D,{placeholder:w.placeholder,...N})}),w.description&&w.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description}),e.jsx(P,{})]})},S);case"number":case"percentage":return e.jsx(v,{control:h.control,name:`config.${S}`,render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{children:w.label||w.description}),e.jsx(b,{children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{type:"number",placeholder:w.placeholder,...N,onChange:g=>{const T=Number(g.target.value);w.type==="percentage"?N.onChange(Math.min(100,Math.max(0,T))):N.onChange(T)},className:w.type==="percentage"?"pr-8":"",min:w.type==="percentage"?0:void 0,max:w.type==="percentage"?100:void 0,step:w.type==="percentage"?1:void 0}),w.type==="percentage"&&e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx(Pc,{className:"h-4 w-4 text-muted-foreground"})})]})}),w.description&&w.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description}),e.jsx(P,{})]})},S);case"select":return e.jsx(v,{control:h.control,name:`config.${S}`,render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{children:w.label||w.description}),e.jsxs(J,{onValueChange:N.onChange,defaultValue:N.value,children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:w.placeholder})})}),e.jsx(Y,{children:w.options?.map(g=>e.jsx(A,{value:g.value,children:g.label},g.value))})]}),w.description&&w.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description}),e.jsx(P,{})]})},S);case"boolean":return e.jsx(v,{control:h.control,name:`config.${S}`,render:({field:N})=>e.jsxs(f,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{className:"text-base",children:w.label||w.description}),w.description&&w.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description})]}),e.jsx(b,{children:e.jsx(Z,{checked:N.value,onCheckedChange:N.onChange})})]})},S);case"text":return e.jsx(v,{control:h.control,name:`config.${S}`,render:({field:N})=>e.jsxs(f,{children:[e.jsx(j,{children:w.label||w.description}),e.jsx(b,{children:e.jsx(ks,{placeholder:w.placeholder,...N})}),w.description&&w.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description}),e.jsx(P,{})]})},S);default:return null}};return n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(he,{className:"h-4 w-[200px]"}),e.jsx(he,{className:"h-10 w-full"}),e.jsx(he,{className:"h-4 w-[200px]"}),e.jsx(he,{className:"h-10 w-full"})]}):e.jsx(Ce,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(k),className:"space-y-4",children:[u&&Object.entries(u).map(([S,w])=>C(S,w)),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(L,{type:"button",variant:"outline",onClick:a,disabled:o,children:l("config.cancel")}),e.jsx(L,{type:"submit",loading:o,disabled:o,children:l("config.save")})]})]})})}function vu(){const{t:s}=V("plugin"),[a,t]=m.useState(null),[l,n]=m.useState(!1),[r,o]=m.useState(null),[c,u]=m.useState(""),[i,d]=m.useState("all"),[h,k]=m.useState(!1),[C,S]=m.useState(!1),[w,N]=m.useState(!1),g=m.useRef(null),{data:T,isLoading:E,refetch:p}=le({queryKey:["pluginList"],queryFn:async()=>{const{data:R}=await Ps.getPluginList();return R}});T&&[...new Set(T.map(R=>R.category||"other"))];const _=T?.filter(R=>{const X=R.name.toLowerCase().includes(c.toLowerCase())||R.description.toLowerCase().includes(c.toLowerCase())||R.code.toLowerCase().includes(c.toLowerCase()),ms=i==="all"||R.category===i;return X&&ms}),I=async R=>{t(R),Ps.installPlugin(R).then(()=>{$.success(s("messages.installSuccess")),p()}).catch(X=>{$.error(X.message||s("messages.installError"))}).finally(()=>{t(null)})},H=async R=>{t(R),Ps.uninstallPlugin(R).then(()=>{$.success(s("messages.uninstallSuccess")),p()}).catch(X=>{$.error(X.message||s("messages.uninstallError"))}).finally(()=>{t(null)})},O=async(R,X)=>{t(R),(X?Ps.disablePlugin:Ps.enablePlugin)(R).then(()=>{$.success(s(X?"messages.disableSuccess":"messages.enableSuccess")),p()}).catch(Te=>{$.error(Te.message||s(X?"messages.disableError":"messages.enableError"))}).finally(()=>{t(null)})},B=R=>{T?.find(X=>X.code===R),o(R),n(!0)},ue=async R=>{if(!R.name.endsWith(".zip")){$.error(s("upload.error.format"));return}k(!0),Ps.uploadPlugin(R).then(()=>{$.success(s("messages.uploadSuccess")),S(!1),p()}).catch(X=>{$.error(X.message||s("messages.uploadError"))}).finally(()=>{k(!1),g.current&&(g.current.value="")})},ee=R=>{R.preventDefault(),R.stopPropagation(),R.type==="dragenter"||R.type==="dragover"?N(!0):R.type==="dragleave"&&N(!1)},te=R=>{R.preventDefault(),R.stopPropagation(),N(!1),R.dataTransfer.files&&R.dataTransfer.files[0]&&ue(R.dataTransfer.files[0])},q=async R=>{t(R),Ps.deletePlugin(R).then(()=>{$.success(s("messages.deleteSuccess")),p()}).catch(X=>{$.error(X.message||s("messages.deleteError"))}).finally(()=>{t(null)})};return e.jsxs(Ve,{children:[e.jsxs(Fe,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(gn,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s("title")})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{children:[e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"relative max-w-sm flex-1",children:[e.jsx(fn,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(D,{placeholder:s("search.placeholder"),value:c,onChange:R=>u(R.target.value),className:"pl-9"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(L,{onClick:()=>S(!0),variant:"outline",className:"shrink-0",size:"sm",children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"}),s("upload.button")]})})]}),e.jsxs(Wt,{defaultValue:"all",className:"w-full",children:[e.jsxs(kt,{children:[e.jsx(es,{value:"all",children:s("tabs.all")}),e.jsx(es,{value:"installed",children:s("tabs.installed")}),e.jsx(es,{value:"available",children:s("tabs.available")})]}),e.jsx(Ls,{value:"all",className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Ja,{}),e.jsx(Ja,{}),e.jsx(Ja,{})]}):_?.map(R=>e.jsx(Ya,{plugin:R,onInstall:I,onUninstall:H,onToggleEnable:O,onOpenConfig:B,onDelete:q,isLoading:a===R.name},R.name))})}),e.jsx(Ls,{value:"installed",className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:_?.filter(R=>R.is_installed).map(R=>e.jsx(Ya,{plugin:R,onInstall:I,onUninstall:H,onToggleEnable:O,onOpenConfig:B,onDelete:q,isLoading:a===R.name},R.name))})}),e.jsx(Ls,{value:"available",className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:_?.filter(R=>!R.is_installed).map(R=>e.jsx(Ya,{plugin:R,onInstall:I,onUninstall:H,onToggleEnable:O,onOpenConfig:B,onDelete:q,isLoading:a===R.name},R.code))})})]})]}),e.jsx(ge,{open:l,onOpenChange:n,children:e.jsxs(pe,{className:"sm:max-w-lg",children:[e.jsxs(ve,{children:[e.jsxs(fe,{children:[T?.find(R=>R.code===r)?.name," ",s("config.title")]}),e.jsx(Re,{children:s("config.description")})]}),r&&e.jsx(ju,{pluginName:r,onClose:()=>n(!1),onSuccess:()=>{n(!1),p()}})]})}),e.jsx(ge,{open:C,onOpenChange:S,children:e.jsxs(pe,{className:"sm:max-w-md",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:s("upload.title")}),e.jsx(Re,{children:s("upload.description")})]}),e.jsxs("div",{className:y("relative mt-4 flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 px-5 py-10 text-center transition-colors",w&&"border-primary/50 bg-muted/50"),onDragEnter:ee,onDragLeave:ee,onDragOver:ee,onDrop:te,children:[e.jsx("input",{type:"file",ref:g,className:"hidden",accept:".zip",onChange:R=>{const X=R.target.files?.[0];X&&ue(X)}}),h?e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("upload.uploading")})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full border-2 border-muted-foreground/25 p-3",children:e.jsx(Kt,{className:"h-6 w-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s("upload.dragText")," ",e.jsx("button",{type:"button",onClick:()=>g.current?.click(),className:"mx-1 text-primary hover:underline",children:s("upload.clickText")})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("upload.supportText")})]})]})})]})]})})]})]})}function Ya({plugin:s,onInstall:a,onUninstall:t,onToggleEnable:l,onOpenConfig:n,onDelete:r,isLoading:o}){const{t:c}=V("plugin");return e.jsxs(Ye,{className:"group relative overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(ts,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{children:s.name}),s.is_installed&&e.jsx(G,{variant:s.is_enabled?"success":"secondary",children:s.is_enabled?c("status.enabled"):c("status.disabled")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(gn,{className:"h-4 w-4"}),e.jsx("code",{className:"rounded bg-muted px-1 py-0.5",children:s.code})]}),e.jsxs("div",{children:["v",s.version]})]})]})}),e.jsx(st,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"mt-2",children:s.description}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[c("author"),": ",s.author]})})]})})]}),e.jsx(as,{children:e.jsx("div",{className:"flex items-center justify-end space-x-2",children:s.is_installed?e.jsxs(e.Fragment,{children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>n(s.code),disabled:!s.is_enabled||o,children:[e.jsx(Lc,{className:"mr-2 h-4 w-4"}),c("button.config")]}),e.jsxs(L,{variant:s.is_enabled?"destructive":"default",size:"sm",onClick:()=>l(s.code,s.is_enabled),disabled:o,children:[e.jsx(Ec,{className:"mr-2 h-4 w-4"}),s.is_enabled?c("button.disable"):c("button.enable")]}),e.jsx(ls,{title:c("uninstall.title"),description:c("uninstall.description"),cancelText:c("common:cancel"),confirmText:c("uninstall.button"),variant:"destructive",onConfirm:()=>t(s.code),children:e.jsxs(L,{variant:"outline",size:"sm",className:"text-muted-foreground hover:text-destructive",disabled:o,children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),c("button.uninstall")]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{onClick:()=>a(s.code),disabled:o,loading:o,children:c("button.install")}),e.jsx(ls,{title:c("delete.title"),description:c("delete.description"),cancelText:c("common:cancel"),confirmText:c("delete.button"),variant:"destructive",onConfirm:()=>r(s.code),children:e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",disabled:o,children:e.jsx(We,{className:"h-4 w-4"})})})]})})})]})}function Ja(){return e.jsxs(Ye,{children:[e.jsxs(ts,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-6 w-[200px]"}),e.jsx(he,{className:"h-6 w-[80px]"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(he,{className:"h-5 w-[120px]"}),e.jsx(he,{className:"h-5 w-[60px]"})]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(he,{className:"h-4 w-[300px]"}),e.jsx(he,{className:"h-4 w-[150px]"})]})]}),e.jsx(as,{children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(he,{className:"h-9 w-[100px]"}),e.jsx(he,{className:"h-9 w-[100px]"}),e.jsx(he,{className:"h-8 w-8"})]})})]})}const bu=Object.freeze(Object.defineProperty({__proto__:null,default:vu},Symbol.toStringTag,{value:"Module"})),yu=(s,a)=>{let t=null;switch(s.field_type){case"input":t=e.jsx(D,{placeholder:s.placeholder,...a});break;case"textarea":t=e.jsx(ks,{placeholder:s.placeholder,...a});break;case"select":t=e.jsx("select",{className:y(yt({variant:"outline"}),"w-full appearance-none font-normal"),...a,children:s.select_options&&Object.keys(s.select_options).map(l=>e.jsx("option",{value:l,children:s.select_options?.[l]},l))});break;default:t=null;break}return t};function Nu({themeKey:s,themeInfo:a}){const{t}=V("theme"),[l,n]=m.useState(!1),[r,o]=m.useState(!1),[c,u]=m.useState(!1),i=Ne({defaultValues:a.configs.reduce((k,C)=>(k[C.field_name]="",k),{})}),d=async()=>{o(!0),At.getConfig(s).then(({data:k})=>{Object.entries(k).forEach(([C,S])=>{i.setValue(C,S)})}).finally(()=>{o(!1)})},h=async k=>{u(!0),At.updateConfig(s,k).then(()=>{$.success(t("config.success")),n(!1)}).finally(()=>{u(!1)})};return e.jsxs(ge,{open:l,onOpenChange:k=>{n(k),k?d():i.reset()},children:[e.jsx(is,{asChild:!0,children:e.jsx(L,{variant:"outline",children:t("card.configureTheme")})}),e.jsxs(pe,{className:"max-h-[90vh] overflow-auto sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:t("config.title",{name:a.name})}),e.jsx(Re,{children:t("config.description")})]}),r?e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(fa,{className:"h-6 w-6 animate-spin"})}):e.jsx(Ce,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(h),className:"space-y-4",children:[a.configs.map(k=>e.jsx(v,{control:i.control,name:k.field_name,render:({field:C})=>e.jsxs(f,{children:[e.jsx(j,{children:k.label}),e.jsx(b,{children:yu(k,C)}),e.jsx(P,{})]})},k.field_name)),e.jsxs(Le,{className:"mt-6 gap-2",children:[e.jsx(L,{type:"button",variant:"secondary",onClick:()=>n(!1),children:t("config.cancel")}),e.jsx(L,{type:"submit",loading:c,children:t("config.save")})]})]})})]})]})}function _u(){const{t:s}=V("theme"),[a,t]=m.useState(null),[l,n]=m.useState(!1),[r,o]=m.useState(!1),[c,u]=m.useState(!1),[i,d]=m.useState(null),h=m.useRef(null),[k,C]=m.useState(0),{data:S,isLoading:w,refetch:N}=le({queryKey:["themeList"],queryFn:async()=>{const{data:O}=await At.getList();return O}}),g=async O=>{t(O),ce.updateSystemConfig({frontend_theme:O}).then(()=>{$.success("主题切换成功"),N()}).finally(()=>{t(null)})},T=async O=>{if(!O.name.endsWith(".zip")){$.error(s("upload.error.format"));return}n(!0),At.upload(O).then(()=>{$.success("主题上传成功"),o(!1),N()}).finally(()=>{n(!1),h.current&&(h.current.value="")})},E=O=>{O.preventDefault(),O.stopPropagation(),O.type==="dragenter"||O.type==="dragover"?u(!0):O.type==="dragleave"&&u(!1)},p=O=>{O.preventDefault(),O.stopPropagation(),u(!1),O.dataTransfer.files&&O.dataTransfer.files[0]&&T(O.dataTransfer.files[0])},_=()=>{i&&C(O=>O===0?i.images.length-1:O-1)},I=()=>{i&&C(O=>O===i.images.length-1?0:O+1)},H=(O,B)=>{C(0),d({name:O,images:B})};return e.jsxs(Ve,{children:[e.jsxs(Fe,{className:"flex items-center justify-between",children:[e.jsx(Xe,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s("title")})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-muted-foreground",children:s("description")}),e.jsxs(L,{onClick:()=>o(!0),variant:"outline",className:"ml-4 shrink-0",size:"sm",children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"}),s("upload.button")]})]})]}),e.jsx("section",{className:"grid gap-6 md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3",children:w?e.jsxs(e.Fragment,{children:[e.jsx(nl,{}),e.jsx(nl,{})]}):S?.themes&&Object.entries(S.themes).map(([O,B])=>e.jsx(Ye,{className:"group relative overflow-hidden transition-all hover:shadow-md",style:{backgroundImage:B.background_url?`url(${B.background_url})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsxs("div",{className:y("relative z-10 h-full transition-colors",B.background_url?"group-hover:from-background/98 bg-gradient-to-t from-background/95 via-background/80 to-background/60 backdrop-blur-[1px] group-hover:via-background/90 group-hover:to-background/70":"bg-background"),children:[!!B.can_delete&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(ls,{title:s("card.delete.title"),description:s("card.delete.description"),confirmText:s("card.delete.button"),variant:"destructive",onConfirm:async()=>{if(O===S?.active){$.error(s("card.delete.error.active"));return}t(O),At.drop(O).then(()=>{$.success("主题删除成功"),N()}).finally(()=>{t(null)})},children:e.jsx(L,{disabled:a===O,loading:a===O,variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(We,{className:"h-4 w-4"})})})}),e.jsxs(ts,{children:[e.jsx(Ns,{children:B.name}),e.jsx(st,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:B.description}),B.version&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("card.version",{version:B.version})})]})})]}),e.jsxs(as,{className:"flex items-center justify-end space-x-3",children:[B.images&&Array.isArray(B.images)&&B.images.length>0&&e.jsx(L,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>H(B.name,B.images),children:e.jsx(Ic,{className:"h-4 w-4"})}),e.jsx(Nu,{themeKey:O,themeInfo:B}),e.jsx(L,{onClick:()=>g(O),disabled:a===O||O===S.active,loading:a===O,variant:O===S.active?"secondary":"default",children:O===S.active?s("card.currentTheme"):s("card.activateTheme")})]})]})},O))}),e.jsx(ge,{open:r,onOpenChange:o,children:e.jsxs(pe,{className:"sm:max-w-md",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:s("upload.title")}),e.jsx(Re,{children:s("upload.description")})]}),e.jsxs("div",{className:y("relative mt-4 flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 px-5 py-10 text-center transition-colors",c&&"border-primary/50 bg-muted/50"),onDragEnter:E,onDragLeave:E,onDragOver:E,onDrop:p,children:[e.jsx("input",{type:"file",ref:h,className:"hidden",accept:".zip",onChange:O=>{const B=O.target.files?.[0];B&&T(B)}}),l?e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("upload.uploading")})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full border-2 border-muted-foreground/25 p-3",children:e.jsx(Kt,{className:"h-6 w-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s("upload.dragText")," ",e.jsx("button",{type:"button",onClick:()=>h.current?.click(),className:"mx-1 text-primary hover:underline",children:s("upload.clickText")})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("upload.supportText")})]})]})})]})]})}),e.jsx(ge,{open:!!i,onOpenChange:O=>{O||(d(null),C(0))},children:e.jsxs(pe,{className:"max-w-4xl",children:[e.jsxs(ve,{children:[e.jsxs(fe,{children:[i?.name," ",s("preview.title")]}),e.jsx(Re,{className:"text-center",children:i&&s("preview.imageCount",{current:k+1,total:i.images.length})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-[16/9] overflow-hidden rounded-lg border bg-muted",children:i?.images[k]&&e.jsx("img",{src:i.images[k],alt:`${i.name} 预览图 ${k+1}`,className:"h-full w-full object-contain"})}),i&&i.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"outline",size:"icon",className:"absolute left-4 top-1/2 h-8 w-8 -translate-y-1/2 rounded-full bg-background/80 hover:bg-background",onClick:_,children:e.jsx(Rc,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"icon",className:"absolute right-4 top-1/2 h-8 w-8 -translate-y-1/2 rounded-full bg-background/80 hover:bg-background",onClick:I,children:e.jsx(Vc,{className:"h-4 w-4"})})]})]}),i&&i.images.length>1&&e.jsx("div",{className:"mt-4 flex gap-2 overflow-x-auto pb-2",children:i.images.map((O,B)=>e.jsx("button",{onClick:()=>C(B),className:y("relative h-16 w-16 flex-shrink-0 overflow-hidden rounded-md border-2",k===B?"border-primary":"border-transparent"),children:e.jsx("img",{src:O,alt:`缩略图 ${B+1}`,className:"h-full w-full object-cover"})},B))})]})})]})]})}function nl(){return e.jsxs(Ye,{children:[e.jsxs(ts,{children:[e.jsx(he,{className:"h-6 w-[200px]"}),e.jsx(he,{className:"h-4 w-[300px]"})]}),e.jsxs(as,{className:"flex items-center justify-end space-x-3",children:[e.jsx(he,{className:"h-10 w-[100px]"}),e.jsx(he,{className:"h-10 w-[100px]"})]})]})}const wu=Object.freeze(Object.defineProperty({__proto__:null,default:_u},Symbol.toStringTag,{value:"Module"})),Tn=m.forwardRef(({className:s,value:a,onChange:t,...l},n)=>{const[r,o]=m.useState("");m.useEffect(()=>{if(r.includes(",")){const u=new Set([...a,...r.split(",").map(i=>i.trim())]);t(Array.from(u)),o("")}},[r,t,a]);const c=()=>{if(r){const u=new Set([...a,r]);t(Array.from(u)),o("")}};return e.jsxs("div",{className:y(" has-[:focus-visible]:outline-none has-[:focus-visible]:ring-1 has-[:focus-visible]:ring-neutral-950  dark:has-[:focus-visible]:ring-neutral-300  flex w-full flex-wrap gap-2 rounded-md border border-input shadow-sm px-3 py-2 text-sm ring-offset-white  disabled:cursor-not-allowed disabled:opacity-50",s),children:[a.map(u=>e.jsxs(G,{variant:"secondary",children:[u,e.jsx(K,{variant:"ghost",size:"icon",className:"ml-2 h-3 w-3",onClick:()=>{t(a.filter(i=>i!==u))},children:e.jsx(rn,{className:"w-3"})})]},u)),e.jsx("input",{className:"flex-1 outline-none placeholder:text-muted-foreground bg-transparent",value:r,onChange:u=>o(u.target.value),onKeyDown:u=>{u.key==="Enter"||u.key===","?(u.preventDefault(),c()):u.key==="Backspace"&&r.length===0&&a.length>0&&(u.preventDefault(),t(a.slice(0,-1)))},...l,ref:n})]})});Tn.displayName="InputTags";const Cu=x.object({id:x.number().nullable(),title:x.string().min(1).max(250),content:x.string().min(1),show:x.boolean(),tags:x.array(x.string()),img_url:x.string().nullable()}),Su={id:null,show:!1,tags:[],img_url:"",title:"",content:""};function Ar({refetch:s,dialogTrigger:a,type:t="add",defaultFormValues:l=Su}){const{t:n}=V("notice"),[r,o]=m.useState(!1),c=Ne({resolver:we(Cu),defaultValues:l,mode:"onChange",shouldFocusError:!0}),u=new vn({html:!0});return e.jsx(Ce,{...c,children:e.jsxs(ge,{onOpenChange:o,open:r,children:[e.jsx(is,{asChild:!0,children:a||e.jsxs(L,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(ze,{icon:"ion:add"})," ",e.jsx("div",{children:n("form.add.button")})]})}),e.jsxs(pe,{className:"sm:max-w-[1025px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:n(t==="add"?"form.add.title":"form.edit.title")}),e.jsx(Re,{})]}),e.jsx(v,{control:c.control,name:"title",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.title.label")}),e.jsx("div",{className:"relative ",children:e.jsx(b,{children:e.jsx(D,{placeholder:n("form.fields.title.placeholder"),...i})})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"content",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.content.label")}),e.jsx(b,{children:e.jsx(bn,{style:{height:"500px"},value:i.value,renderHTML:d=>u.render(d),onChange:({text:d})=>{i.onChange(d)}})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"img_url",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.img_url.label")}),e.jsx("div",{className:"relative",children:e.jsx(b,{children:e.jsx(D,{type:"text",placeholder:n("form.fields.img_url.placeholder"),...i,value:i.value||""})})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"show",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.show.label")}),e.jsx("div",{className:"relative py-2",children:e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:i.onChange})})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"tags",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.fields.tags.label")}),e.jsx(b,{children:e.jsx(Tn,{value:i.value,onChange:i.onChange,placeholder:n("form.fields.tags.placeholder"),className:"w-full"})}),e.jsx(P,{})]})}),e.jsxs(Le,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(L,{type:"button",variant:"outline",children:n("form.buttons.cancel")})}),e.jsx(L,{type:"submit",onClick:i=>{i.preventDefault(),c.handleSubmit(async d=>{Gt.save(d).then(({data:h})=>{h&&($.success(n("form.buttons.success")),s(),o(!1))})})()},children:n("form.buttons.submit")})]})]})]})})}function ku({table:s,refetch:a,saveOrder:t,isSortMode:l}){const{t:n}=V("notice"),r=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between space-x-2 ",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[!l&&e.jsx(Ar,{refetch:a}),!l&&e.jsx(D,{placeholder:n("table.toolbar.search"),value:s.getColumn("title")?.getFilterValue()??"",onChange:o=>s.getColumn("title")?.setFilterValue(o.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),r&&!l&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-9 px-2 lg:px-3",children:[n("table.toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(L,{variant:l?"default":"outline",onClick:t,className:"h-8",size:"sm",children:n(l?"table.toolbar.sort.save":"table.toolbar.sort.edit")})})]})}const Tu=s=>{const{t:a}=V("notice");return[{id:"drag-handle",header:"",cell:()=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Fc,{className:"h-4 w-4 cursor-move text-muted-foreground"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.id")}),cell:({row:t})=>e.jsx(G,{variant:"outline",className:"font-mono",children:t.getValue("id")}),enableSorting:!0,size:60},{accessorKey:"show",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.show")}),cell:({row:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx(Z,{defaultChecked:t.getValue("show"),onCheckedChange:async()=>{const{data:l}=await Gt.updateStatus(t.original.id);l||s()}})}),enableSorting:!1,size:100},{accessorKey:"title",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.title")}),cell:({row:t})=>e.jsx("div",{className:"flex max-w-[500px] items-center",children:e.jsx("span",{className:"truncate font-medium",children:t.getValue("title")})}),enableSorting:!1,size:6e3},{id:"actions",header:({column:t})=>e.jsx(z,{className:"justify-end",column:t,title:a("table.columns.actions")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(Ar,{refetch:s,dialogTrigger:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("table.actions.edit")})]}),type:"edit",defaultFormValues:t.original}),e.jsx(ls,{title:a("table.actions.delete.title"),description:a("table.actions.delete.description"),onConfirm:async()=>{Gt.drop(t.original.id).then(()=>{$.success(a("table.actions.delete.success")),s()})},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:a("table.actions.delete.title")})]})})]}),size:100}]};function Du(){const[s,a]=m.useState({}),[t,l]=m.useState({}),[n,r]=m.useState([]),[o,c]=m.useState([]),[u,i]=m.useState(!1),[d,h]=m.useState({}),[k,C]=m.useState({pageSize:50,pageIndex:0}),[S,w]=m.useState([]),{refetch:N}=le({queryKey:["notices"],queryFn:async()=>{const{data:_}=await Gt.getList();return w(_),_}});m.useEffect(()=>{l({"drag-handle":u,content:!u,created_at:!u,actions:!u}),C({pageSize:u?99999:50,pageIndex:0})},[u]);const g=(_,I)=>{u&&(_.dataTransfer.setData("text/plain",I.toString()),_.currentTarget.classList.add("opacity-50"))},T=(_,I)=>{if(!u)return;_.preventDefault(),_.currentTarget.classList.remove("bg-muted");const H=parseInt(_.dataTransfer.getData("text/plain"));if(H===I)return;const O=[...S],[B]=O.splice(H,1);O.splice(I,0,B),w(O)},E=async()=>{if(!u){i(!0);return}Gt.sort(S.map(_=>_.id)).then(()=>{$.success("排序保存成功"),i(!1),N()}).finally(()=>{i(!1)})},p=Je({data:S??[],columns:Tu(N),state:{sorting:o,columnVisibility:t,rowSelection:s,columnFilters:n,columnSizing:d,pagination:k},enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:c,onColumnFiltersChange:r,onColumnVisibilityChange:l,onColumnSizingChange:h,onPaginationChange:C,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx("div",{className:"space-y-4",children:e.jsx(os,{table:p,toolbar:_=>e.jsx(ku,{table:_,refetch:N,saveOrder:E,isSortMode:u}),draggable:u,onDragStart:g,onDragEnd:_=>_.currentTarget.classList.remove("opacity-50"),onDragOver:_=>{_.preventDefault(),_.currentTarget.classList.add("bg-muted")},onDragLeave:_=>_.currentTarget.classList.remove("bg-muted"),onDrop:T,showPagination:!u})})}function Pu(){const{t:s}=V("notice");return e.jsxs(Ve,{children:[e.jsxs(Fe,{className:"flex items-center justify-between",children:[e.jsx(Xe,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")})}),e.jsx("p",{className:"text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Du,{})})]})]})}const Lu=Object.freeze(Object.defineProperty({__proto__:null,default:Pu},Symbol.toStringTag,{value:"Module"})),Eu=x.object({id:x.number().nullable(),language:x.string().max(250),category:x.string().max(250),title:x.string().min(1).max(250),body:x.string().min(1),show:x.boolean()}),Iu={id:null,language:"zh-CN",category:"",title:"",body:"",show:!1};function qr({refreshData:s,dialogTrigger:a,type:t="add",defaultFormValues:l=Iu}){const{t:n}=V("knowledge"),[r,o]=m.useState(!1),c=Ne({resolver:we(Eu),defaultValues:l,mode:"onChange",shouldFocusError:!0}),u=new vn({html:!0});return m.useEffect(()=>{r&&l.id&&bt.getInfo(l.id).then(({data:i})=>{c.reset(i)})},[l.id,c,r]),e.jsxs(ge,{onOpenChange:o,open:r,children:[e.jsx(is,{asChild:!0,children:a||e.jsxs(L,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(ze,{icon:"ion:add"})," ",e.jsx("div",{children:n("form.add")})]})}),e.jsxs(pe,{className:"sm:max-w-[1025px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:n(t==="add"?"form.add":"form.edit")}),e.jsx(Re,{})]}),e.jsxs(Ce,{...c,children:[e.jsx(v,{control:c.control,name:"title",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.title")}),e.jsx("div",{className:"relative ",children:e.jsx(b,{children:e.jsx(D,{placeholder:n("form.titlePlaceholder"),...i})})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"category",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.category")}),e.jsx("div",{className:"relative ",children:e.jsx(b,{children:e.jsx(D,{placeholder:n("form.categoryPlaceholder"),...i})})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"language",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.language")}),e.jsx(b,{children:e.jsxs(J,{value:i.value,onValueChange:i.onChange,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:n("form.languagePlaceholder")})}),e.jsx(Y,{children:[{value:"en-US"},{value:"ja-JP"},{value:"ko-KR"},{value:"vi-VN"},{value:"zh-CN"},{value:"zh-TW"}].map(d=>e.jsx(A,{value:d.value,className:"cursor-pointer",children:n(`languages.${d.value}`)},d.value))})]})})]})}),e.jsx(v,{control:c.control,name:"body",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.content")}),e.jsx(b,{children:e.jsx(bn,{style:{height:"500px"},value:i.value,renderHTML:d=>u.render(d),onChange:({text:d})=>{i.onChange(d)}})}),e.jsx(P,{})]})}),e.jsx(v,{control:c.control,name:"show",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.show")}),e.jsx("div",{className:"relative py-2",children:e.jsx(b,{children:e.jsx(Z,{checked:i.value,onCheckedChange:i.onChange})})}),e.jsx(P,{})]})}),e.jsxs(Le,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(L,{type:"button",variant:"outline",children:n("form.cancel")})}),e.jsx(L,{type:"submit",onClick:()=>{c.handleSubmit(i=>{bt.save(i).then(({data:d})=>{d&&(c.reset(),$.success(n("messages.operationSuccess")),o(!1),s())})})()},children:n("form.submit")})]})]})]})]})}function Ru({column:s,title:a,options:t}){const l=s?.getFacetedUniqueValues(),n=new Set(s?.getFilterValue());return e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Pa,{className:"mr-2 h-4 w-4"}),a,n?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?e.jsxs(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):t.filter(r=>n.has(r.value)).map(r=>e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},r.value))})]})]})}),e.jsx(bs,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Us,{children:[e.jsx(it,{placeholder:a}),e.jsxs(Ks,{children:[e.jsx(ot,{children:"No results found."}),e.jsx(ns,{children:t.map(r=>{const o=n.has(r.value);return e.jsxs($e,{onSelect:()=>{o?n.delete(r.value):n.add(r.value);const c=Array.from(n);s?.setFilterValue(c.length?c:void 0)},children:[e.jsx("div",{className:y("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(at,{className:y("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.label}),l?.get(r.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(r.value)})]},r.value)})}),n.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{}),e.jsx(ns,{children:e.jsx($e,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function Vu({table:s,refetch:a,saveOrder:t,isSortMode:l}){const n=s.getState().columnFilters.length>0,{t:r}=V("knowledge");return e.jsxs("div",{className:"flex items-center justify-between",children:[l?e.jsx("p",{className:"text-sm text-muted-foreground",children:r("toolbar.sortModeHint")}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qr,{refreshData:a}),e.jsx(D,{placeholder:r("toolbar.searchPlaceholder"),value:s.getColumn("title")?.getFilterValue()??"",onChange:o=>s.getColumn("title")?.setFilterValue(o.target.value),className:"h-8 w-[250px]"}),s.getColumn("category")&&e.jsx(Ru,{column:s.getColumn("category"),title:r("columns.category"),options:Array.from(new Set(s.getCoreRowModel().rows.map(o=>o.getValue("category")))).map(o=>({label:o,value:o}))}),n&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),children:[r("toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(L,{variant:l?"default":"outline",onClick:t,size:"sm",children:r(l?"toolbar.saveSort":"toolbar.editSort")})})]})}const Fu=({refetch:s,isSortMode:a=!1})=>{const{t}=V("knowledge");return[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:a?"cursor-move":"opacity-0",children:e.jsx(Da,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:l})=>e.jsx(z,{column:l,title:t("columns.id")}),cell:({row:l})=>e.jsx(G,{variant:"outline",className:"justify-center",children:l.getValue("id")}),enableSorting:!0,size:70},{accessorKey:"show",header:({column:l})=>e.jsx(z,{column:l,title:t("columns.status")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx(Z,{defaultChecked:l.getValue("show"),onCheckedChange:async()=>{bt.updateStatus({id:l.original.id}).then(({data:n})=>{n||s()})}})}),enableSorting:!1,size:100},{accessorKey:"title",header:({column:l})=>e.jsx(z,{column:l,title:t("columns.title")}),cell:({row:l})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"line-clamp-2 font-medium",children:l.getValue("title")})}),enableSorting:!0,size:600},{accessorKey:"category",header:({column:l})=>e.jsx(z,{column:l,title:t("columns.category")}),cell:({row:l})=>e.jsx(G,{variant:"secondary",className:"max-w-[180px] truncate",children:l.getValue("category")}),enableSorting:!0,size:1800},{id:"actions",header:({column:l})=>e.jsx(z,{className:"justify-end",column:l,title:t("columns.actions")}),cell:({row:l})=>e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx(qr,{refreshData:s,dialogTrigger:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:t("form.edit")})]}),type:"edit",defaultFormValues:l.original}),e.jsx(ls,{title:t("messages.deleteConfirm"),description:t("messages.deleteDescription"),confirmText:t("messages.deleteButton"),variant:"destructive",onConfirm:async()=>{bt.drop({id:l.original.id}).then(({data:n})=>{n&&($.success(t("messages.operationSuccess")),s())})},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:t("messages.deleteButton")})]})})]}),size:100}]};function Mu(){const[s,a]=m.useState([]),[t,l]=m.useState([]),[n,r]=m.useState(!1),[o,c]=m.useState([]),[u,i]=m.useState({"drag-handle":!1}),[d,h]=m.useState({pageSize:20,pageIndex:0}),{refetch:k,isLoading:C,data:S}=le({queryKey:["knowledge"],queryFn:async()=>{const{data:E}=await bt.getList();return c(E||[]),E}});m.useEffect(()=>{i({"drag-handle":n,actions:!n}),h({pageSize:n?99999:10,pageIndex:0})},[n]);const w=(E,p)=>{n&&(E.dataTransfer.setData("text/plain",p.toString()),E.currentTarget.classList.add("opacity-50"))},N=(E,p)=>{if(!n)return;E.preventDefault(),E.currentTarget.classList.remove("bg-muted");const _=parseInt(E.dataTransfer.getData("text/plain"));if(_===p)return;const I=[...o],[H]=I.splice(_,1);I.splice(p,0,H),c(I)},g=async()=>{n?bt.sort({ids:o.map(E=>E.id)}).then(()=>{k(),r(!1),$.success("排序保存成功")}):r(!0)},T=Je({data:o,columns:Fu({refetch:k,isSortMode:n}),state:{sorting:t,columnFilters:s,columnVisibility:u,pagination:d},onSortingChange:l,onColumnFiltersChange:a,onColumnVisibilityChange:i,onPaginationChange:h,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(os,{table:T,toolbar:E=>e.jsx(Vu,{table:E,refetch:k,saveOrder:g,isSortMode:n}),draggable:n,onDragStart:w,onDragEnd:E=>E.currentTarget.classList.remove("opacity-50"),onDragOver:E=>{E.preventDefault(),E.currentTarget.classList.add("bg-muted")},onDragLeave:E=>E.currentTarget.classList.remove("bg-muted"),onDrop:N,showPagination:!n})}function Ou(){const{t:s}=V("knowledge");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight mb-2",children:s("title")}),e.jsx("p",{className:"text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Mu,{})})]})]})}const zu=Object.freeze(Object.defineProperty({__proto__:null,default:Ou},Symbol.toStringTag,{value:"Module"}));function $u(s,a){const[t,l]=m.useState(s);return m.useEffect(()=>{const n=setTimeout(()=>l(s),a);return()=>{clearTimeout(n)}},[s,a]),t}function Qa(s,a){if(s.length===0)return{};if(!a)return{"":s};const t={};return s.forEach(l=>{const n=l[a]||"";t[n]||(t[n]=[]),t[n].push(l)}),t}function Au(s,a){const t=JSON.parse(JSON.stringify(s));for(const[l,n]of Object.entries(t))t[l]=n.filter(r=>!a.find(o=>o.value===r.value));return t}function qu(s,a){for(const[,t]of Object.entries(s))if(t.some(l=>a.find(n=>n.value===l.value)))return!0;return!1}const Hr=m.forwardRef(({className:s,...a},t)=>Mc(n=>n.filtered.count===0)?e.jsx("div",{ref:t,className:y("py-6 text-center text-sm",s),"cmdk-empty":"",role:"presentation",...a}):null);Hr.displayName="CommandEmpty";const wt=m.forwardRef(({value:s,onChange:a,placeholder:t,defaultOptions:l=[],options:n,delay:r,onSearch:o,loadingIndicator:c,emptyIndicator:u,maxSelected:i=Number.MAX_SAFE_INTEGER,onMaxSelected:d,hidePlaceholderWhenSelected:h,disabled:k,groupBy:C,className:S,badgeClassName:w,selectFirstItem:N=!0,creatable:g=!1,triggerSearchOnFocus:T=!1,commandProps:E,inputProps:p,hideClearAllButton:_=!1},I)=>{const H=m.useRef(null),[O,B]=m.useState(!1),ue=m.useRef(!1),[ee,te]=m.useState(!1),[q,R]=m.useState(s||[]),[X,ms]=m.useState(Qa(l,C)),[Te,re]=m.useState(""),us=$u(Te,r||500);m.useImperativeHandle(I,()=>({selectedValue:[...q],input:H.current,focus:()=>H.current?.focus()}),[q]);const Ts=m.useCallback(se=>{const xe=q.filter(ae=>ae.value!==se.value);R(xe),a?.(xe)},[a,q]),Bs=m.useCallback(se=>{const xe=H.current;xe&&((se.key==="Delete"||se.key==="Backspace")&&xe.value===""&&q.length>0&&(q[q.length-1].fixed||Ts(q[q.length-1])),se.key==="Escape"&&xe.blur())},[Ts,q]);m.useEffect(()=>{s&&R(s)},[s]),m.useEffect(()=>{if(!n||o)return;const se=Qa(n||[],C);JSON.stringify(se)!==JSON.stringify(X)&&ms(se)},[l,n,C,o,X]),m.useEffect(()=>{const se=async()=>{te(!0);const ae=await o?.(us);ms(Qa(ae||[],C)),te(!1)};(async()=>{!o||!O||(T&&await se(),us&&await se())})()},[us,C,O,T]);const Dt=()=>{if(!g||qu(X,[{value:Te,label:Te}])||q.find(xe=>xe.value===Te))return;const se=e.jsx($e,{value:Te,className:"cursor-pointer",onMouseDown:xe=>{xe.preventDefault(),xe.stopPropagation()},onSelect:xe=>{if(q.length>=i){d?.(q.length);return}re("");const ae=[...q,{value:xe,label:xe}];R(ae),a?.(ae)},children:`Create "${Te}"`});if(!o&&Te.length>0||o&&us.length>0&&!ee)return se},Yt=m.useCallback(()=>{if(u)return o&&!g&&Object.keys(X).length===0?e.jsx($e,{value:"-",disabled:!0,children:u}):e.jsx(Hr,{children:u})},[g,u,o,X]),Pt=m.useMemo(()=>Au(X,q),[X,q]),Ms=m.useCallback(()=>{if(E?.filter)return E.filter;if(g)return(se,xe)=>se.toLowerCase().includes(xe.toLowerCase())?1:-1},[g,E?.filter]),Ha=m.useCallback(()=>{const se=q.filter(xe=>xe.fixed);R(se),a?.(se)},[a,q]);return e.jsxs(Us,{...E,onKeyDown:se=>{Bs(se),E?.onKeyDown?.(se)},className:y("h-auto overflow-visible bg-transparent",E?.className),shouldFilter:E?.shouldFilter!==void 0?E.shouldFilter:!o,filter:Ms(),children:[e.jsx("div",{className:y("rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring ",{"px-3 py-2":q.length!==0,"cursor-text":!k&&q.length!==0},S),onClick:()=>{k||H.current?.focus()},children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[q.map(se=>e.jsxs(G,{className:y("data-[disabled]:bg-muted-foreground data-[disabled]:text-muted data-[disabled]:hover:bg-muted-foreground","data-[fixed]:bg-muted-foreground data-[fixed]:text-muted data-[fixed]:hover:bg-muted-foreground",w),"data-fixed":se.fixed,"data-disabled":k||void 0,children:[se.label,e.jsx("button",{className:y("ml-1 rounded-full outline-none ring-offset-background focus:ring-2 focus:ring-ring focus:ring-offset-2",(k||se.fixed)&&"hidden"),onKeyDown:xe=>{xe.key==="Enter"&&Ts(se)},onMouseDown:xe=>{xe.preventDefault(),xe.stopPropagation()},onClick:()=>Ts(se),children:e.jsx(rn,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},se.value)),e.jsx(He.Input,{...p,ref:H,value:Te,disabled:k,onValueChange:se=>{re(se),p?.onValueChange?.(se)},onBlur:se=>{ue.current===!1&&B(!1),p?.onBlur?.(se)},onFocus:se=>{B(!0),T&&o?.(us),p?.onFocus?.(se)},placeholder:h&&q.length!==0?"":t,className:y("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":h,"px-3 py-2":q.length===0,"ml-1":q.length!==0},p?.className)}),e.jsx("button",{type:"button",onClick:Ha,className:y((_||k||q.length<1||q.filter(se=>se.fixed).length===q.length)&&"hidden"),children:e.jsx(rn,{})})]})}),e.jsx("div",{className:"relative",children:O&&e.jsx(Ks,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",onMouseLeave:()=>{ue.current=!1},onMouseEnter:()=>{ue.current=!0},onMouseUp:()=>{H.current?.focus()},children:ee?e.jsx(e.Fragment,{children:c}):e.jsxs(e.Fragment,{children:[Yt(),Dt(),!N&&e.jsx($e,{value:"-",className:"hidden"}),Object.entries(Pt).map(([se,xe])=>e.jsx(ns,{heading:se,className:"h-full overflow-auto",children:e.jsx(e.Fragment,{children:xe.map(ae=>e.jsx($e,{value:ae.value,disabled:ae.disable,onMouseDown:Gs=>{Gs.preventDefault(),Gs.stopPropagation()},onSelect:()=>{if(q.length>=i){d?.(q.length);return}re("");const Gs=[...q,ae];R(Gs),a?.(Gs)},className:y("cursor-pointer",ae.disable&&"cursor-default text-muted-foreground"),children:ae.label},ae.value))})},se))]})})})]})});wt.displayName="MultipleSelector";const Hu=s=>x.object({id:x.number().optional(),name:x.string().min(2,s("messages.nameValidation.min")).max(50,s("messages.nameValidation.max")).regex(/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/,s("messages.nameValidation.pattern"))});function qa({refetch:s,dialogTrigger:a,defaultValues:t={name:""},type:l="add"}){const{t:n}=V("group"),r=Ne({resolver:we(Hu(n)),defaultValues:t,mode:"onChange"}),[o,c]=m.useState(!1),[u,i]=m.useState(!1),d=async h=>{i(!0),rt.save(h).then(()=>{$.success(n(l==="edit"?"messages.updateSuccess":"messages.createSuccess")),s&&s(),r.reset(),c(!1)}).finally(()=>{i(!1)})};return e.jsxs(ge,{open:o,onOpenChange:c,children:[e.jsx(is,{asChild:!0,children:a||e.jsxs(L,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(ze,{icon:"ion:add"}),e.jsx("span",{children:n("form.add")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:n(l==="edit"?"form.edit":"form.create")}),e.jsx(Re,{children:n(l==="edit"?"form.editDescription":"form.createDescription")})]}),e.jsx(Ce,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(d),className:"space-y-4",children:[e.jsx(v,{control:r.control,name:"name",render:({field:h})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.name")}),e.jsx(b,{children:e.jsx(D,{placeholder:n("form.namePlaceholder"),...h,className:"w-full"})}),e.jsx(M,{children:n("form.nameDescription")}),e.jsx(P,{})]})}),e.jsxs(Le,{className:"gap-2",children:[e.jsx(qs,{asChild:!0,children:e.jsx(L,{type:"button",variant:"outline",children:n("form.cancel")})}),e.jsxs(L,{type:"submit",disabled:u||!r.formState.isValid,children:[u&&e.jsx(fa,{className:"mr-2 h-4 w-4 animate-spin"}),n(l==="edit"?"form.update":"form.create")]})]})]})})]})]})}const Ur=m.createContext(void 0);function Uu({children:s,refetch:a}){const[t,l]=m.useState(!1),[n,r]=m.useState(null),[o,c]=m.useState(ie.Shadowsocks);return e.jsx(Ur.Provider,{value:{isOpen:t,setIsOpen:l,editingServer:n,setEditingServer:r,serverType:o,setServerType:c,refetch:a},children:s})}function Kr(){const s=m.useContext(Ur);if(s===void 0)throw new Error("useServerEdit must be used within a ServerEditProvider");return s}function Xa({dialogTrigger:s,value:a,setValue:t,templateType:l}){const{t:n}=V("server");m.useEffect(()=>{console.log(a)},[a]);const[r,o]=m.useState(!1),[c,u]=m.useState(()=>{if(!a||Object.keys(a).length===0)return"";try{return JSON.stringify(a,null,2)}catch{return""}}),[i,d]=m.useState(null),h=g=>{if(!g)return null;try{const T=JSON.parse(g);return typeof T!="object"||T===null?n("network_settings.validation.must_be_object"):null}catch{return n("network_settings.validation.invalid_json")}},k={tcp:{label:"TCP",content:{acceptProxyProtocol:!1,header:{type:"none"}}},"tcp-http":{label:"TCP + HTTP",content:{acceptProxyProtocol:!1,header:{type:"http",request:{version:"1.1",method:"GET",path:["/"],headers:{Host:["www.example.com"]}},response:{version:"1.1",status:"200",reason:"OK"}}}},grpc:{label:"gRPC",content:{serviceName:"GunService"}},ws:{label:"WebSocket",content:{path:"/",headers:{Host:"v2ray.com"}}},httpupgrade:{label:"HttpUpgrade",content:{acceptProxyProtocol:!1,path:"/",host:"xray.com",headers:{key:"value"}}},xhttp:{label:"XHTTP",content:{host:"example.com",path:"/yourpath",mode:"auto",extra:{headers:{},xPaddingBytes:"100-1000",noGRPCHeader:!1,noSSEHeader:!1,scMaxEachPostBytes:1e6,scMinPostsIntervalMs:30,scMaxBufferedPosts:30,xmux:{maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:"64-128",cMaxLifetimeMs:0,hMaxRequestTimes:"800-900",hKeepAlivePeriod:0},downloadSettings:{address:"",port:443,network:"xhttp",security:"tls",tlsSettings:{},xhttpSettings:{path:"/yourpath"},sockopt:{}}}}}},C=()=>{switch(l){case"tcp":return["tcp","tcp-http"];case"grpc":return["grpc"];case"ws":return["ws"];case"httpupgrade":return["httpupgrade"];case"xhttp":return["xhttp"];default:return[]}},S=()=>{const g=h(c||"");if(g){$.error(g);return}try{if(!c){t(null),o(!1);return}t(JSON.parse(c)),o(!1)}catch{$.error(n("network_settings.errors.save_failed"))}},w=g=>{u(g),d(h(g))},N=g=>{const T=k[g];if(T){const E=JSON.stringify(T.content,null,2);u(E),d(null)}};return m.useEffect(()=>{r&&console.log(a)},[r,a]),m.useEffect(()=>{r&&a&&Object.keys(a).length>0&&u(JSON.stringify(a,null,2))},[r,a]),e.jsxs(ge,{open:r,onOpenChange:g=>{!g&&r&&S(),o(g)},children:[e.jsx(is,{asChild:!0,children:s??e.jsx(K,{variant:"link",children:n("network_settings.edit_protocol")})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsx(ve,{children:e.jsx(fe,{children:n("network_settings.edit_protocol_config")})}),e.jsxs("div",{className:"space-y-4",children:[C().length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:C().map(g=>e.jsx(K,{variant:"outline",size:"sm",onClick:()=>N(g),children:n("network_settings.use_template",{template:k[g].label})},g))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ks,{className:`min-h-[200px] font-mono text-sm ${i?"border-red-500 focus-visible:ring-red-500":""}`,value:c,placeholder:C().length>0?n("network_settings.json_config_placeholder_with_template"):n("network_settings.json_config_placeholder"),onChange:g=>w(g.target.value)}),i&&e.jsx("p",{className:"text-sm text-red-500",children:i})]})]}),e.jsxs(Le,{className:"gap-2",children:[e.jsx(K,{variant:"outline",onClick:()=>o(!1),children:n("common.cancel")}),e.jsx(K,{onClick:S,disabled:!!i,children:n("common.confirm")})]})]})]})}function rp(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}const Ku={},Bu=Object.freeze(Object.defineProperty({__proto__:null,default:Ku},Symbol.toStringTag,{value:"Module"})),ip=Xc(Bu),ll=s=>s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),Gu=()=>{try{const s=Oc.box.keyPair(),a=ll(Yn.encodeBase64(s.secretKey)),t=ll(Yn.encodeBase64(s.publicKey));return{privateKey:a,publicKey:t}}catch(s){throw console.error("Error generating x25519 key pair:",s),s}},Wu=()=>{try{return Gu()}catch(s){throw console.error("Error generating key pair:",s),s}},Yu=s=>{const a=new Uint8Array(Math.ceil(s/2));return window.crypto.getRandomValues(a),Array.from(a).map(t=>t.toString(16).padStart(2,"0")).join("").substring(0,s)},Ju=()=>{const s=Math.floor(Math.random()*8)*2+2;return Yu(s)},Qu=x.object({cipher:x.string().default("aes-128-gcm"),plugin:x.string().optional().default(""),plugin_opts:x.string().optional().default(""),client_fingerprint:x.string().optional().default("chrome")}),Xu=x.object({tls:x.coerce.number().default(0),tls_settings:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({}),network:x.string().default("tcp"),network_settings:x.record(x.any()).default({})}),Zu=x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1),network:x.string().default("tcp"),network_settings:x.record(x.any()).default({})}),ex=x.object({version:x.coerce.number().default(2),alpn:x.string().default("h2"),obfs:x.object({open:x.coerce.boolean().default(!1),type:x.string().default("salamander"),password:x.string().default("")}).default({}),tls:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({}),bandwidth:x.object({up:x.string().default(""),down:x.string().default("")}).default({}),hop_interval:x.number().optional(),port_range:x.string().optional()}),sx=x.object({tls:x.coerce.number().default(0),tls_settings:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({}),reality_settings:x.object({server_port:x.coerce.number().default(443),server_name:x.string().default(""),allow_insecure:x.boolean().default(!1),public_key:x.string().default(""),private_key:x.string().default(""),short_id:x.string().default("")}).default({}),network:x.string().default("tcp"),network_settings:x.record(x.any()).default({}),flow:x.string().default("")}),tx=x.object({version:x.coerce.number().default(5),congestion_control:x.string().default("bbr"),alpn:x.array(x.string()).default(["h3"]),udp_relay_mode:x.string().default("native"),tls:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({})}),ax=x.object({}),nx=x.object({tls:x.coerce.number().default(0),tls_settings:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({})}),lx=x.object({tls:x.coerce.number().default(0),tls_settings:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({})}),rx=x.object({transport:x.string().default("tcp"),multiplexing:x.string().default("MULTIPLEXING_LOW")}),ix=x.object({padding_scheme:x.array(x.string()).optional().default([]),tls:x.object({server_name:x.string().default(""),allow_insecure:x.boolean().default(!1)}).default({})}),Pe={shadowsocks:{schema:Qu,ciphers:["aes-128-gcm","aes-192-gcm","aes-256-gcm","chacha20-ietf-poly1305","2022-blake3-aes-128-gcm","2022-blake3-aes-256-gcm"],plugins:[{value:"none",label:"None"},{value:"obfs",label:"Simple Obfs"},{value:"v2ray-plugin",label:"V2Ray Plugin"}],clientFingerprints:[{value:"chrome",label:"Chrome"},{value:"firefox",label:"Firefox"},{value:"safari",label:"Safari"},{value:"ios",label:"iOS"}]},vmess:{schema:Xu,networkOptions:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}]},trojan:{schema:Zu,networkOptions:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}]},hysteria:{schema:ex,versions:["1","2"],alpnOptions:["hysteria","http/1.1","h2","h3"]},vless:{schema:sx,networkOptions:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"},{value:"kcp",label:"mKCP"},{value:"httpupgrade",label:"HttpUpgrade"},{value:"xhttp",label:"XHTTP"}],flowOptions:["none","xtls-rprx-direct","xtls-rprx-splice","xtls-rprx-vision"]},tuic:{schema:tx,versions:["5","4"],congestionControls:["bbr","cubic","new_reno"],alpnOptions:[{value:"h3",label:"HTTP/3"},{value:"h2",label:"HTTP/2"},{value:"http/1.1",label:"HTTP/1.1"}],udpRelayModes:[{value:"native",label:"Native"},{value:"quic",label:"QUIC"}]},socks:{schema:ax},naive:{schema:lx},http:{schema:nx},mieru:{schema:rx,transportOptions:[{value:"tcp",label:"TCP"},{value:"udp",label:"UDP"}],multiplexingOptions:[{value:"MULTIPLEXING_OFF",label:"Off"},{value:"MULTIPLEXING_LOW",label:"Low"},{value:"MULTIPLEXING_MIDDLE",label:"Middle"},{value:"MULTIPLEXING_HIGH",label:"High"}]},anytls:{schema:ix,defaultPaddingScheme:["stop=8","0=30-30","1=100-400","2=400-500,c,500-1000,c,500-1000,c,500-1000,c,500-1000","3=9-9,500-1000","4=500-1000","5=500-1000","6=500-1000","7=500-1000"]}},ox=({serverType:s,value:a,onChange:t})=>{const{t:l}=V("server"),n=s?Pe[s]:null,r=n?.schema||x.record(x.any()),o=s?r.parse({}):{},c=Ne({resolver:we(r),defaultValues:o,mode:"onChange"});if(m.useEffect(()=>{if(!a||Object.keys(a).length===0){if(s){const p=r.parse({});c.reset(p)}}else c.reset(a)},[s,a,t,c,r]),m.useEffect(()=>{const p=c.watch(_=>{t(_)});return()=>p.unsubscribe()},[c,t]),!s||!n)return null;const E={shadowsocks:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"cipher",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.shadowsocks.cipher.label")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.shadowsocks.cipher.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.shadowsocks.ciphers.map(_=>e.jsx(A,{value:_,children:_},_))})})]})})]})}),e.jsx(v,{control:c.control,name:"plugin",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.shadowsocks.plugin.label","插件")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:_=>p.onChange(_==="none"?"":_),value:p.value===""?"none":p.value||"none",children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.shadowsocks.plugin.placeholder","选择插件")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.shadowsocks.plugins.map(_=>e.jsx(A,{value:_.value,children:_.label},_.value))})})]})}),e.jsx(M,{children:p.value&&p.value!=="none"&&p.value!==""&&e.jsxs(e.Fragment,{children:[p.value==="obfs"&&l("dynamic_form.shadowsocks.plugin.obfs_hint","提示：配置格式如 obfs=http;obfs-host=www.bing.com;path=/"),p.value==="v2ray-plugin"&&l("dynamic_form.shadowsocks.plugin.v2ray_hint","提示：WebSocket模式格式为 mode=websocket;host=mydomain.me;path=/;tls=true，QUIC模式格式为 mode=quic;host=mydomain.me")]})})]})}),c.watch("plugin")&&c.watch("plugin")!=="none"&&c.watch("plugin")!==""&&e.jsx(v,{control:c.control,name:"plugin_opts",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.shadowsocks.plugin_opts.label","插件选项")}),e.jsx(M,{children:l("dynamic_form.shadowsocks.plugin_opts.description","按照 key=value;key2=value2 格式输入插件选项")}),e.jsx(b,{children:e.jsx(D,{type:"text",placeholder:l("dynamic_form.shadowsocks.plugin_opts.placeholder","例如: mode=tls;host=bing.com"),...p})})]})}),(c.watch("plugin")==="shadow-tls"||c.watch("plugin")==="restls")&&e.jsx(v,{control:c.control,name:"client_fingerprint",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.shadowsocks.client_fingerprint","客户端指纹")}),e.jsx(b,{children:e.jsxs(J,{value:p.value||"chrome",onValueChange:p.onChange,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.shadowsocks.client_fingerprint_placeholder","选择客户端指纹")})}),e.jsx(Y,{children:Pe.shadowsocks.clientFingerprints.map(_=>e.jsx(A,{value:_.value,children:_.label},_.value))})]})}),e.jsx(M,{children:l("dynamic_form.shadowsocks.client_fingerprint_description","客户端伪装指纹，用于降低被识别风险")})]})})]}),vmess:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"tls",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vmess.tls.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value?.toString(),onValueChange:_=>p.onChange(Number(_)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.vmess.tls.placeholder")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:l("dynamic_form.vmess.tls.disabled")}),e.jsx(A,{value:"1",children:l("dynamic_form.vmess.tls.enabled")})]})]})})]})}),c.watch("tls")==1&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls_settings.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.vmess.tls_settings.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.vmess.tls_settings.server_name.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"tls_settings.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vmess.tls_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]}),e.jsx(v,{control:c.control,name:"network",render:({field:p})=>e.jsxs(f,{children:[e.jsxs(j,{children:[l("dynamic_form.vmess.network.label"),e.jsx(Xa,{value:c.watch("network_settings"),setValue:_=>c.setValue("network_settings",_),templateType:c.watch("network")})]}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.vmess.network.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.vmess.networkOptions.map(_=>e.jsx(A,{value:_.value,className:"cursor-pointer",children:_.label},_.value))})})]})})]})})]}),trojan:()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.trojan.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.trojan.server_name.placeholder"),...p,value:p.value||""})})]})}),e.jsx(v,{control:c.control,name:"allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.trojan.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value||!1,onCheckedChange:p.onChange})})})]})})]}),e.jsx(v,{control:c.control,name:"network",render:({field:p})=>e.jsxs(f,{children:[e.jsxs(j,{children:[l("dynamic_form.trojan.network.label"),e.jsx(Xa,{value:c.watch("network_settings")||{},setValue:_=>c.setValue("network_settings",_),templateType:c.watch("network")||"tcp"})]}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value||"tcp",children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.trojan.network.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.trojan.networkOptions.map(_=>e.jsx(A,{value:_.value,className:"cursor-pointer",children:_.label},_.value))})})]})})]})})]}),hysteria:()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"version",render:({field:p})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:l("dynamic_form.hysteria.version.label")}),e.jsx(b,{children:e.jsxs(J,{value:(p.value||2).toString(),onValueChange:_=>p.onChange(Number(_)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.hysteria.version.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.hysteria.versions.map(_=>e.jsxs(A,{value:_,className:"cursor-pointer",children:["V",_]},_))})})]})})]})}),c.watch("version")==1&&e.jsx(v,{control:c.control,name:"alpn",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.hysteria.alpn.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value||"h2",onValueChange:p.onChange,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.hysteria.alpn.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.hysteria.alpnOptions.map(_=>e.jsx(A,{value:_,children:_},_))})})]})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"obfs.open",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.hysteria.obfs.label")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value||!1,onCheckedChange:p.onChange})})})]})}),!!c.watch("obfs.open")&&e.jsxs(e.Fragment,{children:[c.watch("version")=="2"&&e.jsx(v,{control:c.control,name:"obfs.type",render:({field:p})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:l("dynamic_form.hysteria.obfs.type.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value||"salamander",onValueChange:p.onChange,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.hysteria.obfs.type.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:e.jsx(A,{value:"salamander",children:l("dynamic_form.hysteria.obfs.type.salamander")})})})]})})]})}),e.jsx(v,{control:c.control,name:"obfs.password",render:({field:p})=>e.jsxs(f,{className:c.watch("version")==2?"w-full":"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.hysteria.obfs.password.label")}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.hysteria.obfs.password.placeholder"),...p,value:p.value||"",className:"pr-9"})}),e.jsx(K,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",I=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(H=>_[H%_.length]).join("");c.setValue("obfs.password",I),$.success(l("dynamic_form.hysteria.obfs.password.generate_success"))},className:"absolute right-0 top-0 h-full px-2  active:scale-90 transition-transform duration-150",children:e.jsx(ze,{icon:"ion:refresh-outline",className:"h-4 w-4 transition-transform hover:rotate-180 duration-300"})})]})]})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.hysteria.tls.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.hysteria.tls.server_name.placeholder"),...p,value:p.value||""})})]})}),e.jsx(v,{control:c.control,name:"tls.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.hysteria.tls.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value||!1,onCheckedChange:p.onChange})})})]})})]}),e.jsx(v,{control:c.control,name:"bandwidth.up",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.hysteria.bandwidth.up.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:l("dynamic_form.hysteria.bandwidth.up.placeholder")+(c.watch("version")==2?l("dynamic_form.hysteria.bandwidth.up.bbr_tip"):""),className:"rounded-br-none rounded-tr-none",...p,value:p.value||""})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:l("dynamic_form.hysteria.bandwidth.up.suffix")})})]})]})}),e.jsx(v,{control:c.control,name:"bandwidth.down",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.hysteria.bandwidth.down.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:l("dynamic_form.hysteria.bandwidth.down.placeholder")+(c.watch("version")==2?l("dynamic_form.hysteria.bandwidth.down.bbr_tip"):""),className:"rounded-br-none rounded-tr-none",...p,value:p.value||""})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:l("dynamic_form.hysteria.bandwidth.down.suffix")})})]})]})}),e.jsx(e.Fragment,{children:e.jsx(v,{control:c.control,name:"hop_interval",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.hysteria.hop_interval.label","Hop 间隔 (秒)")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:l("dynamic_form.hysteria.hop_interval.placeholder","例如: 30"),...p,value:p.value||"",onChange:_=>{const I=_.target.value?parseInt(_.target.value):void 0;p.onChange(I)}})}),e.jsx(M,{children:l("dynamic_form.hysteria.hop_interval.description","Hop 间隔时间，单位为秒")})]})})})]}),vless:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"tls",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vless.tls.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value?.toString(),onValueChange:_=>p.onChange(Number(_)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.vless.tls.placeholder")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:l("dynamic_form.vless.tls.none")}),e.jsx(A,{value:"1",children:l("dynamic_form.vless.tls.tls")}),e.jsx(A,{value:"2",children:l("dynamic_form.vless.tls.reality")})]})]})})]})}),c.watch("tls")=="1"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls_settings.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.vless.tls_settings.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.vless.tls_settings.server_name.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"tls_settings.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vless.tls_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]}),c.watch("tls")==2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"reality_settings.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.vless.reality_settings.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.vless.reality_settings.server_name.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"reality_settings.server_port",render:({field:p})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:l("dynamic_form.vless.reality_settings.server_port.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.vless.reality_settings.server_port.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"reality_settings.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vless.reality_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(v,{control:c.control,name:"reality_settings.private_key",render:({field:p})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:l("dynamic_form.vless.reality_settings.private_key.label")}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{children:e.jsx(D,{...p,className:"pr-9"})}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(K,{type:"button",variant:"ghost",size:"icon",onClick:()=>{try{const _=Wu();c.setValue("reality_settings.private_key",_.privateKey),c.setValue("reality_settings.public_key",_.publicKey),$.success(l("dynamic_form.vless.reality_settings.key_pair.success"))}catch{$.error(l("dynamic_form.vless.reality_settings.key_pair.error"))}},className:"absolute right-0 top-0 h-full px-2 active:scale-90 transition-transform duration-150",children:e.jsx(ze,{icon:"ion:key-outline",className:"h-4 w-4 transition-transform hover:rotate-180 duration-300"})})}),e.jsx(ja,{children:e.jsx(oe,{children:e.jsx("p",{children:l("dynamic_form.vless.reality_settings.key_pair.generate")})})})]})]})]})})}),e.jsx(v,{control:c.control,name:"reality_settings.public_key",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vless.reality_settings.public_key.label")}),e.jsx(b,{children:e.jsx(D,{...p})})]})}),e.jsx(v,{control:c.control,name:"reality_settings.short_id",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vless.reality_settings.short_id.label")}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{children:e.jsx(D,{...p,className:"pr-9",placeholder:l("dynamic_form.vless.reality_settings.short_id.placeholder")})}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(K,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const _=Ju();c.setValue("reality_settings.short_id",_),$.success(l("dynamic_form.vless.reality_settings.short_id.success"))},className:"absolute right-0 top-0 h-full px-2 active:scale-90 transition-transform duration-150",children:e.jsx(ze,{icon:"ion:refresh-outline",className:"h-4 w-4 transition-transform hover:rotate-180 duration-300"})})}),e.jsx(ja,{children:e.jsx(oe,{children:e.jsx("p",{children:l("dynamic_form.vless.reality_settings.short_id.generate")})})})]})]}),e.jsx(M,{className:"text-xs text-muted-foreground",children:l("dynamic_form.vless.reality_settings.short_id.description")})]})})]}),e.jsx(v,{control:c.control,name:"network",render:({field:p})=>e.jsxs(f,{children:[e.jsxs(j,{children:[l("dynamic_form.vless.network.label"),e.jsx(Xa,{value:c.watch("network_settings"),setValue:_=>c.setValue("network_settings",_),templateType:c.watch("network")})]}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.vless.network.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.vless.networkOptions.map(_=>e.jsx(A,{value:_.value,className:"cursor-pointer",children:_.label},_.value))})})]})})]})}),e.jsx(v,{control:c.control,name:"flow",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.vless.flow.label")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:_=>p.onChange(_==="none"?null:_),value:p.value||"none",children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.vless.flow.placeholder")})}),e.jsx(Y,{children:Pe.vless.flowOptions.map(_=>e.jsx(A,{value:_,children:_},_))})]})})]})})]}),tuic:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"version",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.tuic.version.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value?.toString(),onValueChange:_=>p.onChange(Number(_)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.tuic.version.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.tuic.versions.map(_=>e.jsxs(A,{value:_,children:["V",_]},_))})})]})})]})}),e.jsx(v,{control:c.control,name:"congestion_control",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.tuic.congestion_control.label")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.tuic.congestion_control.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.tuic.congestionControls.map(_=>e.jsx(A,{value:_,children:_.toUpperCase()},_))})})]})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.tuic.tls.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.tuic.tls.server_name.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"tls.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.tuic.tls.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]}),e.jsx(v,{control:c.control,name:"alpn",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.tuic.tls.alpn.label")}),e.jsx(b,{children:e.jsx(wt,{options:Pe.tuic.alpnOptions,onChange:_=>p.onChange(_.map(I=>I.value)),value:Pe.tuic.alpnOptions.filter(_=>p.value?.includes(_.value)),placeholder:l("dynamic_form.tuic.tls.alpn.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:l("dynamic_form.tuic.tls.alpn.empty")})})})]})}),e.jsx(v,{control:c.control,name:"udp_relay_mode",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.tuic.udp_relay_mode.label")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.tuic.udp_relay_mode.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.tuic.udpRelayModes.map(_=>e.jsx(A,{value:_.value,children:_.label},_.value))})})]})})]})})]}),socks:()=>e.jsx(e.Fragment,{}),naive:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"tls",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.naive.tls.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value?.toString(),onValueChange:_=>p.onChange(Number(_)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.naive.tls.placeholder")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:l("dynamic_form.naive.tls.disabled")}),e.jsx(A,{value:"1",children:l("dynamic_form.naive.tls.enabled")})]})]})})]})}),c.watch("tls")==1&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls_settings.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.naive.tls_settings.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.naive.tls_settings.server_name.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"tls_settings.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.naive.tls_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]})]}),http:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"tls",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.http.tls.label")}),e.jsx(b,{children:e.jsxs(J,{value:p.value?.toString(),onValueChange:_=>p.onChange(Number(_)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.http.tls.placeholder")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:l("dynamic_form.http.tls.disabled")}),e.jsx(A,{value:"1",children:l("dynamic_form.http.tls.enabled")})]})]})})]})}),c.watch("tls")==1&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls_settings.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.http.tls_settings.server_name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.http.tls_settings.server_name.placeholder"),...p})})]})}),e.jsx(v,{control:c.control,name:"tls_settings.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.http.tls_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]})]}),mieru:()=>e.jsxs(e.Fragment,{children:[e.jsx(v,{control:c.control,name:"transport",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.mieru.transport.label")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.mieru.transport.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.mieru.transportOptions.map(_=>e.jsx(A,{value:_.value,children:_.label},_.value))})})]})})]})}),e.jsx(v,{control:c.control,name:"multiplexing",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.mieru.multiplexing.label")}),e.jsx(b,{children:e.jsxs(J,{onValueChange:p.onChange,value:p.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dynamic_form.mieru.multiplexing.placeholder")})}),e.jsx(Y,{children:e.jsx(Be,{children:Pe.mieru.multiplexingOptions.map(_=>e.jsx(A,{value:_.value,children:_.label},_.value))})})]})})]})})]}),anytls:()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:c.control,name:"padding_scheme",render:({field:p})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{children:l("dynamic_form.anytls.padding_scheme.label","AnyTLS 填充方案")}),e.jsx(K,{type:"button",variant:"outline",size:"sm",onClick:()=>{c.setValue("padding_scheme",Pe.anytls.defaultPaddingScheme),$.success(l("dynamic_form.anytls.padding_scheme.default_success","已设置默认填充方案"))},className:"h-7 px-2",children:l("dynamic_form.anytls.padding_scheme.use_default","使用默认方案")})]}),e.jsx(M,{children:l("dynamic_form.anytls.padding_scheme.description","每行一个填充规则，格式如: stop=8, 0=30-30")}),e.jsx(b,{children:e.jsx("textarea",{className:"flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:l("dynamic_form.anytls.padding_scheme.placeholder",`例如:
stop=8
0=30-30
1=100-400
2=400-500,c,500-1000`),...p,value:Array.isArray(p.value)?p.value.join(`
`):"",onChange:_=>{const H=_.target.value.split(`
`).filter(O=>O.trim()!=="");p.onChange(H)}})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:c.control,name:"tls.server_name",render:({field:p})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:l("dynamic_form.anytls.tls.server_name.label","SNI")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dynamic_form.anytls.tls.server_name.placeholder","服务器名称"),...p})})]})}),e.jsx(v,{control:c.control,name:"tls.allow_insecure",render:({field:p})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dynamic_form.anytls.tls.allow_insecure","允许不安全连接")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(b,{children:e.jsx(Z,{checked:p.value,onCheckedChange:p.onChange})})})]})})]})]})})};return e.jsx(je,{children:E[s]?.()})};function cx(){const{t:s}=V("server"),a=x.object({id:x.number().optional().nullable(),specific_key:x.string().optional().nullable(),code:x.string().optional(),show:x.boolean().optional().nullable(),name:x.string().min(1,s("form.name.error")),rate:x.string().min(1,s("form.rate.error")).refine(I=>!isNaN(parseFloat(I))&&isFinite(Number(I)),{message:s("form.rate.error_numeric")}).refine(I=>parseFloat(I)>=0,{message:s("form.rate.error_gte_zero")}),tags:x.array(x.string()).default([]),excludes:x.array(x.string()).default([]),ips:x.array(x.string()).default([]),group_ids:x.array(x.string()).default([]),host:x.string().min(1,s("form.host.error")),port:x.string().min(1,s("form.port.error")),server_port:x.string().min(1,s("form.server_port.error")),parent_id:x.string().default("0").nullable(),route_ids:x.array(x.string()).default([]),protocol_settings:x.record(x.any()).default({}).nullable()}),t={id:null,specific_key:null,code:"",show:!1,name:"",rate:"1",tags:[],excludes:[],ips:[],group_ids:[],host:"",port:"",server_port:"",parent_id:"0",route_ids:[],protocol_settings:null},{isOpen:l,setIsOpen:n,editingServer:r,setEditingServer:o,serverType:c,setServerType:u,refetch:i}=Kr(),[d,h]=m.useState([]),[k,C]=m.useState([]),[S,w]=m.useState([]),N=Ne({resolver:we(a),defaultValues:t,mode:"onChange"});m.useEffect(()=>{g()},[l]),m.useEffect(()=>{r?.type&&r.type!==c&&u(r.type)},[r,c,u]),m.useEffect(()=>{r?r.type===c&&N.reset({...t,...r}):N.reset({...t,protocol_settings:Pe[c].schema.parse({})})},[r,N,c]);const g=async()=>{if(!l)return;const[I,H,O]=await Promise.all([rt.getList(),Ia.getList(),Zs.getList()]);h(I.data?.map(B=>({label:B.name,value:B.id.toString()}))||[]),C(H.data?.map(B=>({label:B.remarks,value:B.id.toString()}))||[]),w(O.data||[])},T=m.useMemo(()=>S?.filter(I=>(I.parent_id===0||I.parent_id===null)&&I.type===c&&I.id!==N.watch("id")),[c,S,N]),E=()=>e.jsxs(Es,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(ze,{icon:"ion:add"}),e.jsx("div",{children:s("form.add_node")})]})}),e.jsx(ws,{align:"start",children:e.jsx(Vd,{children:cs.map(({type:I,label:H})=>e.jsx(_e,{onClick:()=>{u(I),n(!0)},className:"cursor-pointer",children:e.jsx(G,{variant:"outline",className:"text-white",style:{background:Ge[I]},children:H})},I))})})]}),p=()=>{n(!1),o(null),N.reset(t)},_=async()=>{const I=N.getValues();(await Zs.save({...I,type:c})).data&&(p(),$.success(s("form.success")),i())};return e.jsxs(ge,{open:l,onOpenChange:p,children:[E(),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:s(r?"form.edit_node":"form.new_node")}),e.jsx(Re,{})]}),e.jsxs(Ce,{...N,children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{control:N.control,name:"name",render:({field:I})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:s("form.name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("form.name.placeholder"),...I})}),e.jsx(P,{})]})}),e.jsx(v,{control:N.control,name:"rate",render:({field:I})=>e.jsxs(f,{className:"flex-[1]",children:[e.jsx(j,{children:s("form.rate.label")}),e.jsx("div",{className:"relative flex",children:e.jsx(b,{children:e.jsx(D,{type:"number",min:"0",step:"0.1",...I})})}),e.jsx(P,{})]})})]}),e.jsx(v,{control:N.control,name:"code",render:({field:I})=>e.jsxs(f,{children:[e.jsxs(j,{children:[s("form.code.label"),e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:s("form.code.optional")})]}),e.jsx(b,{children:e.jsx(D,{placeholder:s("form.code.placeholder"),...I,value:I.value||""})}),e.jsx(P,{})]})}),e.jsx(v,{control:N.control,name:"tags",render:({field:I})=>e.jsxs(f,{children:[e.jsx(j,{children:s("form.tags.label")}),e.jsx(b,{children:e.jsx(Tn,{value:I.value,onChange:I.onChange,placeholder:s("form.tags.placeholder"),className:"w-full"})}),e.jsx(P,{})]})}),e.jsx(v,{control:N.control,name:"group_ids",render:({field:I})=>e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center justify-between",children:[s("form.groups.label"),e.jsx(qa,{dialogTrigger:e.jsx(L,{variant:"link",children:s("form.groups.add")}),refetch:g})]}),e.jsx(b,{children:e.jsx(wt,{options:d,onChange:H=>I.onChange(H.map(O=>O.value)),value:d?.filter(H=>I.value.includes(H.value)),placeholder:s("form.groups.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:s("form.groups.empty")})})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:N.control,name:"host",render:({field:I})=>e.jsxs(f,{children:[e.jsx(j,{children:s("form.host.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:s("form.host.placeholder"),...I})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{control:N.control,name:"port",render:({field:I})=>e.jsxs(f,{className:"flex-1",children:[e.jsxs(j,{className:"flex items-center gap-1.5",children:[s("form.port.label"),e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(ze,{icon:"ph:info-light",className:"size-3.5 cursor-help text-muted-foreground"})}),e.jsx(ja,{children:e.jsx(oe,{side:"top",sideOffset:8,className:"max-w-80 p-3",children:e.jsx("p",{children:s("form.port.tooltip")})})})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{children:e.jsx(D,{placeholder:s("form.port.placeholder"),...I})}),e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(L,{type:"button",variant:"ghost",size:"icon",className:"size-6 shrink-0 text-muted-foreground/50 hover:text-muted-foreground",onClick:()=>{const H=I.value;H&&N.setValue("server_port",H)},children:e.jsx(ze,{icon:"tabler:arrows-right",className:"size-3"})})}),e.jsx(oe,{side:"right",children:e.jsx("p",{children:s("form.port.sync")})})]})})]}),e.jsx(P,{})]})}),e.jsx(v,{control:N.control,name:"server_port",render:({field:I})=>e.jsxs(f,{className:"flex-1",children:[e.jsxs(j,{className:"flex items-center gap-1.5",children:[s("form.server_port.label"),e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(ze,{icon:"ph:info-light",className:"size-3.5 cursor-help text-muted-foreground"})}),e.jsx(ja,{children:e.jsx(oe,{side:"top",sideOffset:8,className:"max-w-80 p-3",children:e.jsx("p",{children:s("form.server_port.tooltip")})})})]})})]}),e.jsx(b,{children:e.jsx(D,{placeholder:s("form.server_port.placeholder"),...I})}),e.jsx(P,{})]})})]})]}),l&&e.jsx(ox,{serverType:c,value:N.watch("protocol_settings"),onChange:I=>N.setValue("protocol_settings",I,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0})}),e.jsx(v,{control:N.control,name:"parent_id",render:({field:I})=>e.jsxs(f,{children:[e.jsx(j,{children:s("form.parent.label")}),e.jsxs(J,{onValueChange:I.onChange,value:I.value?.toString()||"0",children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:s("form.parent.placeholder")})})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("form.parent.none")}),T?.map(H=>e.jsx(A,{value:H.id.toString(),className:"cursor-pointer",children:H.name},H.id))]})]}),e.jsx(P,{})]})}),e.jsx(v,{control:N.control,name:"route_ids",render:({field:I})=>e.jsxs(f,{children:[e.jsx(j,{children:s("form.route.label")}),e.jsx(b,{children:e.jsx(wt,{options:k,onChange:H=>I.onChange(H.map(O=>O.value)),value:k?.filter(H=>I.value.includes(H.value)),placeholder:s("form.route.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:s("form.route.empty")})})}),e.jsx(P,{})]})})]}),e.jsxs(Le,{className:"mt-6 flex flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(L,{type:"button",variant:"outline",onClick:p,className:"w-full sm:w-auto",children:s("form.cancel")}),e.jsx(L,{type:"submit",onClick:_,className:"w-full sm:w-auto",children:s("form.submit")})]})]})]})]})}function rl({column:s,title:a,options:t}){const l=s?.getFacetedUniqueValues(),n=new Set(s?.getFilterValue());return e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Pa,{className:"mr-2 h-4 w-4"}),a,n?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?e.jsxs(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):t.filter(r=>n.has(r.value)).map(r=>e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},r.value))})]})]})}),e.jsx(bs,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Us,{children:[e.jsx(it,{placeholder:a}),e.jsxs(Ks,{children:[e.jsx(ot,{children:"No results found."}),e.jsx(ns,{children:t.map(r=>{const o=n.has(r.value);return e.jsxs($e,{onSelect:()=>{o?n.delete(r.value):n.add(r.value);const c=Array.from(n);s?.setFilterValue(c.length?c:void 0)},className:"cursor-pointer",children:[e.jsx("div",{className:y("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(at,{className:y("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${r.color}`}),e.jsx("span",{children:r.label}),l?.get(r.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(r.value)})]},r.value)})}),n.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{}),e.jsx(ns,{children:e.jsx($e,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center cursor-pointer",children:"Clear filters"})})]})]})]})})]})}const dx=[{value:ie.Shadowsocks,label:cs.find(s=>s.type===ie.Shadowsocks)?.label,color:Ge[ie.Shadowsocks]},{value:ie.Vmess,label:cs.find(s=>s.type===ie.Vmess)?.label,color:Ge[ie.Vmess]},{value:ie.Trojan,label:cs.find(s=>s.type===ie.Trojan)?.label,color:Ge[ie.Trojan]},{value:ie.Hysteria,label:cs.find(s=>s.type===ie.Hysteria)?.label,color:Ge[ie.Hysteria]},{value:ie.Vless,label:cs.find(s=>s.type===ie.Vless)?.label,color:Ge[ie.Vless]},{value:ie.Tuic,label:cs.find(s=>s.type===ie.Tuic)?.label,color:Ge[ie.Tuic]},{value:ie.Socks,label:cs.find(s=>s.type===ie.Socks)?.label,color:Ge[ie.Socks]},{value:ie.Naive,label:cs.find(s=>s.type===ie.Naive)?.label,color:Ge[ie.Naive]},{value:ie.Http,label:cs.find(s=>s.type===ie.Http)?.label,color:Ge[ie.Http]},{value:ie.Mieru,label:cs.find(s=>s.type===ie.Mieru)?.label,color:Ge[ie.Mieru]}];function mx({table:s,saveOrder:a,isSortMode:t,groups:l}){const n=s.getState().columnFilters.length>0,{t:r}=V("server");return e.jsxs("div",{className:"flex items-center justify-between ",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[!t&&e.jsxs(e.Fragment,{children:[e.jsx(cx,{}),e.jsx(D,{placeholder:r("toolbar.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:o=>s.getColumn("name")?.setFilterValue(o.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("type")&&e.jsx(rl,{column:s.getColumn("type"),title:r("toolbar.type"),options:dx}),s.getColumn("group_ids")&&e.jsx(rl,{column:s.getColumn("group_ids"),title:r("columns.groups.title"),options:l.map(o=>({label:o.name,value:o.id.toString()}))})]}),n&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[r("toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]}),t&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:r("toolbar.sort.tip")})})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(L,{variant:t?"default":"outline",onClick:a,size:"sm",children:r(t?"toolbar.sort.save":"toolbar.sort.edit")})})]})}const wa=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.71 12.71a6 6 0 1 0-7.42 0a10 10 0 0 0-6.22 8.18a1 1 0 0 0 2 .22a8 8 0 0 1 15.9 0a1 1 0 0 0 1 .89h.11a1 1 0 0 0 .88-1.1a10 10 0 0 0-6.25-8.19M12 12a4 4 0 1 1 4-4a4 4 0 0 1-4 4"})}),ra={0:"bg-destructive/80 shadow-sm shadow-destructive/50",1:"bg-yellow-500/80 shadow-sm shadow-yellow-500/50",2:"bg-emerald-500/80 shadow-sm shadow-emerald-500/50"},Ee=(s,a)=>a>0?Math.round(s/a*100):0,ux=s=>{const{t:a}=V("server");return[{id:"drag-handle",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.sort")}),cell:()=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Da,{className:"size-4 cursor-move text-muted-foreground transition-colors hover:text-primary","aria-hidden":"true"})}),size:50},{accessorKey:"id",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.nodeId")}),cell:({row:t})=>{const l=t.getValue("id"),n=t.original.code;return e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs("div",{className:"group/id flex items-center space-x-2",children:[e.jsxs(G,{variant:"outline",className:y("border-2 font-medium transition-all duration-200 hover:opacity-80","flex items-center gap-1.5"),style:{borderColor:Ge[t.original.type]},children:[e.jsx(ir,{className:"size-3"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"flex items-center gap-0.5",children:n??l}),t.original.parent?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-muted-foreground/30",children:"→"}),e.jsx("span",{children:t.original.parent?.code||t.original.parent?.id})]}):""]})]}),e.jsx(L,{variant:"ghost",size:"icon",className:"size-5 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:text-muted-foreground group-hover/id:opacity-100",onClick:r=>{r.stopPropagation(),ba(n||l.toString()).then(()=>{$.success(a("common:copy.success"))})},children:e.jsx(Jn,{className:"size-3"})})]})}),e.jsxs(oe,{side:"top",className:"flex flex-col gap-1 p-3",children:[e.jsxs("p",{className:"font-medium",children:[cs.find(r=>r.type===t.original.type)?.label,t.original.parent?" (子节点)":""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n?"点击括号内容或复制按钮可复制节点代码":"点击复制按钮可复制节点ID"})]})]})})},size:50,enableSorting:!0},{accessorKey:"show",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.show")}),cell:({row:t})=>{const[l,n]=m.useState(!!t.getValue("show"));return e.jsx(Z,{checked:l,onCheckedChange:async r=>{n(r),Zs.update({id:t.original.id,type:t.original.type,show:r?1:0}).catch(()=>{n(!r),s()})},style:{backgroundColor:l?Ge[t.original.type]:void 0}})},size:50,enableSorting:!1},{accessorKey:"name",header:({column:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx(z,{column:t,title:a("columns.node"),tooltip:e.jsxs("div",{className:"grid grid-cols-1 gap-3 p-2",children:[e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:y("h-2.5 w-2.5 rounded-full",ra[0])}),e.jsx("span",{className:"text-sm font-medium",children:a("columns.status.0")})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:y("h-2.5 w-2.5 rounded-full",ra[1])}),e.jsx("span",{className:"text-sm font-medium",children:a("columns.status.1")})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:y("h-2.5 w-2.5 rounded-full",ra[2])}),e.jsx("span",{className:"text-sm font-medium",children:a("columns.status.2")})]})]})})}),cell:({row:t})=>e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:y("size-2.5 flex-shrink-0 rounded-full transition-all duration-200",ra[t.original.available_status])}),e.jsx("span",{className:"text-left font-medium transition-colors hover:text-primary",children:t.getValue("name")})]})}),e.jsx(oe,{children:e.jsxs("div",{className:" space-y-3",children:[e.jsx("p",{className:"font-medium",children:a(`columns.status.${t.original.available_status}`)}),t.original.load_status&&e.jsxs("div",{className:"border-t border-border/50 pt-3",children:[e.jsx("p",{className:"mb-3 text-sm font-medium",children:a("columns.loadStatus.details")}),e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx("div",{children:e.jsxs("div",{className:"mb-1.5 flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:[a("columns.loadStatus.cpu"),":"]}),e.jsxs("div",{className:"ml-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-20 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:y("h-full transition-all duration-300",t.original.load_status.cpu>=90?"bg-destructive":t.original.load_status.cpu>=70?"bg-yellow-500":"bg-emerald-500"),style:{width:`${Math.min(100,t.original.load_status.cpu)}%`}})}),e.jsxs("span",{className:y("min-w-[3rem] text-right font-semibold",t.original.load_status.cpu>=90?"text-destructive":t.original.load_status.cpu>=70?"text-yellow-600":"text-emerald-600"),children:[Math.round(t.original.load_status.cpu),"%"]})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1.5 flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:[a("columns.loadStatus.memory"),":"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-20 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:y("h-full transition-all duration-300",Ee(t.original.load_status.mem.used,t.original.load_status.mem.total)>=90?"bg-destructive":Ee(t.original.load_status.mem.used,t.original.load_status.mem.total)>=70?"bg-yellow-500":"bg-emerald-500"),style:{width:`${Ee(t.original.load_status.mem.used,t.original.load_status.mem.total)}%`}})}),e.jsxs("span",{className:y("min-w-[3rem] text-right font-semibold",Ee(t.original.load_status.mem.used,t.original.load_status.mem.total)>=90?"text-destructive":Ee(t.original.load_status.mem.used,t.original.load_status.mem.total)>=70?"text-yellow-600":"text-emerald-600"),children:[Ee(t.original.load_status.mem.used,t.original.load_status.mem.total),"%"]})]})]}),e.jsxs("div",{className:"ml-auto w-[9.5rem] text-right text-xs text-muted-foreground",children:[Oe(t.original.load_status.mem.used)," ","/"," ",Oe(t.original.load_status.mem.total)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1.5 flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:[a("columns.loadStatus.swap"),":"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-20 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:y("h-full transition-all duration-300",Ee(t.original.load_status.swap.used,t.original.load_status.swap.total)>=80?"bg-destructive":Ee(t.original.load_status.swap.used,t.original.load_status.swap.total)>=50?"bg-yellow-500":"bg-emerald-500"),style:{width:`${Ee(t.original.load_status.swap.used,t.original.load_status.swap.total)}%`}})}),e.jsxs("span",{className:y("min-w-[3rem] text-right font-semibold",Ee(t.original.load_status.swap.used,t.original.load_status.swap.total)>=80?"text-destructive":Ee(t.original.load_status.swap.used,t.original.load_status.swap.total)>=50?"text-yellow-600":"text-emerald-600"),children:[Ee(t.original.load_status.swap.used,t.original.load_status.swap.total),"%"]})]})]}),e.jsxs("div",{className:"ml-auto w-[9.5rem] text-right text-xs text-muted-foreground",children:[Oe(t.original.load_status.swap.used)," ","/"," ",Oe(t.original.load_status.swap.total)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1.5 flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:[a("columns.loadStatus.disk"),":"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-20 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:y("h-full transition-all duration-300",Ee(t.original.load_status.disk.used,t.original.load_status.disk.total)>=90?"bg-destructive":Ee(t.original.load_status.disk.used,t.original.load_status.disk.total)>=70?"bg-yellow-500":"bg-emerald-500"),style:{width:`${Ee(t.original.load_status.disk.used,t.original.load_status.disk.total)}%`}})}),e.jsxs("span",{className:y("min-w-[3rem] text-right font-semibold",Ee(t.original.load_status.disk.used,t.original.load_status.disk.total)>=90?"text-destructive":Ee(t.original.load_status.disk.used,t.original.load_status.disk.total)>=70?"text-yellow-600":"text-emerald-600"),children:[Ee(t.original.load_status.disk.used,t.original.load_status.disk.total),"%"]})]})]}),e.jsxs("div",{className:"ml-auto w-[9.5rem] text-right text-xs text-muted-foreground",children:[Oe(t.original.load_status.disk.used)," ","/"," ",Oe(t.original.load_status.disk.total)]})]})]})]})]})})]})}),enableSorting:!1,size:200},{accessorKey:"host",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.address")}),cell:({row:t})=>{const l=`${t.original.host}:${t.original.port}`,n=t.original.port!==t.original.server_port;return e.jsxs("div",{className:"group relative flex min-w-0 items-start",children:[e.jsxs("div",{className:"flex min-w-0 flex-wrap items-baseline gap-x-1 gap-y-0.5 pr-7",children:[e.jsx("div",{className:"flex items-center ",children:e.jsxs("span",{className:"font-mono text-sm font-medium text-foreground/90",children:[t.original.host,":",t.original.port]})}),n&&e.jsxs("span",{className:"whitespace-nowrap text-[0.7rem] tracking-tight text-muted-foreground/40",children:["(",a("columns.internalPort")," ",t.original.server_port,")"]})]}),e.jsx("div",{className:"absolute right-0 top-0",children:e.jsx(je,{delayDuration:0,children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"icon",className:"size-6 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:bg-muted/50 hover:text-muted-foreground group-hover:opacity-100",onClick:r=>{r.stopPropagation(),ba(l).then(()=>{$.success(a("common:copy.success"))})},children:e.jsx(Jn,{className:"size-3"})})}),e.jsx(oe,{side:"top",sideOffset:10,children:a("columns.copyAddress")})]})})})]})},enableSorting:!1,enableHiding:!0},{accessorKey:"online",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.onlineUsers.title"),tooltip:a("columns.onlineUsers.tooltip")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(wa,{className:"size-4"}),e.jsx("span",{className:"font-medium",children:t.getValue("online")})]}),size:80,enableSorting:!0,enableHiding:!0},{accessorKey:"rate",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.rate.title"),tooltip:a("columns.rate.tooltip")}),cell:({row:t})=>e.jsxs(G,{variant:"secondary",className:"font-medium",children:[t.getValue("rate")," x"]}),size:80,enableSorting:!1,enableHiding:!0},{accessorKey:"group_ids",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.groups.title"),tooltip:a("columns.groups.tooltip")}),cell:({row:t})=>{const l=t.original.groups||[];return e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[l.map((n,r)=>e.jsx(G,{variant:"secondary",className:y("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:n.name},r)),l.length===0&&e.jsx("span",{className:"text-sm text-muted-foreground",children:a("columns.groups.empty")})]})},enableSorting:!1,filterFn:(t,l,n)=>{const r=t.getValue(l);return r?n.some(o=>r.includes(o)):!1}},{accessorKey:"type",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.type")}),cell:({row:t})=>{const l=t.getValue("type");return e.jsx(G,{variant:"outline",className:"border-2 font-medium transition-colors",style:{borderColor:Ge[l]},children:l})},enableSorting:!1,enableHiding:!0,enableColumnFilter:!1,size:8e3},{id:"actions",header:({column:t})=>e.jsx(z,{className:"justify-end",column:t,title:a("columns.actions")}),cell:({row:t})=>{const{setIsOpen:l,setEditingServer:n,setServerType:r}=Kr();return e.jsx("div",{className:"flex justify-center",children:e.jsxs(Es,{modal:!1,children:[e.jsx(Is,{asChild:!0,children:e.jsx(L,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":a("columns.actions"),children:e.jsx(va,{className:"size-4"})})}),e.jsxs(ws,{align:"end",className:"w-40",children:[e.jsx(_e,{className:"cursor-pointer",onClick:()=>{r(t.original.type),n(t.original),l(!0)},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(zc,{className:"mr-2 size-4"}),a("columns.actions_dropdown.edit")]})}),e.jsxs(_e,{className:"cursor-pointer",onClick:async()=>{Zs.copy({id:t.original.id}).then(({data:o})=>{o&&($.success(a("columns.actions_dropdown.copy_success")),s())})},children:[e.jsx($c,{className:"mr-2 size-4"}),a("columns.actions_dropdown.copy")]}),e.jsx(Nt,{}),e.jsx(_e,{className:"cursor-pointer text-destructive focus:text-destructive",onSelect:o=>o.preventDefault(),children:e.jsx(ls,{title:a("columns.actions_dropdown.delete.title"),description:a("columns.actions_dropdown.delete.description"),confirmText:a("columns.actions_dropdown.delete.confirm"),variant:"destructive",onConfirm:async()=>{Zs.drop({id:t.original.id}).then(({data:o})=>{o&&($.success(a("columns.actions_dropdown.delete_success")),s())})},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(We,{className:"mr-2 size-4"}),a("columns.actions_dropdown.delete.confirm")]})})})]})]})})},size:50}]};function xx(){const[s,a]=m.useState({}),[t,l]=m.useState({"drag-handle":!1}),[n,r]=m.useState([]),[o,c]=m.useState({pageSize:500,pageIndex:0}),[u,i]=m.useState([]),[d,h]=m.useState(!1),[k,C]=m.useState({}),[S,w]=m.useState([]),{refetch:N}=le({queryKey:["nodeList"],queryFn:async()=>{const{data:I}=await Zs.getList();return w(I),I}}),{data:g}=le({queryKey:["groups"],queryFn:async()=>{const{data:I}=await rt.getList();return I}});m.useEffect(()=>{l({"drag-handle":d,show:!d,host:!d,online:!d,rate:!d,groups:!d,type:!1,actions:!d}),C({name:d?2e3:200}),c({pageSize:d?99999:500,pageIndex:0})},[d]);const T=(I,H)=>{d&&(I.dataTransfer.setData("text/plain",H.toString()),I.currentTarget.classList.add("opacity-50"))},E=(I,H)=>{if(!d)return;I.preventDefault(),I.currentTarget.classList.remove("bg-muted");const O=parseInt(I.dataTransfer.getData("text/plain"));if(O===H)return;const B=[...S],[ue]=B.splice(O,1);B.splice(H,0,ue),w(B)},p=async()=>{if(!d){h(!0);return}const I=S?.map((H,O)=>({id:H.id,order:O+1}));Zs.sort(I).then(()=>{$.success("排序保存成功"),h(!1),N()}).finally(()=>{h(!1)})},_=Je({data:S||[],columns:ux(N),state:{sorting:u,columnVisibility:t,rowSelection:s,columnFilters:n,columnSizing:k,pagination:o},enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:i,onColumnFiltersChange:r,onColumnVisibilityChange:l,onColumnSizingChange:C,onPaginationChange:c,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(Uu,{refetch:N,children:e.jsx("div",{className:"space-y-4",children:e.jsx(os,{table:_,toolbar:I=>e.jsx(mx,{table:I,refetch:N,saveOrder:p,isSortMode:d,groups:g||[]}),draggable:d,onDragStart:T,onDragEnd:I=>I.currentTarget.classList.remove("opacity-50"),onDragOver:I=>{I.preventDefault(),I.currentTarget.classList.add("bg-muted")},onDragLeave:I=>I.currentTarget.classList.remove("bg-muted"),onDrop:E,showPagination:!d})})})}function hx(){const{t:s}=V("server");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("manage.title")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("manage.description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(xx,{})})]})]})}const px=Object.freeze(Object.defineProperty({__proto__:null,default:hx},Symbol.toStringTag,{value:"Module"}));function gx({table:s,refetch:a}){const t=s.getState().columnFilters.length>0,{t:l}=V("group");return e.jsx("div",{className:"flex items-center justify-between space-x-4",children:e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(qa,{refetch:a}),e.jsx(D,{placeholder:l("toolbar.searchPlaceholder"),value:s.getColumn("name")?.getFilterValue()??"",onChange:n=>s.getColumn("name")?.setFilterValue(n.target.value),className:y("h-8  w-[150px] lg:w-[250px]",t&&"border-primary/50 ring-primary/20")}),t&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[l("toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]})})}const fx=s=>{const{t:a}=V("group");return[{accessorKey:"id",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.id")}),cell:({row:t})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(G,{variant:"outline",children:t.getValue("id")})}),enableSorting:!0},{accessorKey:"name",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.name")}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium",children:t.getValue("name")})})},{accessorKey:"users_count",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.usersCount")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(wa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.getValue("users_count")})]}),enableSorting:!0},{accessorKey:"server_count",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.serverCount")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(ir,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.getValue("server_count")})]}),enableSorting:!0,size:8e3},{id:"actions",header:({column:t})=>e.jsx(z,{className:"justify-end",column:t,title:a("columns.actions")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(qa,{defaultValues:t.original,refetch:s,type:"edit",dialogTrigger:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("form.edit")})]})}),e.jsx(ls,{title:a("messages.deleteConfirm"),description:a("messages.deleteDescription"),confirmText:a("messages.deleteButton"),variant:"destructive",onConfirm:async()=>{rt.drop({id:t.original.id}).then(({data:l})=>{l&&($.success(a("messages.updateSuccess")),s())})},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:a("messages.deleteButton")})]})})]})}]};function jx(){const[s,a]=m.useState({}),[t,l]=m.useState({}),[n,r]=m.useState([]),[o,c]=m.useState([]),{data:u,refetch:i,isLoading:d}=le({queryKey:["serverGroupList"],queryFn:async()=>{const{data:k}=await rt.getList();return k}}),h=Je({data:u||[],columns:fx(i),state:{sorting:o,columnVisibility:t,rowSelection:s,columnFilters:n},enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:c,onColumnFiltersChange:r,onColumnVisibilityChange:l,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(os,{table:h,toolbar:k=>e.jsx(gx,{table:k,refetch:i}),isLoading:d})}function vx(){const{t:s}=V("group");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(jx,{})})]})]})}const bx=Object.freeze(Object.defineProperty({__proto__:null,default:vx},Symbol.toStringTag,{value:"Module"})),yx=s=>x.object({remarks:x.string().min(1,s("form.validation.remarks")),match:x.array(x.string()),action:x.enum(["block","dns"]),action_value:x.string().optional()});function Br({refetch:s,dialogTrigger:a,defaultValues:t={remarks:"",match:[],action:"block",action_value:""},type:l="add"}){const{t:n}=V("route"),r=Ne({resolver:we(yx(n)),defaultValues:t,mode:"onChange"}),[o,c]=m.useState(!1);return e.jsxs(ge,{open:o,onOpenChange:c,children:[e.jsx(is,{asChild:!0,children:a||e.jsxs(L,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(ze,{icon:"ion:add"})," ",e.jsx("div",{children:n("form.add")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:n(l==="edit"?"form.edit":"form.create")}),e.jsx(Re,{})]}),e.jsxs(Ce,{...r,children:[e.jsx(v,{control:r.control,name:"remarks",render:({field:u})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:n("form.remarks")}),e.jsx("div",{className:"relative",children:e.jsx(b,{children:e.jsx(D,{type:"text",placeholder:n("form.remarksPlaceholder"),...u})})}),e.jsx(P,{})]})}),e.jsx(v,{control:r.control,name:"match",render:({field:u})=>e.jsxs(f,{className:"flex-[2]",children:[e.jsx(j,{children:n("form.match")}),e.jsx("div",{className:"relative",children:e.jsx(b,{children:e.jsx(ks,{className:"min-h-[120px]",placeholder:n("form.matchPlaceholder"),value:u.value.join(`
`),onChange:i=>{u.onChange(i.target.value.split(`
`))}})})}),e.jsx(P,{})]})}),e.jsx(v,{control:r.control,name:"action",render:({field:u})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.action")}),e.jsx("div",{className:"relative",children:e.jsx(b,{children:e.jsxs(J,{onValueChange:u.onChange,defaultValue:u.value,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:n("form.actionPlaceholder")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"block",children:n("actions.block")}),e.jsx(A,{value:"dns",children:n("actions.dns")})]})]})})}),e.jsx(P,{})]})}),r.watch("action")==="dns"&&e.jsx(v,{control:r.control,name:"action_value",render:({field:u})=>e.jsxs(f,{children:[e.jsx(j,{children:n("form.dns")}),e.jsx("div",{className:"relative",children:e.jsx(b,{children:e.jsx(D,{type:"text",placeholder:n("form.dnsPlaceholder"),...u})})})]})}),e.jsxs(Le,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(L,{variant:"outline",children:n("form.cancel")})}),e.jsx(L,{type:"submit",onClick:()=>{Ia.save(r.getValues()).then(({data:u})=>{u&&(c(!1),s&&s(),$.success(n(l==="edit"?"messages.updateSuccess":"messages.createSuccess")),r.reset())})},children:n("form.submit")})]})]})]})]})}function Nx({table:s,refetch:a}){const t=s.getState().columnFilters.length>0,{t:l}=V("route");return e.jsx("div",{className:"flex items-center justify-between ",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(Br,{refetch:a}),e.jsx(D,{placeholder:l("toolbar.searchPlaceholder"),value:s.getColumn("remarks")?.getFilterValue()??"",onChange:n=>s.getColumn("remarks")?.setFilterValue(n.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),t&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[l("toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]})})}function _x({columns:s,data:a,refetch:t}){const[l,n]=m.useState({}),[r,o]=m.useState({}),[c,u]=m.useState([]),[i,d]=m.useState([]),h=Je({data:a,columns:s,state:{sorting:i,columnVisibility:r,rowSelection:l,columnFilters:c},enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:d,onColumnFiltersChange:u,onColumnVisibilityChange:o,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(os,{table:h,toolbar:k=>e.jsx(Nx,{table:k,refetch:t})})}const wx=s=>{const{t:a}=V("route"),t={block:{icon:Ac,variant:"destructive",className:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-800"},dns:{icon:qc,variant:"secondary",className:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800"}};return[{accessorKey:"id",header:({column:l})=>e.jsx(z,{column:l,title:a("columns.id")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(G,{variant:"outline",children:l.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"remarks",header:({column:l})=>e.jsx(z,{column:l,title:a("columns.remarks")}),cell:({row:l})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:l.original.remarks})}),enableHiding:!1,enableSorting:!1},{accessorKey:"action_value",header:({column:l})=>e.jsx(z,{column:l,title:a("columns.action_value.title")}),cell:({row:l})=>{const n=l.original.action,r=l.original.action_value,o=l.original.match?.length||0;return e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",children:n==="dns"&&r?a("columns.action_value.dns",{value:r}):n==="block"?e.jsx("span",{className:"text-destructive",children:a("columns.action_value.block")}):a("columns.action_value.direct")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("columns.matchRules",{count:o})})]})},enableHiding:!1,enableSorting:!1,size:300},{accessorKey:"action",header:({column:l})=>e.jsx(z,{column:l,title:a("columns.action")}),cell:({row:l})=>{const n=l.getValue("action"),r=t[n]?.icon;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(G,{variant:t[n]?.variant||"default",className:y("flex items-center gap-1.5 px-3 py-1 capitalize",t[n]?.className),children:[r&&e.jsx(r,{className:"h-3.5 w-3.5"}),a(`actions.${n}`)]})})},enableSorting:!1,size:9e3},{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:a("columns.actions")}),cell:({row:l})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Br,{defaultValues:l.original,refetch:s,type:"edit",dialogTrigger:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("form.edit")})]})}),e.jsx(ls,{title:a("messages.deleteConfirm"),description:a("messages.deleteDescription"),confirmText:a("messages.deleteButton"),variant:"destructive",onConfirm:async()=>{Ia.drop({id:l.original.id}).then(({data:n})=>{n&&($.success(a("messages.deleteSuccess")),s())})},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:a("messages.deleteButton")})]})})]})}]};function Cx(){const{t:s}=V("route"),[a,t]=m.useState([]);function l(){Ia.getList().then(({data:n})=>{t(n)})}return m.useEffect(()=>{l()},[]),e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(_x,{data:a,columns:wx(l),refetch:l})})]})]})}const Sx=Object.freeze(Object.defineProperty({__proto__:null,default:Cx},Symbol.toStringTag,{value:"Module"})),Gr=m.createContext(void 0);function kx({children:s,refreshData:a}){const[t,l]=m.useState(!1),[n,r]=m.useState(null);return e.jsx(Gr.Provider,{value:{isOpen:t,setIsOpen:l,editingPlan:n,setEditingPlan:r,refreshData:a},children:s})}function Dn(){const s=m.useContext(Gr);if(s===void 0)throw new Error("usePlanEdit must be used within a PlanEditProvider");return s}function Tx({table:s,saveOrder:a,isSortMode:t}){const{setIsOpen:l}=Dn(),{t:n}=V("subscribe");return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsxs(L,{variant:"outline",className:"space-x-2",size:"sm",onClick:()=>l(!0),children:[e.jsx(ze,{icon:"ion:add"}),e.jsx("div",{children:n("plan.add")})]}),e.jsx(D,{placeholder:n("plan.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:r=>s.getColumn("name")?.setFilterValue(r.target.value),className:"h-8 w-[150px] lg:w-[250px]"})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(L,{variant:t?"default":"outline",onClick:a,size:"sm",children:n(t?"plan.sort.save":"plan.sort.edit")})})]})}const il={monthly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},quarterly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},half_yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},two_yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},three_yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},onetime:{color:"text-slate-700",bgColor:"bg-slate-100/80"},reset_traffic:{color:"text-slate-700",bgColor:"bg-slate-100/80"}},Dx=s=>{const{t:a}=V("subscribe");return[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:"cursor-move",children:e.jsx(Da,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(G,{variant:"outline",children:t.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"show",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.show")}),cell:({row:t})=>e.jsx(Z,{defaultChecked:t.getValue("show"),onCheckedChange:l=>{ss.update({id:t.original.id,show:l}).then(({data:n})=>{!n&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"sell",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.sell")}),cell:({row:t})=>e.jsx(Z,{defaultChecked:t.getValue("sell"),onCheckedChange:l=>{ss.update({id:t.original.id,sell:l}).then(({data:n})=>{!n&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"renew",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.renew"),tooltip:a("plan.columns.renew_tooltip")}),cell:({row:t})=>e.jsx(Z,{defaultChecked:t.getValue("renew"),onCheckedChange:l=>{ss.update({id:t.original.id,renew:l}).then(({data:n})=>{!n&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.name")}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:t.getValue("name")})}),enableSorting:!1,enableHiding:!1,size:900},{accessorKey:"users_count",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.stats")}),cell:({row:t})=>{const l=t.getValue("users_count")||0,n=t.original.active_users_count||0,r=l>0?Math.round(n/l*100):0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1 rounded-md bg-slate-50 px-2 py-1 hover:bg-slate-100 transition-colors cursor-help",children:[e.jsx(pa,{className:"h-3.5 w-3.5 text-slate-500"}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:l})]})}),e.jsx(oe,{side:"top",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"总用户数"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"所有使用该套餐的用户（包括已过期）"})]})})]})}),e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1 rounded-md bg-green-50 px-2 py-1 hover:bg-green-100 transition-colors cursor-help",children:[e.jsx(Hc,{className:"h-3.5 w-3.5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:n})]})}),e.jsx(oe,{side:"top",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"有效期内用户"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"当前仍在有效期内的活跃用户"}),l>0&&e.jsxs("p",{className:"text-xs font-medium text-green-600",children:["活跃率：",r,"%"]})]})})]})})]})},enableSorting:!0,size:120},{accessorKey:"group",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.group")}),cell:({row:t})=>e.jsx("div",{className:"flex max-w-[600px] flex-wrap items-center gap-1.5 text-nowrap",children:e.jsx(G,{variant:"secondary",className:y("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:t.getValue("group")?.name})}),enableSorting:!1,enableHiding:!1},{accessorKey:"prices",header:({column:t})=>e.jsx(z,{column:t,title:a("plan.columns.price")}),cell:({row:t})=>{const l=t.getValue("prices"),n=[{period:a("plan.columns.price_period.monthly"),key:"monthly",unit:a("plan.columns.price_period.unit.month")},{period:a("plan.columns.price_period.quarterly"),key:"quarterly",unit:a("plan.columns.price_period.unit.quarter")},{period:a("plan.columns.price_period.half_yearly"),key:"half_yearly",unit:a("plan.columns.price_period.unit.half_year")},{period:a("plan.columns.price_period.yearly"),key:"yearly",unit:a("plan.columns.price_period.unit.year")},{period:a("plan.columns.price_period.two_yearly"),key:"two_yearly",unit:a("plan.columns.price_period.unit.two_year")},{period:a("plan.columns.price_period.three_yearly"),key:"three_yearly",unit:a("plan.columns.price_period.unit.three_year")},{period:a("plan.columns.price_period.onetime"),key:"onetime",unit:""},{period:a("plan.columns.price_period.reset_traffic"),key:"reset_traffic",unit:a("plan.columns.price_period.unit.times")}];return e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:n.map(({period:r,key:o,unit:c})=>l[o]!=null&&e.jsxs(G,{variant:"secondary",className:y("px-2 py-0.5 font-medium transition-colors text-nowrap",il[o].color,il[o].bgColor,"border border-border/50","hover:bg-slate-200/80"),children:[r," ¥",l[o],c]},o))})},enableSorting:!1,size:9e3},{id:"actions",header:({column:t})=>e.jsx(z,{className:"justify-end",column:t,title:a("plan.columns.actions")}),cell:({row:t})=>{const{setIsOpen:l,setEditingPlan:n}=Dn();return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",onClick:()=>{n(t.original),l(!0)},children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("plan.columns.edit")})]}),e.jsx(ls,{title:a("plan.columns.delete_confirm.title"),description:a("plan.columns.delete_confirm.description"),confirmText:a("plan.columns.delete"),variant:"destructive",onConfirm:async()=>{ss.drop({id:t.original.id}).then(({data:r})=>{r&&($.success(a("plan.columns.delete_confirm.success")),s())})},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:a("plan.columns.delete")})]})})]})}}]},Px=x.object({id:x.number().nullable(),group_id:x.union([x.number(),x.string()]).nullable().optional(),name:x.string().min(1).max(250),content:x.string().nullable().optional(),transfer_enable:x.union([x.number().min(0),x.string().min(1)]),prices:x.object({monthly:x.union([x.number(),x.string()]).nullable().optional(),quarterly:x.union([x.number(),x.string()]).nullable().optional(),half_yearly:x.union([x.number(),x.string()]).nullable().optional(),yearly:x.union([x.number(),x.string()]).nullable().optional(),two_yearly:x.union([x.number(),x.string()]).nullable().optional(),three_yearly:x.union([x.number(),x.string()]).nullable().optional(),onetime:x.union([x.number(),x.string()]).nullable().optional(),reset_traffic:x.union([x.number(),x.string()]).nullable().optional()}).default({}),speed_limit:x.union([x.number(),x.string()]).nullable().optional(),capacity_limit:x.union([x.number(),x.string()]).nullable().optional(),device_limit:x.union([x.number(),x.string()]).nullable().optional(),force_update:x.boolean().optional(),reset_traffic_method:x.number().nullable(),users_count:x.number().optional(),active_users_count:x.number().optional(),group:x.object({id:x.number(),name:x.string()}).optional()}),Pn=m.forwardRef(({className:s,...a},t)=>e.jsx(or,{ref:t,className:y("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(Uc,{className:y("flex items-center justify-center text-current"),children:e.jsx(at,{className:"h-4 w-4"})})}));Pn.displayName=or.displayName;const ia={id:null,group_id:null,name:"",content:"",transfer_enable:"",prices:{monthly:"",quarterly:"",half_yearly:"",yearly:"",two_yearly:"",three_yearly:"",onetime:"",reset_traffic:""},speed_limit:"",capacity_limit:"",device_limit:"",force_update:!1,reset_traffic_method:null},oa={monthly:{label:"月付",months:1,discount:1},quarterly:{label:"季付",months:3,discount:.95},half_yearly:{label:"半年付",months:6,discount:.9},yearly:{label:"年付",months:12,discount:.85},two_yearly:{label:"两年付",months:24,discount:.8},three_yearly:{label:"三年付",months:36,discount:.75},onetime:{label:"流量包",months:1,discount:1},reset_traffic:{label:"重置包",months:1,discount:1}},Lx=[{value:null,label:"follow_system"},{value:0,label:"monthly_first"},{value:1,label:"monthly_reset"},{value:2,label:"no_reset"},{value:3,label:"yearly_first"},{value:4,label:"yearly_reset"}];function Ex(){const{isOpen:s,setIsOpen:a,editingPlan:t,setEditingPlan:l,refreshData:n}=Dn(),[r,o]=m.useState(!1),{t:c}=V("subscribe"),u=Ne({resolver:we(Px),defaultValues:{...ia,...t||{}},mode:"onChange"});m.useEffect(()=>{t?u.reset({...ia,...t}):u.reset(ia)},[t,u]);const i=new vn({html:!0}),[d,h]=m.useState();async function k(){rt.getList().then(({data:w})=>{h(w)})}m.useEffect(()=>{s&&k()},[s]);const C=w=>{if(isNaN(w))return;const N=Object.entries(oa).reduce((g,[T,E])=>{const p=w*E.months*E.discount;return{...g,[T]:p.toFixed(2)}},{});u.setValue("prices",N,{shouldDirty:!0})},S=()=>{a(!1),l(null),u.reset(ia)};return e.jsx(ge,{open:s,onOpenChange:S,children:e.jsxs(pe,{children:[e.jsxs(ve,{children:[e.jsx(fe,{children:c(t?"plan.form.edit_title":"plan.form.add_title")}),e.jsx(Re,{})]}),e.jsxs(Ce,{...u,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{control:u.control,name:"name",render:({field:w})=>e.jsxs(f,{children:[e.jsx(j,{children:c("plan.form.name.label")}),e.jsx(b,{children:e.jsx(D,{placeholder:c("plan.form.name.placeholder"),...w})}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"group_id",render:({field:w})=>e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center justify-between",children:[c("plan.form.group.label"),e.jsx(qa,{dialogTrigger:e.jsx(L,{variant:"link",children:c("plan.form.group.add")}),refetch:k})]}),e.jsxs(J,{value:w.value?.toString()??"",onValueChange:N=>w.onChange(N?Number(N):null),children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:c("plan.form.group.placeholder")})})}),e.jsx(Y,{children:d?.map(N=>e.jsx(A,{value:N.id.toString(),children:N.name},N.id))})]}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"transfer_enable",render:({field:w})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:c("plan.form.transfer.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(b,{children:e.jsx(D,{type:"number",min:0,placeholder:c("plan.form.transfer.placeholder"),className:"rounded-r-none",...w})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:c("plan.form.transfer.unit")})]}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"speed_limit",render:({field:w})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:c("plan.form.speed.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(b,{children:e.jsx(D,{type:"number",min:0,placeholder:c("plan.form.speed.placeholder"),className:"rounded-r-none",...w,value:w.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:c("plan.form.speed.unit")})]}),e.jsx(P,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"}),e.jsx("h3",{className:"mx-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:c("plan.form.price.title")}),e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(D,{type:"number",placeholder:c("plan.form.price.base_price"),className:"h-7 w-32 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500",onChange:w=>{const N=parseFloat(w.target.value);C(N)}})]}),e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(L,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{const w=Object.keys(oa).reduce((N,g)=>({...N,[g]:""}),{});u.setValue("prices",w,{shouldDirty:!0})},children:c("plan.form.price.clear.button")})}),e.jsx(oe,{side:"top",align:"end",children:e.jsx("p",{className:"text-xs",children:c("plan.form.price.clear.tooltip")})})]})})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-3",children:Object.entries(oa).filter(([w])=>!["onetime","reset_traffic"].includes(w)).map(([w,N])=>e.jsx("div",{className:"group relative rounded-md bg-card p-2 ring-1 ring-gray-200 transition-all hover:ring-primary dark:ring-gray-800",children:e.jsx(v,{control:u.control,name:`prices.${w}`,render:({field:g})=>e.jsxs(f,{children:[e.jsxs(j,{className:"text-xs font-medium text-muted-foreground",children:[c(`plan.columns.price_period.${w}`),e.jsxs("span",{className:"ml-1 text-[10px] text-gray-400",children:["(",N.months===1?c("plan.form.price.period.monthly"):c("plan.form.price.period.months",{count:N.months}),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:"0.00",min:0,...g,value:g.value??"",onChange:T=>g.onChange(T.target.value),className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})},w))}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Object.entries(oa).filter(([w])=>["onetime","reset_traffic"].includes(w)).map(([w,N])=>e.jsx("div",{className:"rounded-md border border-dashed border-gray-200 bg-muted/30 p-3 dark:border-gray-700",children:e.jsx(v,{control:u.control,name:`prices.${w}`,render:({field:g})=>e.jsx(f,{children:e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsx(j,{className:"text-xs font-medium",children:c(`plan.columns.price_period.${w}`)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:c(w==="onetime"?"plan.form.price.onetime_desc":"plan.form.price.reset_desc")})]}),e.jsxs("div",{className:"relative w-full md:w-32",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:"0.00",min:0,...g,className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})})},w))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(v,{control:u.control,name:"device_limit",render:({field:w})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:c("plan.form.device.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(b,{children:e.jsx(D,{type:"number",min:0,placeholder:c("plan.form.device.placeholder"),className:"rounded-r-none",...w,value:w.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:c("plan.form.device.unit")})]}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"capacity_limit",render:({field:w})=>e.jsxs(f,{className:"flex-1",children:[e.jsx(j,{children:c("plan.form.capacity.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(b,{children:e.jsx(D,{type:"number",min:0,placeholder:c("plan.form.capacity.placeholder"),className:"rounded-r-none",...w,value:w.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:c("plan.form.capacity.unit")})]}),e.jsx(P,{})]})})]}),e.jsx(v,{control:u.control,name:"reset_traffic_method",render:({field:w})=>e.jsxs(f,{children:[e.jsx(j,{children:c("plan.form.reset_method.label")}),e.jsxs(J,{value:w.value?.toString()??"null",onValueChange:N=>w.onChange(N=="null"?null:Number(N)),children:[e.jsx(b,{children:e.jsx(W,{children:e.jsx(Q,{placeholder:c("plan.form.reset_method.placeholder")})})}),e.jsx(Y,{children:Lx.map(N=>e.jsx(A,{value:N.value?.toString()??"null",children:c(`plan.form.reset_method.options.${N.label}`)},N.value))})]}),e.jsx(M,{className:"text-xs",children:c("plan.form.reset_method.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:u.control,name:"content",render:({field:w})=>{const[N,g]=m.useState(!1);return e.jsxs(f,{className:"space-y-2",children:[e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c("plan.form.content.label"),e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>g(!N),children:N?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{d:"M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"}),e.jsx("path",{fillRule:"evenodd",d:"M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.28 2.22a.75.75 0 00-1.06 1.06l14.5 14.5a.75.75 0 101.06-1.06l-1.745-1.745a10.029 10.029 0 003.3-4.38 1.651 1.651 0 000-1.185A10.004 10.004 0 009.999 3a9.956 9.956 0 00-4.744 1.194L3.28 2.22zM7.752 6.69l1.092 1.092a2.5 2.5 0 013.374 3.373l1.091 1.092a4 4 0 00-5.557-5.557z",clipRule:"evenodd"}),e.jsx("path",{d:"M10.748 13.93l2.523 2.523a9.987 9.987 0 01-3.27.547c-4.258 0-7.894-2.66-9.337-6.41a1.651 1.651 0 010-1.186A10.007 10.007 0 012.839 6.02L6.07 9.252a4 4 0 004.678 4.678z"})]})})}),e.jsx(oe,{side:"top",children:e.jsx("p",{className:"text-xs",children:c(N?"plan.form.content.preview_button.hide":"plan.form.content.preview_button.show")})})]})})]}),e.jsx(je,{children:e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(L,{variant:"outline",size:"sm",onClick:()=>{w.onChange(c("plan.form.content.template.content"))},children:c("plan.form.content.template.button")})}),e.jsx(oe,{side:"left",align:"center",children:e.jsx("p",{className:"text-xs",children:c("plan.form.content.template.tooltip")})})]})})]}),e.jsxs("div",{className:`grid gap-4 ${N?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"}`,children:[e.jsx("div",{className:"space-y-2",children:e.jsx(b,{children:e.jsx(bn,{style:{height:"400px"},value:w.value||"",renderHTML:T=>i.render(T),onChange:({text:T})=>w.onChange(T),config:{view:{menu:!0,md:!0,html:!1},canView:{menu:!0,md:!0,html:!1,fullScreen:!1,hideMenu:!1}},placeholder:c("plan.form.content.placeholder"),className:"rounded-md border"})})}),N&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:c("plan.form.content.preview")}),e.jsx("div",{className:"prose prose-sm dark:prose-invert h-[400px] max-w-none overflow-y-auto rounded-md border p-4",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:i.render(w.value||"")}})})]})]}),e.jsx(M,{className:"text-xs",children:c("plan.form.content.description")}),e.jsx(P,{})]})}})]}),e.jsx(Le,{className:"mt-6",children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0",children:t&&e.jsx(v,{control:u.control,name:"force_update",render:({field:w})=>e.jsxs(f,{className:"flex flex-row items-center space-x-2 space-y-0",children:[e.jsx(b,{children:e.jsx(Pn,{checked:w.value,onCheckedChange:w.onChange})}),e.jsx("div",{className:"",children:e.jsx(j,{className:"text-sm",children:c("plan.form.force_update.label")})})]})})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(L,{type:"button",variant:"outline",onClick:S,children:c("plan.form.submit.cancel")}),e.jsx(L,{type:"submit",disabled:r,onClick:()=>{u.handleSubmit(async w=>{o(!0),(await ss.save(w)).data&&($.success(c(t?"plan.form.submit.success.update":"plan.form.submit.success.add")),S(),n()),o(!1)})()},children:c(r?"plan.form.submit.submitting":"plan.form.submit.submit")})]})]})})]})]})})}function Ix(){const[s,a]=m.useState({}),[t,l]=m.useState({"drag-handle":!1}),[n,r]=m.useState([]),[o,c]=m.useState([]),[u,i]=m.useState(!1),[d,h]=m.useState({pageSize:20,pageIndex:0}),[k,C]=m.useState([]),{refetch:S}=le({queryKey:["planList"],queryFn:async()=>{const{data:E}=await ss.getList();return C(E),E}});m.useEffect(()=>{l({"drag-handle":u}),h({pageSize:u?99999:10,pageIndex:0})},[u]);const w=(E,p)=>{u&&(E.dataTransfer.setData("text/plain",p.toString()),E.currentTarget.classList.add("opacity-50"))},N=(E,p)=>{if(!u)return;E.preventDefault(),E.currentTarget.classList.remove("bg-muted");const _=parseInt(E.dataTransfer.getData("text/plain"));if(_===p)return;const I=[...k],[H]=I.splice(_,1);I.splice(p,0,H),C(I)},g=async()=>{if(!u){i(!0);return}const E=k?.map(p=>p.id);ss.sort(E).then(()=>{$.success("排序保存成功"),i(!1),S()}).finally(()=>{i(!1)})},T=Je({data:k||[],columns:Dx(S),state:{sorting:o,columnVisibility:t,rowSelection:s,columnFilters:n,pagination:d},enableRowSelection:!0,onPaginationChange:h,onRowSelectionChange:a,onSortingChange:c,onColumnFiltersChange:r,onColumnVisibilityChange:l,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}},pageCount:u?1:void 0});return e.jsx(kx,{refreshData:S,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(os,{table:T,toolbar:E=>e.jsx(Tx,{table:E,refetch:S,saveOrder:g,isSortMode:u}),draggable:u,onDragStart:w,onDragEnd:E=>E.currentTarget.classList.remove("opacity-50"),onDragOver:E=>{E.preventDefault(),E.currentTarget.classList.add("bg-muted")},onDragLeave:E=>E.currentTarget.classList.remove("bg-muted"),onDrop:N,showPagination:!u}),e.jsx(Ex,{})]})})}function Rx(){const{t:s}=V("subscribe");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("plan.title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("plan.page.description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ix,{})})]})]})}const Vx=Object.freeze(Object.defineProperty({__proto__:null,default:Rx},Symbol.toStringTag,{value:"Module"})),pt=[{value:ne.PENDING,label:Rt[ne.PENDING],icon:Kc,color:Vt[ne.PENDING]},{value:ne.PROCESSING,label:Rt[ne.PROCESSING],icon:cr,color:Vt[ne.PROCESSING]},{value:ne.COMPLETED,label:Rt[ne.COMPLETED],icon:on,color:Vt[ne.COMPLETED]},{value:ne.CANCELLED,label:Rt[ne.CANCELLED],icon:dr,color:Vt[ne.CANCELLED]},{value:ne.DISCOUNTED,label:Rt[ne.DISCOUNTED],icon:on,color:Vt[ne.DISCOUNTED]}],zt=[{value:ye.PENDING,label:aa[ye.PENDING],icon:Bc,color:na[ye.PENDING]},{value:ye.PROCESSING,label:aa[ye.PROCESSING],icon:cr,color:na[ye.PROCESSING]},{value:ye.VALID,label:aa[ye.VALID],icon:on,color:na[ye.VALID]},{value:ye.INVALID,label:aa[ye.INVALID],icon:dr,color:na[ye.INVALID]}];function ca({column:s,title:a,options:t}){const l=s?.getFacetedUniqueValues(),n=s?.getFilterValue(),r=Array.isArray(n)?new Set(n):n!==void 0?new Set([n]):new Set;return e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Pa,{className:"mr-2 h-4 w-4"}),a,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):t.filter(o=>r.has(o.value)).map(o=>e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:o.label},o.value))})]})]})}),e.jsx(bs,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Us,{children:[e.jsx(it,{placeholder:a}),e.jsxs(Ks,{children:[e.jsx(ot,{children:"No results found."}),e.jsx(ns,{children:t.map(o=>{const c=r.has(o.value);return e.jsxs($e,{onSelect:()=>{const u=new Set(r);c?u.delete(o.value):u.add(o.value);const i=Array.from(u);s?.setFilterValue(i.length?i:void 0)},children:[e.jsx("div",{className:y("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(at,{className:y("h-4 w-4")})}),o.icon&&e.jsx(o.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${o.color}`}),e.jsx("span",{children:o.label}),l?.get(o.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(o.value)})]},o.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{}),e.jsx(ns,{children:e.jsx($e,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Fx=x.object({email:x.string().min(1),plan_id:x.number(),period:x.string(),total_amount:x.number()}),Mx={email:"",plan_id:0,total_amount:0,period:""};function Wr({refetch:s,trigger:a,defaultValues:t}){const{t:l}=V("order"),[n,r]=m.useState(!1),o=Ne({resolver:we(Fx),defaultValues:{...Mx,...t},mode:"onChange"}),[c,u]=m.useState([]);return m.useEffect(()=>{n&&ss.getList().then(({data:i})=>{u(i)})},[n]),e.jsxs(ge,{open:n,onOpenChange:r,children:[e.jsx(is,{asChild:!0,children:a||e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 space-x-2",children:[e.jsx(ze,{icon:"ion:add"}),e.jsx("div",{children:l("dialog.addOrder")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:l("dialog.assignOrder")}),e.jsx(Re,{})]}),e.jsxs(Ce,{...o,children:[e.jsx(v,{control:o.control,name:"email",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dialog.fields.userEmail")}),e.jsx(b,{children:e.jsx(D,{placeholder:l("dialog.placeholders.email"),...i})})]})}),e.jsx(v,{control:o.control,name:"plan_id",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dialog.fields.subscriptionPlan")}),e.jsx(b,{children:e.jsxs(J,{value:i.value?i.value?.toString():void 0,onValueChange:d=>i.onChange(parseInt(d)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dialog.placeholders.plan")})}),e.jsx(Y,{children:c.map(d=>e.jsx(A,{value:d.id.toString(),children:d.name},d.id))})]})})]})}),e.jsx(v,{control:o.control,name:"period",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dialog.fields.orderPeriod")}),e.jsx(b,{children:e.jsxs(J,{value:i.value,onValueChange:i.onChange,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:l("dialog.placeholders.period")})}),e.jsx(Y,{children:Object.keys(im).map(d=>e.jsx(A,{value:d,children:l(`period.${d}`)},d))})]})})]})}),e.jsx(v,{control:o.control,name:"total_amount",render:({field:i})=>e.jsxs(f,{children:[e.jsx(j,{children:l("dialog.fields.paymentAmount")}),e.jsx(b,{children:e.jsx(D,{type:"number",placeholder:l("dialog.placeholders.amount"),value:i.value/100,onChange:d=>i.onChange(parseFloat(d.currentTarget.value)*100)})}),e.jsx(P,{})]})}),e.jsxs(Le,{children:[e.jsx(L,{variant:"outline",onClick:()=>r(!1),children:l("dialog.actions.cancel")}),e.jsx(L,{type:"submit",onClick:()=>{o.handleSubmit(i=>{Qs.assign(i).then(({data:d})=>{d&&(s&&s(),o.reset(),r(!1),$.success(l("dialog.messages.addSuccess")))})})()},children:l("dialog.actions.confirm")})]})]})]})]})}function Ox({table:s,refetch:a}){const{t}=V("order"),l=s.getState().columnFilters.length>0,n=Object.values(gs).filter(u=>typeof u=="number").map(u=>({label:t(`type.${gs[u]}`),value:u,color:u===gs.NEW?"green-500":u===gs.RENEWAL?"blue-500":u===gs.UPGRADE?"purple-500":"orange-500"})),r=Object.values(Ie).map(u=>({label:t(`period.${u}`),value:u,color:u===Ie.MONTH_PRICE?"slate-500":u===Ie.QUARTER_PRICE?"cyan-500":u===Ie.HALF_YEAR_PRICE?"indigo-500":u===Ie.YEAR_PRICE?"violet-500":u===Ie.TWO_YEAR_PRICE?"fuchsia-500":u===Ie.THREE_YEAR_PRICE?"pink-500":u===Ie.ONETIME_PRICE?"rose-500":"orange-500"})),o=Object.values(ne).filter(u=>typeof u=="number").map(u=>({label:t(`status.${ne[u]}`),value:u,icon:u===ne.PENDING?pt[0].icon:u===ne.PROCESSING?pt[1].icon:u===ne.COMPLETED?pt[2].icon:u===ne.CANCELLED?pt[3].icon:pt[4].icon,color:u===ne.PENDING?"yellow-500":u===ne.PROCESSING?"blue-500":u===ne.COMPLETED?"green-500":u===ne.CANCELLED?"red-500":"green-500"})),c=Object.values(ye).filter(u=>typeof u=="number").map(u=>({label:t(`commission.${ye[u]}`),value:u,icon:u===ye.PENDING?zt[0].icon:u===ye.PROCESSING?zt[1].icon:u===ye.VALID?zt[2].icon:zt[3].icon,color:u===ye.PENDING?"yellow-500":u===ye.PROCESSING?"blue-500":u===ye.VALID?"green-500":"red-500"}));return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Wr,{refetch:a}),e.jsx(D,{placeholder:t("search.placeholder"),value:s.getColumn("trade_no")?.getFilterValue()??"",onChange:u=>s.getColumn("trade_no")?.setFilterValue(u.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex flex-wrap gap-x-2",children:[s.getColumn("type")&&e.jsx(ca,{column:s.getColumn("type"),title:t("table.columns.type"),options:n}),s.getColumn("period")&&e.jsx(ca,{column:s.getColumn("period"),title:t("table.columns.period"),options:r}),s.getColumn("status")&&e.jsx(ca,{column:s.getColumn("status"),title:t("table.columns.status"),options:o}),s.getColumn("commission_status")&&e.jsx(ca,{column:s.getColumn("commission_status"),title:t("table.columns.commissionStatus"),options:c})]}),l&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[t("actions.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]})}function xs({label:s,value:a,className:t,valueClassName:l}){return e.jsxs("div",{className:y("flex items-center py-1.5",t),children:[e.jsx("div",{className:"w-28 shrink-0 text-sm text-muted-foreground",children:s}),e.jsx("div",{className:y("text-sm",l),children:a||"-"})]})}function zx({status:s}){const{t:a}=V("order"),t={[ne.PENDING]:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",[ne.PROCESSING]:"bg-blue-100 text-blue-800 hover:bg-blue-100",[ne.CANCELLED]:"bg-red-100 text-red-800 hover:bg-red-100",[ne.COMPLETED]:"bg-green-100 text-green-800 hover:bg-green-100",[ne.DISCOUNTED]:"bg-gray-100 text-gray-800 hover:bg-gray-100"};return e.jsx(G,{variant:"secondary",className:y("font-medium",t[s]),children:a(`status.${ne[s]}`)})}function $x({id:s,trigger:a}){const[t,l]=m.useState(!1),[n,r]=m.useState(),{t:o}=V("order");return m.useEffect(()=>{(async()=>{if(t){const{data:u}=await Qs.getInfo({id:s});r(u)}})()},[t,s]),e.jsxs(ge,{onOpenChange:l,open:t,children:[e.jsx(is,{asChild:!0,children:a}),e.jsxs(pe,{className:"max-w-xl",children:[e.jsxs(ve,{className:"space-y-2",children:[e.jsx(fe,{className:"text-lg font-medium",children:o("dialog.title")}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-muted-foreground",children:[o("table.columns.tradeNo"),"：",n?.trade_no]}),!!n?.status&&e.jsx(zx,{status:n.status})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:o("dialog.basicInfo")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(xs,{label:o("dialog.fields.userEmail"),value:n?.user?.email?e.jsxs(nt,{to:`/user/manage?email=${n.user.email}`,className:"group inline-flex items-center gap-1 text-primary hover:underline",children:[n.user.email,e.jsx(mr,{className:"h-3.5 w-3.5 opacity-0 transition-opacity group-hover:opacity-100"})]}):"-"}),e.jsx(xs,{label:o("dialog.fields.orderPeriod"),value:n&&o(`period.${n.period}`)}),e.jsx(xs,{label:o("dialog.fields.subscriptionPlan"),value:n?.plan?.name,valueClassName:"font-medium"}),e.jsx(xs,{label:o("dialog.fields.callbackNo"),value:n?.callback_no,valueClassName:"font-mono text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:o("dialog.amountInfo")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(xs,{label:o("dialog.fields.paymentAmount"),value:Js(n?.total_amount||0),valueClassName:"font-medium text-primary"}),e.jsx(De,{className:"my-2"}),e.jsx(xs,{label:o("dialog.fields.balancePayment"),value:Js(n?.balance_amount||0)}),e.jsx(xs,{label:o("dialog.fields.discountAmount"),value:Js(n?.discount_amount||0),valueClassName:"text-green-600"}),e.jsx(xs,{label:o("dialog.fields.refundAmount"),value:Js(n?.refund_amount||0),valueClassName:"text-red-600"}),e.jsx(xs,{label:o("dialog.fields.deductionAmount"),value:Js(n?.surplus_amount||0)})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:o("dialog.timeInfo")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(xs,{label:o("dialog.fields.createdAt"),value:Se(n?.created_at),valueClassName:"font-mono text-xs"}),e.jsx(xs,{label:o("dialog.fields.updatedAt"),value:Se(n?.updated_at),valueClassName:"font-mono text-xs"})]})]})]})]})]})}const Ax={[gs.NEW]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[gs.RENEWAL]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[gs.UPGRADE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[gs.RESET_FLOW]:{color:"text-slate-700",bgColor:"bg-slate-100/80"}},qx={[Ie.MONTH_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.QUARTER_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.HALF_YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.TWO_YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.THREE_YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.ONETIME_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[Ie.RESET_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"}},Hx=s=>ne[s],Ux=s=>ye[s],Kx=s=>gs[s],Bx=s=>{const{t:a}=V("order");return[{accessorKey:"trade_no",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.tradeNo")}),cell:({row:t})=>{const l=t.original.trade_no,n=l.length>6?`${l.slice(0,3)}...${l.slice(-3)}`:l;return e.jsx("div",{className:"flex items-center",children:e.jsx($x,{trigger:e.jsxs(K,{variant:"ghost",size:"sm",className:"flex h-8 items-center gap-1.5 px-2 font-medium text-primary transition-colors hover:bg-primary/10 hover:text-primary/80",children:[e.jsx("span",{className:"font-mono",children:n}),e.jsx(mr,{className:"h-3.5 w-3.5 opacity-70"})]}),id:t.original.id})})},enableSorting:!1,enableHiding:!1},{accessorKey:"type",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.type")}),cell:({row:t})=>{const l=t.getValue("type"),n=Ax[l];return e.jsx(G,{variant:"secondary",className:y("font-medium transition-colors text-nowrap",n.color,n.bgColor,"border border-border/50","hover:bg-slate-200/80"),children:a(`type.${Kx(l)}`)})},enableSorting:!1,enableHiding:!1},{accessorKey:"plan.name",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.plan")}),cell:({row:t})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium text-foreground/90 sm:max-w-72 md:max-w-[31rem]",children:t.original.plan?.name||"-"})}),enableSorting:!1,enableHiding:!1},{accessorKey:"period",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.period")}),cell:({row:t})=>{const l=t.getValue("period"),n=qx[l];return e.jsx(G,{variant:"secondary",className:y("font-medium transition-colors text-nowrap",n?.color,n?.bgColor,"hover:bg-opacity-80"),children:a(`period.${l}`)})},enableSorting:!1,enableHiding:!1},{accessorKey:"total_amount",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.amount")}),cell:({row:t})=>{const l=t.getValue("total_amount"),n=typeof l=="number"?(l/100).toFixed(2):"N/A";return e.jsxs("div",{className:"flex items-center font-mono text-foreground/90",children:["¥",n]})},enableSorting:!0,enableHiding:!1},{accessorKey:"status",header:({column:t})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{column:t,title:a("table.columns.status")}),e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsx($r,{className:"h-4 w-4 text-muted-foreground/70 transition-colors hover:text-muted-foreground"})}),e.jsx(oe,{side:"top",className:"max-w-[200px] text-sm",children:a("status.tooltip")})]})})]}),cell:({row:t})=>{const l=pt.find(n=>n.value===t.getValue("status"));return l?e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:`h-4 w-4 text-${l.color}`}),e.jsx("span",{className:"text-sm font-medium",children:a(`status.${Hx(l.value)}`)})]}),l.value===ne.PENDING&&e.jsxs(Es,{modal:!0,children:[e.jsx(Is,{asChild:!0,children:e.jsxs(K,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-muted/60",children:[e.jsx(va,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:a("actions.openMenu")})]})}),e.jsxs(ws,{align:"end",className:"w-[140px]",children:[e.jsx(_e,{className:"cursor-pointer",onClick:async()=>{await Qs.markPaid({trade_no:t.original.trade_no}),s()},children:a("actions.markAsPaid")}),e.jsx(_e,{className:"cursor-pointer text-destructive focus:text-destructive",onClick:async()=>{await Qs.makeCancel({trade_no:t.original.trade_no}),s()},children:a("actions.cancel")})]})]})]}):null},enableSorting:!0,enableHiding:!1},{accessorKey:"commission_balance",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.commission")}),cell:({row:t})=>{const l=t.getValue("commission_balance"),n=l?(l/100).toFixed(2):"-";return e.jsx("div",{className:"flex items-center font-mono text-foreground/90",children:l?`¥${n}`:"-"})},enableSorting:!0,enableHiding:!1},{accessorKey:"commission_status",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.commissionStatus")}),cell:({row:t})=>{const l=t.original.status,n=t.original.commission_balance,r=zt.find(o=>o.value===t.getValue("commission_status"));return n==0||!r?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r.icon&&e.jsx(r.icon,{className:`h-4 w-4 text-${r.color}`}),e.jsx("span",{className:"text-sm font-medium",children:a(`commission.${Ux(r.value)}`)})]}),r.value===ye.PENDING&&l===ne.COMPLETED&&e.jsxs(Es,{modal:!0,children:[e.jsx(Is,{asChild:!0,children:e.jsxs(K,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-muted/60",children:[e.jsx(va,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:a("actions.openMenu")})]})}),e.jsxs(ws,{align:"end",className:"w-[120px]",children:[e.jsx(_e,{className:"cursor-pointer",onClick:async()=>{await Qs.update({trade_no:t.original.trade_no,commission_status:ye.PROCESSING}),s()},children:a("commission.PROCESSING")}),e.jsx(_e,{className:"cursor-pointer text-destructive focus:text-destructive",onClick:async()=>{await Qs.update({trade_no:t.original.trade_no,commission_status:ye.INVALID}),s()},children:a("commission.INVALID")})]})]})]})},enableSorting:!0,enableHiding:!1},{accessorKey:"created_at",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.createdAt")}),cell:({row:t})=>e.jsx("div",{className:"text-nowrap font-mono text-sm text-muted-foreground",children:Se(t.getValue("created_at"),"YYYY/MM/DD HH:mm:ss")}),enableSorting:!0,enableHiding:!1}]};function Gx(){const[s]=ur(),[a,t]=m.useState({}),[l,n]=m.useState({}),[r,o]=m.useState([]),[c,u]=m.useState([]),[i,d]=m.useState({pageIndex:0,pageSize:20});m.useEffect(()=>{const N=Object.entries({user_id:"string",order_id:"string",commission_status:"number",status:"number",commission_balance:"string"}).map(([g,T])=>{const E=s.get(g);return E?{id:g,value:T==="number"?parseInt(E):E}:null}).filter(Boolean);N.length>0&&o(N)},[s]);const{refetch:h,data:k,isLoading:C}=le({queryKey:["orderList",i,r,c],queryFn:()=>Qs.getList({pageSize:i.pageSize,current:i.pageIndex+1,filter:r,sort:c})}),S=Je({data:k?.data??[],columns:Bx(h),state:{sorting:c,columnVisibility:l,rowSelection:a,columnFilters:r,pagination:i},rowCount:k?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:u,onColumnFiltersChange:o,onColumnVisibilityChange:n,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),onPaginationChange:d,getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(os,{table:S,toolbar:e.jsx(Ox,{table:S,refetch:h}),showPagination:!0})}function Wx(){const{t:s}=V("order");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Gx,{})})]})]})}const Yx=Object.freeze(Object.defineProperty({__proto__:null,default:Wx},Symbol.toStringTag,{value:"Module"}));function Jx({column:s,title:a,options:t}){const l=s?.getFacetedUniqueValues(),n=new Set(s?.getFilterValue());return e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Pa,{className:"mr-2 h-4 w-4"}),a,n?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?e.jsxs(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):t.filter(r=>n.has(r.value)).map(r=>e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},r.value))})]})]})}),e.jsx(bs,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Us,{children:[e.jsx(it,{placeholder:a}),e.jsxs(Ks,{children:[e.jsx(ot,{children:"No results found."}),e.jsx(ns,{children:t.map(r=>{const o=n.has(r.value);return e.jsxs($e,{onSelect:()=>{o?n.delete(r.value):n.add(r.value);const c=Array.from(n);s?.setFilterValue(c.length?c:void 0)},children:[e.jsx("div",{className:y("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(at,{className:y("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${r.color}`}),e.jsx("span",{children:r.label}),l?.get(r.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(r.value)})]},r.value)})}),n.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{}),e.jsx(ns,{children:e.jsx($e,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Qx=x.object({id:x.coerce.number().nullable().optional(),name:x.string().min(1,"请输入优惠券名称"),code:x.string().nullable(),type:x.coerce.number(),value:x.coerce.number(),started_at:x.coerce.number(),ended_at:x.coerce.number(),limit_use:x.union([x.string(),x.number()]).nullable(),limit_use_with_user:x.union([x.string(),x.number()]).nullable(),generate_count:x.coerce.number().nullable().optional(),limit_plan_ids:x.array(x.coerce.number()).default([]).nullable(),limit_period:x.array(x.nativeEnum(Ht)).default([]).nullable()}).refine(s=>s.ended_at>s.started_at,{message:"结束时间必须晚于开始时间",path:["ended_at"]}),ol={name:"",code:null,type:Ze.AMOUNT,value:0,started_at:Math.floor(Date.now()/1e3),ended_at:Math.floor(Date.now()/1e3)+7*24*60*60,limit_use:null,limit_use_with_user:null,limit_plan_ids:[],limit_period:[],generate_count:null};function Yr({defaultValues:s,refetch:a,type:t="create",dialogTrigger:l=null,open:n,onOpenChange:r}){const{t:o}=V("coupon"),[c,u]=m.useState(!1),i=n??c,d=r??u,[h,k]=m.useState([]),C=Ne({resolver:we(Qx),defaultValues:s||ol});m.useEffect(()=>{s&&C.reset(s)},[s,C]),m.useEffect(()=>{ss.getList().then(({data:g})=>k(g))},[]);const S=g=>{if(!g)return;const T=(E,p)=>{const _=new Date(p*1e3);return E.setHours(_.getHours(),_.getMinutes(),_.getSeconds()),Math.floor(E.getTime()/1e3)};g.from&&C.setValue("started_at",T(g.from,C.watch("started_at"))),g.to&&C.setValue("ended_at",T(g.to,C.watch("ended_at")))},w=async g=>{const T=await Na.save(g);if(g.generate_count&&T){const E=new Blob([T],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a");p.href=window.URL.createObjectURL(E),p.download=`coupons_${new Date().getTime()}.csv`,p.click(),window.URL.revokeObjectURL(p.href)}d(!1),t==="create"&&C.reset(ol),a()},N=(g,T)=>e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:T}),e.jsx(D,{type:"datetime-local",step:"1",value:Se(C.watch(g),"YYYY-MM-DDTHH:mm:ss"),onChange:E=>{const p=new Date(E.target.value);C.setValue(g,Math.floor(p.getTime()/1e3))},className:"h-8 [&::-webkit-calendar-picker-indicator]:hidden"})]});return e.jsxs(ge,{open:i,onOpenChange:d,children:[l&&e.jsx(is,{asChild:!0,children:l}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsx(ve,{children:e.jsx(fe,{children:o(t==="create"?"form.add":"form.edit")})}),e.jsx(Ce,{...C,children:e.jsxs("form",{onSubmit:C.handleSubmit(w),className:"space-y-4",children:[e.jsx(v,{control:C.control,name:"name",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.name.label")}),e.jsx(D,{placeholder:o("form.name.placeholder"),...g}),e.jsx(P,{})]})}),t==="create"&&e.jsx(v,{control:C.control,name:"generate_count",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.generateCount.label")}),e.jsx(D,{type:"number",min:0,placeholder:o("form.generateCount.placeholder"),...g,value:g.value===void 0?"":g.value,onChange:T=>g.onChange(T.target.value===""?"":parseInt(T.target.value)),className:"h-9"}),e.jsx(M,{className:"text-xs",children:o("form.generateCount.description")}),e.jsx(P,{})]})}),(!C.watch("generate_count")||C.watch("generate_count")==null)&&e.jsx(v,{control:C.control,name:"code",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.code.label")}),e.jsx(D,{placeholder:o("form.code.placeholder"),...g,className:"h-9"}),e.jsx(M,{className:"text-xs",children:o("form.code.description")}),e.jsx(P,{})]})}),e.jsxs(f,{children:[e.jsx(j,{children:o("form.type.label")}),e.jsxs("div",{className:"flex",children:[e.jsx(v,{control:C.control,name:"type",render:({field:g})=>e.jsxs(J,{value:g.value.toString(),onValueChange:T=>{const E=g.value,p=parseInt(T);g.onChange(p);const _=C.getValues("value");_&&(E===Ze.AMOUNT&&p===Ze.PERCENTAGE?C.setValue("value",_/100):E===Ze.PERCENTAGE&&p===Ze.AMOUNT&&C.setValue("value",_*100))},children:[e.jsx(W,{className:"flex-[1.2] rounded-r-none border-r-0 focus:z-10",children:e.jsx(Q,{placeholder:o("form.type.placeholder")})}),e.jsx(Y,{children:Object.entries(om).map(([T,E])=>e.jsx(A,{value:T,children:o(`table.toolbar.types.${T}`)},T))})]})}),e.jsx(v,{control:C.control,name:"value",render:({field:g})=>{const T=g.value==null?"":C.watch("type")===Ze.AMOUNT&&typeof g.value=="number"?(g.value/100).toString():g.value.toString();return e.jsx(D,{type:"number",placeholder:o("form.value.placeholder"),...g,value:T,onChange:E=>{const p=E.target.value;if(p===""){g.onChange("");return}const _=parseFloat(p);isNaN(_)||g.onChange(C.watch("type")===Ze.AMOUNT?Math.round(_*100):_)},step:"any",min:0,className:"flex-[2] rounded-none border-x-0 text-left"})}}),e.jsx("div",{className:"flex min-w-[40px] items-center justify-center rounded-md rounded-l-none border border-l-0 border-input bg-muted/50 px-3 font-medium text-muted-foreground",children:e.jsx("span",{children:C.watch("type")==Ze.AMOUNT?"¥":"%"})})]})]}),e.jsxs(f,{children:[e.jsx(j,{children:o("form.validity.label")}),e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:y("w-full justify-start text-left font-normal",!C.watch("started_at")&&"text-muted-foreground"),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),Se(C.watch("started_at"),"YYYY-MM-DD HH:mm:ss")," ",o("form.validity.to")," ",Se(C.watch("ended_at"),"YYYY-MM-DD HH:mm:ss")]})}),e.jsxs(bs,{className:"w-auto p-0",align:"start",children:[e.jsx("div",{className:"border-b border-border",children:e.jsx(ct,{mode:"range",selected:{from:new Date(C.watch("started_at")*1e3),to:new Date(C.watch("ended_at")*1e3)},onSelect:S,numberOfMonths:2})}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[N("started_at",o("table.validity.startTime")),e.jsx("div",{className:"mt-6 text-sm text-muted-foreground",children:o("form.validity.to")}),N("ended_at",o("table.validity.endTime"))]})})]})]}),e.jsx(P,{})]}),e.jsx(v,{control:C.control,name:"limit_use",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.limitUse.label")}),e.jsx(D,{type:"number",min:0,placeholder:o("form.limitUse.placeholder"),...g,value:g.value===null?"":g.value,onChange:T=>g.onChange(T.target.value===""?null:parseInt(T.target.value)),className:"h-9"}),e.jsx(M,{className:"text-xs",children:o("form.limitUse.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:C.control,name:"limit_use_with_user",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.limitUseWithUser.label")}),e.jsx(D,{type:"number",min:0,placeholder:o("form.limitUseWithUser.placeholder"),...g,value:g.value===null?"":g.value,onChange:T=>g.onChange(T.target.value===""?null:parseInt(T.target.value)),className:"h-9"}),e.jsx(M,{className:"text-xs",children:o("form.limitUseWithUser.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:C.control,name:"limit_period",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.limitPeriod.label")}),e.jsx(wt,{options:Object.entries(Ht).filter(([T])=>isNaN(Number(T))).map(([T,E])=>({label:o(`coupon:period.${E}`),value:T})),onChange:T=>{if(T.length===0){g.onChange([]);return}const E=T.map(p=>Ht[p.value]);g.onChange(E)},value:(g.value||[]).map(T=>({label:o(`coupon:period.${T}`),value:Object.entries(Ht).find(([E,p])=>p===T)?.[0]||""})),placeholder:o("form.limitPeriod.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:o("form.limitPeriod.empty")})}),e.jsx(M,{className:"text-xs",children:o("form.limitPeriod.description")}),e.jsx(P,{})]})}),e.jsx(v,{control:C.control,name:"limit_plan_ids",render:({field:g})=>e.jsxs(f,{children:[e.jsx(j,{children:o("form.limitPlan.label")}),e.jsx(wt,{options:h?.map(T=>({label:T.name,value:T.id.toString()}))||[],onChange:T=>g.onChange(T.map(E=>Number(E.value))),value:(h||[]).filter(T=>(g.value||[]).includes(T.id)).map(T=>({label:T.name,value:T.id.toString()})),placeholder:o("form.limitPlan.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:o("form.limitPlan.empty")})}),e.jsx(P,{})]})}),e.jsx(Le,{children:e.jsx(L,{type:"submit",disabled:C.formState.isSubmitting,children:C.formState.isSubmitting?o("form.submit.saving"):o("form.submit.save")})})]})})]})]})}function Xx({table:s,refetch:a}){const t=s.getState().columnFilters.length>0,{t:l}=V("coupon");return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yr,{refetch:a,dialogTrigger:e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 space-x-2",children:[e.jsx(ze,{icon:"ion:add"}),e.jsx("div",{children:l("form.add")})]})}),e.jsx(D,{placeholder:l("table.toolbar.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:n=>s.getColumn("name")?.setFilterValue(n.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("type")&&e.jsx(Jx,{column:s.getColumn("type"),title:l("table.toolbar.type"),options:[{value:Ze.AMOUNT,label:l(`table.toolbar.types.${Ze.AMOUNT}`)},{value:Ze.PERCENTAGE,label:l(`table.toolbar.types.${Ze.PERCENTAGE}`)}]}),t&&e.jsxs(L,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[l("table.toolbar.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]})]})}const Jr=m.createContext(void 0);function Zx({children:s,refetch:a}){const[t,l]=m.useState(!1),[n,r]=m.useState(null),o=u=>{r(u),l(!0)},c=()=>{l(!1),r(null)};return e.jsxs(Jr.Provider,{value:{isOpen:t,currentCoupon:n,openEdit:o,closeEdit:c},children:[s,n&&e.jsx(Yr,{defaultValues:n,refetch:a,type:"edit",open:t,onOpenChange:l})]})}function eh(){const s=m.useContext(Jr);if(s===void 0)throw new Error("useCouponEdit must be used within a CouponEditProvider");return s}const sh=s=>{const{t:a}=V("coupon");return[{accessorKey:"id",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.id")}),cell:({row:t})=>e.jsx(G,{children:t.original.id}),enableSorting:!0},{accessorKey:"show",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.show")}),cell:({row:t})=>e.jsx(Z,{defaultChecked:t.original.show,onCheckedChange:l=>{Na.update({id:t.original.id,show:l}).then(({data:n})=>!n&&s())}}),enableSorting:!1},{accessorKey:"name",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.name")}),cell:({row:t})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:t.original.name})}),enableSorting:!1,size:800},{accessorKey:"type",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.type")}),cell:({row:t})=>e.jsx(G,{variant:"outline",children:a(`table.toolbar.types.${t.original.type}`)}),enableSorting:!0},{accessorKey:"code",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.code")}),cell:({row:t})=>e.jsx(G,{variant:"secondary",children:t.original.code}),enableSorting:!0},{accessorKey:"limit_use",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.limitUse")}),cell:({row:t})=>e.jsx(G,{variant:"outline",children:t.original.limit_use===null?a("table.validity.unlimited"):t.original.limit_use}),enableSorting:!0},{accessorKey:"limit_use_with_user",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.limitUseWithUser")}),cell:({row:t})=>e.jsx(G,{variant:"outline",children:t.original.limit_use_with_user===null?a("table.validity.noLimit"):t.original.limit_use_with_user}),enableSorting:!0},{accessorKey:"#",header:({column:t})=>e.jsx(z,{column:t,title:a("table.columns.validity")}),cell:({row:t})=>{const[l,n]=m.useState(!1),r=Date.now(),o=t.original.started_at*1e3,c=t.original.ended_at*1e3,u=r>c,i=r<o,d=Math.ceil((c-r)/(1e3*60*60*24)),k=u?{label:a("table.validity.expired",{days:Math.abs(d)}),color:"bg-red-50 text-red-600 dark:bg-red-500/10 dark:text-red-400"}:i?{label:a("table.validity.notStarted",{days:Math.abs(Math.ceil((o-r)/(1e3*60*60*24)))}),color:"bg-yellow-50 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-400"}:{label:a("table.validity.remaining",{days:d}),color:"bg-green-50 text-green-600 dark:bg-green-500/10 dark:text-green-400"};return e.jsxs(Sr,{open:l,onOpenChange:n,children:[e.jsx(kr,{asChild:!0,children:e.jsxs("div",{className:"group -m-0.5 flex max-w-[280px] cursor-pointer items-center gap-2 rounded-md p-0.5 transition-colors hover:bg-muted/40",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx("div",{className:y("whitespace-nowrap rounded-md px-1.5 py-0.5 text-xs font-medium",k.color),children:k.label}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1 text-muted-foreground",children:[e.jsx("div",{className:"truncate text-xs",children:Se(t.original.started_at,"MM/DD HH:mm")}),e.jsx("div",{className:"shrink-0 opacity-30",children:"→"}),e.jsx("div",{className:"truncate text-xs",children:Se(t.original.ended_at,"MM/DD HH:mm")})]})]}),e.jsx(Gc,{className:y("h-3.5 w-3.5 shrink-0 text-muted-foreground/50 transition-transform duration-200",l&&"rotate-180")})]})}),e.jsx(Tr,{children:e.jsx("div",{className:"px-0.5 pb-0.5 pt-1.5",children:e.jsxs("div",{className:"space-y-1.5 border-l-2 border-muted pl-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:a("table.validity.startTime")}),e.jsx("span",{className:"font-medium text-foreground",children:Se(t.original.started_at,"YYYY/MM/DD HH:mm")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:a("table.validity.endTime")}),e.jsx("span",{className:"font-medium text-foreground",children:Se(t.original.ended_at,"YYYY/MM/DD HH:mm")})]})]})})})]})},enableSorting:!1,size:8e3},{id:"actions",header:({column:t})=>e.jsx(z,{className:"justify-end",column:t,title:a("table.columns.actions")}),cell:({row:t})=>{const{openEdit:l}=eh();return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",onClick:()=>l(t.original),children:[e.jsx(lt,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("table.actions.edit")})]}),e.jsx(ls,{title:a("table.actions.deleteConfirm.title"),description:a("table.actions.deleteConfirm.description"),confirmText:a("table.actions.deleteConfirm.confirmText"),variant:"destructive",onConfirm:async()=>{Na.drop({id:t.original.id}).then(({data:n})=>{n&&($.success("删除成功"),s())})},children:e.jsxs(L,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:a("table.actions.delete")})]})})]})}}]};function th(){const[s,a]=m.useState({}),[t,l]=m.useState({}),[n,r]=m.useState([]),[o,c]=m.useState([]),[u,i]=m.useState({pageIndex:0,pageSize:20}),{refetch:d,data:h}=le({queryKey:["couponList",u,n,o],queryFn:()=>Na.getList({pageSize:u.pageSize,current:u.pageIndex+1,filter:n,sort:o})}),k=Je({data:h?.data??[],columns:sh(d),state:{sorting:o,columnVisibility:t,rowSelection:s,columnFilters:n,pagination:u},pageCount:Math.ceil((h?.total??0)/u.pageSize),rowCount:h?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:c,onColumnFiltersChange:r,onColumnVisibilityChange:l,onPaginationChange:i,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(Zx,{refetch:d,children:e.jsx("div",{className:"space-y-4",children:e.jsx(os,{table:k,toolbar:e.jsx(Xx,{table:k,refetch:d})})})})}function ah(){const{t:s}=V("coupon");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(th,{})})]})]})}const nh=Object.freeze(Object.defineProperty({__proto__:null,default:ah},Symbol.toStringTag,{value:"Module"})),lh=1,rh=1e6;let Za=0;function ih(){return Za=(Za+1)%Number.MAX_SAFE_INTEGER,Za.toString()}const en=new Map,cl=s=>{if(en.has(s))return;const a=setTimeout(()=>{en.delete(s),Ut({type:"REMOVE_TOAST",toastId:s})},rh);en.set(s,a)},oh=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,lh)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?cl(t):s.toasts.forEach(l=>{cl(l.id)}),{...s,toasts:s.toasts.map(l=>l.id===t||t===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},xa=[];let ha={toasts:[]};function Ut(s){ha=oh(ha,s),xa.forEach(a=>{a(ha)})}function ch({...s}){const a=ih(),t=n=>Ut({type:"UPDATE_TOAST",toast:{...n,id:a}}),l=()=>Ut({type:"DISMISS_TOAST",toastId:a});return Ut({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:n=>{n||l()}}}),{id:a,dismiss:l,update:t}}function Qr(){const[s,a]=m.useState(ha);return m.useEffect(()=>(xa.push(a),()=>{const t=xa.indexOf(a);t>-1&&xa.splice(t,1)}),[s]),{...s,toast:ch,dismiss:t=>Ut({type:"DISMISS_TOAST",toastId:t})}}function dh({open:s,onOpenChange:a,table:t}){const{t:l}=V("user"),{toast:n}=Qr(),[r,o]=m.useState(!1),[c,u]=m.useState(""),[i,d]=m.useState(""),h=async()=>{if(!c||!i){n({title:l("messages.error"),description:l("messages.send_mail.required_fields"),variant:"destructive"});return}try{o(!0),await _s.sendMail({subject:c,content:i,filter:t.getState().columnFilters,sort:t.getState().sorting[0]?.id,sort_type:t.getState().sorting[0]?.desc?"DESC":"ASC"}),n({title:l("messages.success"),description:l("messages.send_mail.success")}),a(!1),u(""),d("")}catch{n({title:l("messages.error"),description:l("messages.send_mail.failed"),variant:"destructive"})}finally{o(!1)}};return e.jsx(ge,{open:s,onOpenChange:a,children:e.jsxs(pe,{className:"sm:max-w-[500px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:l("send_mail.title")}),e.jsx(Re,{children:l("send_mail.description")})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"subject",className:"text-right",children:l("send_mail.subject")}),e.jsx(D,{id:"subject",value:c,onChange:k=>u(k.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"content",className:"text-right",children:l("send_mail.content")}),e.jsx(ks,{id:"content",value:i,onChange:k=>d(k.target.value),className:"col-span-3",rows:6})]})]}),e.jsx(Le,{children:e.jsx(K,{type:"submit",onClick:h,disabled:r,children:l(r?"send_mail.sending":"send_mail.send")})})]})})}const mh=x.object({email_prefix:x.string().optional(),email_suffix:x.string().min(1),password:x.string().optional(),expired_at:x.number().optional().nullable(),plan_id:x.number().nullable(),generate_count:x.number().optional().nullable(),download_csv:x.boolean().optional()}).refine(s=>s.generate_count===null?s.email_prefix!==void 0&&s.email_prefix!=="":!0,{message:"Email prefix is required when generate_count is null",path:["email_prefix"]}),uh={email_prefix:"",email_suffix:"",password:"",expired_at:null,plan_id:null,generate_count:void 0,download_csv:!1};function xh({refetch:s}){const{t:a}=V("user"),[t,l]=m.useState(!1),n=Ne({resolver:we(mh),defaultValues:uh,mode:"onChange"}),[r,o]=m.useState([]);return m.useEffect(()=>{t&&ss.getList().then(({data:c})=>{c&&o(c)})},[t]),e.jsxs(ge,{open:t,onOpenChange:l,children:[e.jsx(is,{asChild:!0,children:e.jsxs(K,{size:"sm",variant:"outline",className:"gap-0 space-x-2",children:[e.jsx(ze,{icon:"ion:add"}),e.jsx("div",{children:a("generate.button")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:a("generate.title")}),e.jsx(Re,{})]}),e.jsxs(Ce,{...n,children:[e.jsxs(f,{children:[e.jsx(j,{children:a("generate.form.email")}),e.jsxs("div",{className:"flex",children:[!n.watch("generate_count")&&e.jsx(v,{control:n.control,name:"email_prefix",render:({field:c})=>e.jsx(D,{className:"flex-[5] rounded-r-none",placeholder:a("generate.form.email_prefix"),...c})}),e.jsx("div",{className:`z-[-1] border border-r-0 border-input px-3 py-1 shadow-sm ${n.watch("generate_count")?"rounded-l-md":"border-l-0"}`,children:"@"}),e.jsx(v,{control:n.control,name:"email_suffix",render:({field:c})=>e.jsx(D,{className:"flex-[4] rounded-l-none",placeholder:a("generate.form.email_domain"),...c})})]})]}),e.jsx(v,{control:n.control,name:"password",render:({field:c})=>e.jsxs(f,{children:[e.jsx(j,{children:a("generate.form.password")}),e.jsx(D,{placeholder:a("generate.form.password_placeholder"),...c}),e.jsx(P,{})]})}),e.jsx(v,{control:n.control,name:"expired_at",render:({field:c})=>e.jsxs(f,{className:"flex flex-col",children:[e.jsx(j,{children:a("generate.form.expire_time")}),e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsx(b,{children:e.jsxs(K,{variant:"outline",className:y("w-full pl-3 text-left font-normal",!c.value&&"text-muted-foreground"),children:[c.value?Se(c.value):e.jsx("span",{children:a("generate.form.expire_time_placeholder")}),e.jsx(Ct,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsxs(bs,{className:"flex w-auto flex-col space-y-2 p-2",children:[e.jsx(Wc,{asChild:!0,children:e.jsx(K,{variant:"outline",className:"w-full",onClick:()=>{c.onChange(null)},children:a("generate.form.permanent")})}),e.jsx("div",{className:"rounded-md border",children:e.jsx(ct,{mode:"single",selected:c.value?new Date(c.value*1e3):void 0,onSelect:u=>{u&&c.onChange(u?.getTime()/1e3)}})})]})]})]})}),e.jsx(v,{control:n.control,name:"plan_id",render:({field:c})=>e.jsxs(f,{children:[e.jsx(j,{children:a("generate.form.subscription")}),e.jsx(b,{children:e.jsxs(J,{value:c.value?c.value.toString():"null",onValueChange:u=>c.onChange(u==="null"?null:parseInt(u)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:a("generate.form.subscription_none")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"null",children:a("generate.form.subscription_none")}),r.map(u=>e.jsx(A,{value:u.id.toString(),children:u.name},u.id))]})]})})]})}),!n.watch("email_prefix")&&e.jsx(v,{control:n.control,name:"generate_count",render:({field:c})=>e.jsxs(f,{children:[e.jsx(j,{children:a("generate.form.generate_count")}),e.jsx(D,{type:"number",placeholder:a("generate.form.generate_count_placeholder"),value:c.value||"",onChange:u=>c.onChange(u.target.value?parseInt(u.target.value):null)})]})}),n.watch("generate_count")&&e.jsx(v,{control:n.control,name:"download_csv",render:({field:c})=>e.jsxs(f,{className:"flex cursor-pointer flex-row items-center space-x-2 space-y-0",children:[e.jsx(b,{children:e.jsx(Pn,{checked:c.value,onCheckedChange:c.onChange})}),e.jsx(j,{children:a("generate.form.download_csv")})]})})]}),e.jsxs(Le,{children:[e.jsx(K,{variant:"outline",onClick:()=>l(!1),children:a("generate.form.cancel")}),e.jsx(K,{onClick:()=>n.handleSubmit(async c=>{if(c.download_csv){const u=await _s.generate(c);if(u&&u instanceof Blob){const i=window.URL.createObjectURL(u),d=document.createElement("a");d.href=i,d.download=`users_${new Date().getTime()}.csv`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(i),$.success(a("generate.form.success")),n.reset(),s(),l(!1)}}else{const{data:u}=await _s.generate(c);u&&($.success(a("generate.form.success")),n.reset(),s(),l(!1))}})(),children:a("generate.form.submit")})]})]})]})}const Xr=fl,hh=jl,ph=vl,Zr=m.forwardRef(({className:s,...a},t)=>e.jsx(Ca,{className:y("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));Zr.displayName=Ca.displayName;const gh=tt("fixed overflow-y-scroll  z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-md",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-md"}},defaultVariants:{side:"right"}}),Ln=m.forwardRef(({side:s="right",className:a,children:t,...l},n)=>e.jsxs(ph,{children:[e.jsx(Zr,{}),e.jsxs(Sa,{ref:n,className:y(gh({side:s}),a),...l,children:[e.jsxs(hn,{className:"absolute right-4 top-4  rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),t]})]}));Ln.displayName=Sa.displayName;const En=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col space-y-2 text-center sm:text-left",s),...a});En.displayName="SheetHeader";const ei=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});ei.displayName="SheetFooter";const In=m.forwardRef(({className:s,...a},t)=>e.jsx(ka,{ref:t,className:y("text-lg font-semibold text-foreground",s),...a}));In.displayName=ka.displayName;const Rn=m.forwardRef(({className:s,...a},t)=>e.jsx(Ta,{ref:t,className:y("text-sm text-muted-foreground",s),...a}));Rn.displayName=Ta.displayName;function fh({table:s,refetch:a,permissionGroups:t=[],subscriptionPlans:l=[]}){const{t:n}=V("user"),{toast:r}=Qr(),o=s.getState().columnFilters.length>0,[c,u]=m.useState([]),[i,d]=m.useState(!1),[h,k]=m.useState(!1),[C,S]=m.useState(!1),[w,N]=m.useState(!1),g=async()=>{try{const ee=await _s.dumpCSV({filter:s.getState().columnFilters,sort:s.getState().sorting[0]?.id,sort_type:s.getState().sorting[0]?.desc?"DESC":"ASC"}),te=ee;console.log(ee);const q=new Blob([te],{type:"text/csv;charset=utf-8;"}),R=window.URL.createObjectURL(q),X=document.createElement("a");X.href=R,X.setAttribute("download",`users_${new Date().toISOString()}.csv`),document.body.appendChild(X),X.click(),X.remove(),window.URL.revokeObjectURL(R),r({title:n("messages.success"),description:n("messages.export.success")})}catch{r({title:n("messages.error"),description:n("messages.export.failed"),variant:"destructive"})}},T=async()=>{try{N(!0),await _s.batchBan({filter:s.getState().columnFilters,sort:s.getState().sorting[0]?.id,sort_type:s.getState().sorting[0]?.desc?"DESC":"ASC"}),r({title:n("messages.success"),description:n("messages.batch_ban.success")}),a()}catch{r({title:n("messages.error"),description:n("messages.batch_ban.failed"),variant:"destructive"})}finally{N(!1),S(!1)}},E=[{label:n("filter.fields.email"),value:"email",type:"text",operators:[{label:n("filter.operators.contains"),value:"contains"},{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.id"),value:"id",type:"number",operators:[{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.plan_id"),value:"plan_id",type:"select",operators:[{label:n("filter.operators.eq"),value:"eq"}],useOptions:!0},{label:n("filter.fields.transfer_enable"),value:"transfer_enable",type:"number",unit:"GB",operators:[{label:n("filter.operators.gt"),value:"gt"},{label:n("filter.operators.lt"),value:"lt"},{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.total_used"),value:"total_used",type:"number",unit:"GB",operators:[{label:n("filter.operators.gt"),value:"gt"},{label:n("filter.operators.lt"),value:"lt"},{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.online_count"),value:"online_count",type:"number",operators:[{label:n("filter.operators.eq"),value:"eq"},{label:n("filter.operators.gt"),value:"gt"},{label:n("filter.operators.lt"),value:"lt"}]},{label:n("filter.fields.expired_at"),value:"expired_at",type:"date",operators:[{label:n("filter.operators.lt"),value:"lt"},{label:n("filter.operators.gt"),value:"gt"},{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.uuid"),value:"uuid",type:"text",operators:[{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.token"),value:"token",type:"text",operators:[{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.banned"),value:"banned",type:"select",operators:[{label:n("filter.operators.eq"),value:"eq"}],options:[{label:n("filter.status.normal"),value:"0"},{label:n("filter.status.banned"),value:"1"}]},{label:n("filter.fields.remark"),value:"remarks",type:"text",operators:[{label:n("filter.operators.contains"),value:"contains"},{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.inviter_email"),value:"invite_user.email",type:"text",operators:[{label:n("filter.operators.contains"),value:"contains"},{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.invite_user_id"),value:"invite_user_id",type:"number",operators:[{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.is_admin"),value:"is_admin",type:"boolean",operators:[{label:n("filter.operators.eq"),value:"eq"}]},{label:n("filter.fields.is_staff"),value:"is_staff",type:"boolean",operators:[{label:n("filter.operators.eq"),value:"eq"}]}],p=ee=>ee*1024*1024*1024,_=ee=>ee/(1024*1024*1024),I=()=>{u([...c,{field:"",operator:"",value:""}])},H=ee=>{u(c.filter((te,q)=>q!==ee))},O=(ee,te,q)=>{const R=[...c];if(R[ee]={...R[ee],[te]:q},te==="field"){const X=E.find(ms=>ms.value===q);X&&(R[ee].operator=X.operators[0].value,R[ee].value=X.type==="boolean"?!1:"")}u(R)},B=(ee,te)=>{const q=E.find(R=>R.value===ee.field);if(!q)return null;switch(q.type){case"text":return e.jsx(D,{placeholder:n("filter.sheet.value"),value:ee.value,onChange:R=>O(te,"value",R.target.value)});case"number":return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{type:"number",placeholder:n("filter.sheet.value_number",{unit:q.unit}),value:q.unit==="GB"?_(ee.value||0):ee.value,onChange:R=>{const X=Number(R.target.value);O(te,"value",q.unit==="GB"?p(X):X)}}),q.unit&&e.jsx("span",{className:"text-sm text-muted-foreground",children:q.unit})]});case"date":return e.jsx(ct,{mode:"single",selected:ee.value,onSelect:R=>O(te,"value",R),className:"flex flex-1 justify-center rounded-md border"});case"select":return e.jsxs(J,{value:ee.value,onValueChange:R=>O(te,"value",R),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:n("filter.sheet.value")})}),e.jsx(Y,{children:q.useOptions?l.map(R=>e.jsx(A,{value:R.value.toString(),children:R.label},R.value)):q.options?.map(R=>e.jsx(A,{value:R.value.toString(),children:R.label},R.value))})]});case"boolean":return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{checked:ee.value,onCheckedChange:R=>O(te,"value",R)}),e.jsx(Xs,{children:ee.value?n("filter.boolean.true"):n("filter.boolean.false")})]});default:return null}},ue=()=>{const ee=c.filter(te=>te.field&&te.operator&&te.value!=="").map(te=>{const q=E.find(X=>X.value===te.field);let R=te.value;return te.operator==="contains"?{id:te.field,value:R}:(q?.type==="date"&&R instanceof Date&&(R=Math.floor(R.getTime()/1e3)),q?.type==="boolean"&&(R=R?1:0),{id:te.field,value:`${te.operator}:${R}`})});s.setColumnFilters(ee),d(!1)};return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-2",children:[e.jsx(xh,{refetch:a}),e.jsx(D,{placeholder:n("filter.email_search"),value:s.getColumn("email")?.getFilterValue()??"",onChange:ee=>s.getColumn("email")?.setFilterValue(ee.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs(Xr,{open:i,onOpenChange:d,children:[e.jsx(hh,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Yc,{className:"mr-2 h-4 w-4"}),n("filter.advanced"),c.length>0&&e.jsx(G,{variant:"secondary",className:"ml-2 rounded-sm px-1",children:c.length})]})}),e.jsxs(Ln,{className:"w-[400px] sm:w-[540px]",children:[e.jsxs(En,{children:[e.jsx(In,{children:n("filter.sheet.title")}),e.jsx(Rn,{children:n("filter.sheet.description")})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:n("filter.sheet.conditions")}),e.jsx(L,{variant:"outline",size:"sm",onClick:I,children:n("filter.sheet.add")})]}),e.jsx(_t,{className:"h-[calc(100vh-280px)] ",children:e.jsx("div",{className:"space-y-4",children:c.map((ee,te)=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Xs,{children:n("filter.sheet.condition",{number:te+1})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>H(te),children:e.jsx(ds,{className:"h-4 w-4"})})]}),e.jsxs(J,{value:ee.field,onValueChange:q=>O(te,"field",q),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:n("filter.sheet.field")})}),e.jsx(Y,{children:e.jsx(Be,{children:E.map(q=>e.jsx(A,{value:q.value,className:"cursor-pointer",children:q.label},q.value))})})]}),ee.field&&e.jsxs(J,{value:ee.operator,onValueChange:q=>O(te,"operator",q),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:n("filter.sheet.operator")})}),e.jsx(Y,{children:E.find(q=>q.value===ee.field)?.operators.map(q=>e.jsx(A,{value:q.value,children:q.label},q.value))})]}),ee.field&&ee.operator&&B(ee,te)]},te))})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(L,{variant:"outline",onClick:()=>{u([]),d(!1)},children:n("filter.sheet.reset")}),e.jsx(L,{onClick:ue,children:n("filter.sheet.apply")})]})]})]})]}),o&&e.jsxs(L,{variant:"ghost",onClick:()=>{s.resetColumnFilters(),u([])},className:"h-8 px-2 lg:px-3",children:[n("filter.sheet.reset"),e.jsx(ds,{className:"ml-2 h-4 w-4"})]}),e.jsxs(Es,{modal:!1,children:[e.jsx(Is,{asChild:!0,children:e.jsx(L,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:n("actions.title")})}),e.jsxs(ws,{children:[e.jsx(_e,{onClick:()=>k(!0),children:n("actions.send_email")}),e.jsx(_e,{onClick:g,children:n("actions.export_csv")}),e.jsx(Nt,{}),e.jsx(_e,{onClick:()=>S(!0),className:"text-red-600 focus:text-red-600",children:n("actions.batch_ban")})]})]})]}),e.jsx(dh,{open:h,onOpenChange:k,table:s}),e.jsx(kn,{open:C,onOpenChange:S,children:e.jsxs(Va,{children:[e.jsxs(Fa,{children:[e.jsx(Oa,{children:n("actions.confirm_ban.title")}),e.jsx(za,{children:n(o?"actions.confirm_ban.filtered_description":"actions.confirm_ban.all_description")})]}),e.jsxs(Ma,{children:[e.jsx(Aa,{disabled:w,children:n("actions.confirm_ban.cancel")}),e.jsx($a,{onClick:T,disabled:w,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:n(w?"actions.confirm_ban.banning":"actions.confirm_ban.confirm")})]})]})})]})}const si=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m17.71 11.29l-5-5a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21l-5 5a1 1 0 0 0 1.42 1.42L11 9.41V17a1 1 0 0 0 2 0V9.41l3.29 3.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42"})}),ti=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17.71 11.29a1 1 0 0 0-1.42 0L13 14.59V7a1 1 0 0 0-2 0v7.59l-3.29-3.3a1 1 0 0 0-1.42 1.42l5 5a1 1 0 0 0 .33.21a.94.94 0 0 0 .76 0a1 1 0 0 0 .33-.21l5-5a1 1 0 0 0 0-1.42"})}),jh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17 11H9.41l3.3-3.29a1 1 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33a1 1 0 0 0 0 .76a1 1 0 0 0 .21.33l5 5a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42L9.41 13H17a1 1 0 0 0 0-2"})}),vh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17.92 11.62a1 1 0 0 0-.21-.33l-5-5a1 1 0 0 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l5-5a1 1 0 0 0 .21-.33a1 1 0 0 0 0-.76"})}),sn=[{accessorKey:"record_at",header:"时间",cell:({row:s})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("time",{className:"text-sm text-muted-foreground",children:xd(s.original.record_at)})})},{accessorKey:"u",header:"上行流量",cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(si,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"font-mono text-sm",children:Oe(s.original.u/parseFloat(s.original.server_rate))})]})},{accessorKey:"d",header:"下行流量",cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ti,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-mono text-sm",children:Oe(s.original.d/parseFloat(s.original.server_rate))})]})},{accessorKey:"server_rate",header:"倍率",cell:({row:s})=>{const a=s.original.server_rate;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(G,{variant:"outline",className:"font-mono",children:[a,"x"]})})}},{id:"total",header:"总计",cell:({row:s})=>{const a=s.original.u+s.original.d;return e.jsx("div",{className:"flex items-center justify-end font-mono text-sm",children:Oe(a)})}}];function ai({user_id:s,dialogTrigger:a}){const{t}=V(["traffic"]),[l,n]=m.useState(!1),[r,o]=m.useState({pageIndex:0,pageSize:20}),{data:c,isLoading:u}=le({queryKey:["userStats",s,r,l],queryFn:()=>l?_s.getStats({user_id:s,pageSize:r.pageSize,page:r.pageIndex+1}):null}),i=Je({data:c?.data??[],columns:sn,pageCount:Math.ceil((c?.total??0)/r.pageSize),state:{pagination:r},manualPagination:!0,getCoreRowModel:Qe(),onPaginationChange:o});return e.jsxs(ge,{open:l,onOpenChange:n,children:[e.jsx(is,{asChild:!0,children:a}),e.jsxs(pe,{className:"sm:max-w-[700px]",children:[e.jsx(ve,{children:e.jsx(fe,{children:t("trafficRecord.title")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Nn,{children:[e.jsx(_n,{children:i.getHeaderGroups().map(d=>e.jsx(As,{children:d.headers.map(h=>e.jsx(Cn,{className:y("h-10 px-2 text-xs",h.id==="total"&&"text-right"),children:h.isPlaceholder?null:ga(h.column.columnDef.header,h.getContext())},h.id))},d.id))}),e.jsx(wn,{children:u?Array.from({length:r.pageSize}).map((d,h)=>e.jsx(As,{children:Array.from({length:sn.length}).map((k,C)=>e.jsx(vt,{className:"p-2",children:e.jsx(he,{className:"h-6 w-full"})},C))},h)):i.getRowModel().rows?.length?i.getRowModel().rows.map(d=>e.jsx(As,{"data-state":d.getIsSelected()&&"selected",className:"h-10",children:d.getVisibleCells().map(h=>e.jsx(vt,{className:"px-2",children:ga(h.column.columnDef.cell,h.getContext())},h.id))},d.id)):e.jsx(As,{children:e.jsx(vt,{colSpan:sn.length,className:"h-24 text-center",children:t("trafficRecord.noRecords")})})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:t("trafficRecord.perPage")}),e.jsxs(J,{value:`${i.getState().pagination.pageSize}`,onValueChange:d=>{i.setPageSize(Number(d))},children:[e.jsx(W,{className:"h-8 w-[70px]",children:e.jsx(Q,{placeholder:i.getState().pagination.pageSize})}),e.jsx(Y,{side:"top",children:[10,20,30,40,50].map(d=>e.jsx(A,{value:`${d}`,children:d},d))})]}),e.jsx("p",{className:"text-sm font-medium",children:t("trafficRecord.records")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex w-[100px] items-center justify-center text-sm",children:t("trafficRecord.page",{current:i.getState().pagination.pageIndex+1,total:i.getPageCount()})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage()||u,children:e.jsx(jh,{className:"h-4 w-4"})}),e.jsx(K,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage()||u,children:e.jsx(vh,{className:"h-4 w-4"})})]})]})]})]})]})]})}function bh({onConfirm:s,children:a,title:t="确认操作",description:l="确定要执行此操作吗？",cancelText:n="取消",confirmText:r="确认",variant:o="default",className:c}){return e.jsxs(kn,{children:[e.jsx(Or,{asChild:!0,children:a}),e.jsxs(Va,{className:y("sm:max-w-[425px]",c),children:[e.jsxs(Fa,{children:[e.jsx(Oa,{children:t}),e.jsx(za,{children:l})]}),e.jsxs(Ma,{children:[e.jsx(Aa,{asChild:!0,children:e.jsx(L,{variant:"outline",children:n})}),e.jsx($a,{asChild:!0,children:e.jsx(L,{variant:o,onClick:s,children:r})})]})]})]})}const yh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M5 18h4.24a1 1 0 0 0 .71-.29l6.92-6.93L19.71 8a1 1 0 0 0 0-1.42l-4.24-4.29a1 1 0 0 0-1.42 0l-2.82 2.83l-6.94 6.93a1 1 0 0 0-.29.71V17a1 1 0 0 0 1 1m9.76-13.59l2.83 2.83l-1.42 1.42l-2.83-2.83ZM6 13.17l5.93-5.93l2.83 2.83L8.83 16H6ZM21 20H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"})}),Nh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11h-6V5a1 1 0 0 0-2 0v6H5a1 1 0 0 0 0 2h6v6a1 1 0 0 0 2 0v-6h6a1 1 0 0 0 0-2"})}),_h=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21 8.94a1.3 1.3 0 0 0-.06-.27v-.09a1 1 0 0 0-.19-.28l-6-6a1 1 0 0 0-.28-.19a.3.3 0 0 0-.09 0a.9.9 0 0 0-.33-.11H10a3 3 0 0 0-3 3v1H6a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-1h1a3 3 0 0 0 3-3zm-6-3.53L17.59 8H16a1 1 0 0 1-1-1ZM15 19a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h1v7a3 3 0 0 0 3 3h5Zm4-4a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3v3a3 3 0 0 0 3 3h3Z"})}),wh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21 11a1 1 0 0 0-1 1a8.05 8.05 0 1 1-2.22-5.5h-2.4a1 1 0 0 0 0 2h4.53a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1.77A10 10 0 1 0 22 12a1 1 0 0 0-1-1"})}),Ch=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9.5 10.5H12a1 1 0 0 0 0-2h-1V8a1 1 0 0 0-2 0v.55a2.5 2.5 0 0 0 .5 4.95h1a.5.5 0 0 1 0 1H8a1 1 0 0 0 0 2h1v.5a1 1 0 0 0 2 0v-.55a2.5 2.5 0 0 0-.5-4.95h-1a.5.5 0 0 1 0-1M21 12h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Z"})}),Sh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M12.3 12.22A4.92 4.92 0 0 0 14 8.5a5 5 0 0 0-10 0a4.92 4.92 0 0 0 1.7 3.72A8 8 0 0 0 1 19.5a1 1 0 0 0 2 0a6 6 0 0 1 12 0a1 1 0 0 0 2 0a8 8 0 0 0-4.7-7.28M9 11.5a3 3 0 1 1 3-3a3 3 0 0 1-3 3m9.74.32A5 5 0 0 0 15 3.5a1 1 0 0 0 0 2a3 3 0 0 1 3 3a3 3 0 0 1-1.5 2.59a1 1 0 0 0-.5.84a1 1 0 0 0 .45.86l.39.26l.13.07a7 7 0 0 1 4 6.38a1 1 0 0 0 2 0a9 9 0 0 0-4.23-7.68"})}),kh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M12 2a10 10 0 0 0-6.88 2.77V3a1 1 0 0 0-2 0v4.5a1 1 0 0 0 1 1h4.5a1 1 0 0 0 0-2h-2.4A8 8 0 1 1 4 12a1 1 0 0 0-2 0A10 10 0 1 0 12 2m0 6a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h2a1 1 0 0 0 0-2h-1V9a1 1 0 0 0-1-1"})}),Th=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M20 6h-4V5a3 3 0 0 0-3-3h-2a3 3 0 0 0-3 3v1H4a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3V8h1a1 1 0 0 0 0-2M10 5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1h-4Zm7 14a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8h10Z"})}),Dh=(s,a,t,l)=>{const{t:n}=V("user");return[{accessorKey:"is_admin",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.is_admin")}),enableSorting:!1,enableHiding:!0,filterFn:(r,o,c)=>c.includes(r.getValue(o)),size:0},{accessorKey:"is_staff",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.is_staff")}),enableSorting:!1,enableHiding:!0,filterFn:(r,o,c)=>c.includes(r.getValue(o)),size:0},{accessorKey:"id",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.id")}),cell:({row:r})=>e.jsx(G,{variant:"outline",children:r.original.id}),enableSorting:!0,enableHiding:!1},{accessorKey:"email",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.email")}),cell:({row:r})=>{const o=r.original.t||0,c=Date.now()/1e3-o<120,u=Math.floor(Date.now()/1e3-o);let i=c?n("columns.online_status.online"):o===0?n("columns.online_status.never"):n("columns.online_status.last_online",{time:Se(o)});if(!c&&o!==0){const d=Math.floor(u/60),h=Math.floor(d/60),k=Math.floor(h/24);k>0?i+=`
`+n("columns.online_status.offline_duration.days",{count:k}):h>0?i+=`
`+n("columns.online_status.offline_duration.hours",{count:h}):d>0?i+=`
`+n("columns.online_status.offline_duration.minutes",{count:d}):i+=`
`+n("columns.online_status.offline_duration.seconds",{count:u})}return e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:y("size-2.5 rounded-full ring-2 ring-offset-2",c?"bg-green-500 ring-green-500/20":"bg-gray-300 ring-gray-300/20","transition-all duration-300")}),e.jsx("span",{className:"font-medium text-foreground/90",children:r.original.email})]})}),e.jsx(oe,{side:"bottom",className:"max-w-[280px]",children:e.jsx("p",{className:"whitespace-pre-line text-sm",children:i})})]})})},enableSorting:!1,enableHiding:!1},{accessorKey:"online_count",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.online_count")}),cell:({row:r})=>{const o=r.original.device_limit,c=r.original.online_count||0;return e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsxs(G,{variant:"outline",className:y("min-w-[4rem] justify-center",o!==null&&c>=o?"border-destructive/50 bg-destructive/10 text-destructive":"border-primary/40 bg-primary/5 text-primary/90"),children:[c," / ",o===null?"∞":o]})})}),e.jsx(oe,{side:"bottom",children:e.jsx("p",{className:"text-sm",children:o===null?n("columns.device_limit.unlimited"):n("columns.device_limit.limited",{count:o})})})]})})},enableSorting:!0,enableHiding:!1},{accessorKey:"banned",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.status")}),cell:({row:r})=>{const o=r.original.banned;return e.jsx("div",{className:"flex justify-center",children:e.jsx(G,{className:y("min-w-20 justify-center transition-colors",o?"bg-destructive/15 text-destructive hover:bg-destructive/25":"bg-success/15 text-success hover:bg-success/25"),children:n(o?"columns.status_text.banned":"columns.status_text.normal")})})},enableSorting:!0,filterFn:(r,o,c)=>c.includes(r.getValue(o))},{accessorKey:"plan_id",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.subscription")}),cell:({row:r})=>e.jsx("div",{className:"min-w-[10em] break-all",children:r.original?.plan?.name||"-"}),enableSorting:!1,enableHiding:!1},{accessorKey:"group_id",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.group")}),cell:({row:r})=>e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx(G,{variant:"outline",className:y("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5 whitespace-nowrap"),children:r.original?.group?.name||"-"})}),enableSorting:!1},{accessorKey:"total_used",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.used_traffic")}),cell:({row:r})=>{const o=Oe(r.original?.total_used),c=Oe(r.original?.transfer_enable),u=r.original?.total_used/r.original?.transfer_enable*100||0;return e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{className:"w-full",children:e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:o}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[u.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full rounded-full bg-secondary",children:e.jsx("div",{className:y("h-full rounded-full transition-all",u>90?"bg-destructive":"bg-primary"),style:{width:`${Math.min(u,100)}%`}})})]})}),e.jsx(oe,{side:"bottom",children:e.jsxs("p",{className:"text-sm",children:[n("columns.total_traffic"),": ",c]})})]})})}},{accessorKey:"transfer_enable",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.total_traffic")}),cell:({row:r})=>e.jsx("div",{className:"font-medium text-muted-foreground",children:Oe(r.original?.transfer_enable)})},{accessorKey:"expired_at",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.expire_time")}),cell:({row:r})=>{const o=r.original.expired_at,c=Date.now()/1e3,u=o!=null&&o<c,i=o!=null?new Date(o*1e3):null,d=i!=null?Math.ceil((i.getTime()-Date.now())/(1e3*60*60*24)):null;return e.jsx(je,{delayDuration:100,children:e.jsxs(de,{children:[e.jsx(me,{className:"block w-full",children:e.jsx(G,{variant:"outline",className:y("w-full justify-center transition-colors",u?"border-destructive/50 bg-destructive/10 text-destructive":o?"border-success/50 bg-success/10 text-success":"border-primary/40 bg-primary/5 text-primary/90"),children:o==null?n("columns.expire_status.permanent"):Se(o,"YYYY-MM-DD")})}),e.jsx(oe,{side:"bottom",className:"space-y-1 p-3",children:o!=null?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n("columns.expire_time"),": ",Se(o)]}),e.jsx("p",{className:y("text-sm font-medium",u?"text-destructive":"text-success"),children:u?n("columns.expire_status.expired",{days:Math.abs(d??0)}):n("columns.expire_status.remaining",{days:d??0})})]}):e.jsx("p",{className:"text-sm font-medium",children:n("columns.expire_status.permanent")})})]})})}},{accessorKey:"balance",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.balance")}),cell:({row:r})=>{const o=gt(r.original?.balance);return e.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"¥"}),e.jsx("span",{className:"tabular-nums text-foreground",children:o})]})}},{accessorKey:"commission_balance",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.commission")}),cell:({row:r})=>{const o=gt(r.original?.commission_balance);return e.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"¥"}),e.jsx("span",{className:"tabular-nums text-foreground",children:o})]})}},{accessorKey:"created_at",header:({column:r})=>e.jsx(z,{column:r,title:n("columns.register_time")}),cell:({row:r})=>e.jsx("div",{className:"truncate",children:Se(r.original?.created_at)}),size:1e3},{id:"actions",header:({column:r})=>e.jsx(z,{column:r,className:"justify-end",title:n("columns.actions")}),cell:({row:r,table:o})=>e.jsxs(Es,{modal:!0,children:[e.jsx(Is,{asChild:!0,children:e.jsx("div",{className:"text-center",children:e.jsx(K,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":n("columns.actions"),children:e.jsx(va,{className:"size-4"})})})}),e.jsxs(ws,{align:"end",className:"min-w-[40px]",children:[e.jsx(_e,{onSelect:c=>{c.preventDefault(),t(r.original),l(!0)},className:"p-0",children:e.jsxs(K,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(yh,{className:"mr-2"}),n("columns.actions_menu.edit")]})}),e.jsx(_e,{onSelect:c=>c.preventDefault(),className:"p-0",children:e.jsx(Wr,{defaultValues:{email:r.original.email},trigger:e.jsxs(K,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Nh,{className:"mr-2 "}),n("columns.actions_menu.assign_order")]})})}),e.jsx(_e,{onSelect:()=>{ba(r.original.subscribe_url).then(()=>{$.success(n("common:copy.success"))})},className:"p-0",children:e.jsxs(K,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(_h,{className:"mr-2"}),n("columns.actions_menu.copy_url")]})}),e.jsx(_e,{onSelect:()=>{_s.resetSecret(r.original.id).then(({data:c})=>{c&&$.success("重置成功")})},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(wh,{className:"mr-2 "}),n("columns.actions_menu.reset_secret")]})}),e.jsx(_e,{onSelect:()=>{},className:"p-0",children:e.jsxs(nt,{className:"flex items-center px-2 py-1.5",to:`/finance/order?user_id=eq:${r.original?.id}`,children:[e.jsx(Ch,{className:"mr-2"}),n("columns.actions_menu.orders")]})}),e.jsx(_e,{onSelect:()=>{o.setColumnFilters([{id:"invite_user_id",value:"eq:"+r.original?.id}])},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Sh,{className:"mr-2 "}),n("columns.actions_menu.invites")]})}),e.jsx(_e,{onSelect:c=>c.preventDefault(),className:"p-0",children:e.jsx(ai,{user_id:r.original?.id,dialogTrigger:e.jsxs(K,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(kh,{className:"mr-2 "}),n("columns.actions_menu.traffic_records")]})})}),e.jsx(_e,{onSelect:c=>c.preventDefault(),className:"p-0",children:e.jsx(bh,{title:n("columns.actions_menu.delete_confirm_title"),description:n("columns.actions_menu.delete_confirm_description",{email:r.original.email}),cancelText:n("common:cancel"),confirmText:n("common:confirm"),variant:"destructive",onConfirm:async()=>{try{const{data:c}=await _s.destroy(r.original.id);c&&($.success(n("common:delete.success")),s())}catch{$.error(n("common:delete.failed"))}},children:e.jsxs(K,{variant:"ghost",className:"w-full justify-start px-2 py-1.5 text-destructive hover:text-destructive",children:[e.jsx(Th,{className:"mr-2"}),n("columns.actions_menu.delete")]})})})]})]})}]},ni=m.createContext(void 0),Vn=()=>{const s=m.useContext(ni);if(!s)throw new Error("useUserEdit must be used within an UserEditProvider");return s},li=({children:s,refreshData:a})=>{const[t,l]=m.useState(!1),[n,r]=m.useState(null),o={isOpen:t,setIsOpen:l,editingUser:n,setEditingUser:r,refreshData:a};return e.jsx(ni.Provider,{value:o,children:s})},Ph=x.object({id:x.number(),email:x.string().email(),invite_user_email:x.string().email().nullable().optional(),password:x.string().optional().nullable(),balance:x.coerce.number(),commission_balance:x.coerce.number(),u:x.number(),d:x.number(),transfer_enable:x.number(),expired_at:x.number().nullable(),plan_id:x.number().nullable(),banned:x.number(),commission_type:x.number(),commission_rate:x.number().nullable(),discount:x.number().nullable(),speed_limit:x.number().nullable(),device_limit:x.number().nullable(),is_admin:x.number(),is_staff:x.number(),remarks:x.string().nullable()});function ri(){const{t:s}=V("user"),{isOpen:a,setIsOpen:t,editingUser:l,refreshData:n}=Vn(),[r,o]=m.useState(!1),[c,u]=m.useState([]),i=Ne({resolver:we(Ph),defaultValues:{id:0,email:"",invite_user_email:null,password:null,balance:0,commission_balance:0,u:0,d:0,transfer_enable:0,expired_at:null,plan_id:null,banned:0,commission_type:0,commission_rate:null,discount:null,speed_limit:null,device_limit:null,is_admin:0,is_staff:0,remarks:null}});return m.useEffect(()=>{a&&ss.getList().then(({data:d})=>{u(d)})},[a]),m.useEffect(()=>{if(l){const d=l.invite_user?.email,{invite_user:h,...k}=l;i.reset({...k,invite_user_email:d||null,password:null})}},[l,i]),e.jsx(Xr,{open:a,onOpenChange:t,children:e.jsxs(Ln,{className:"max-w-[90%] space-y-4",children:[e.jsxs(En,{children:[e.jsx(In,{children:s("edit.title")}),e.jsx(Rn,{})]}),e.jsxs(Ce,{...i,children:[e.jsx(v,{control:i.control,name:"email",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.email")}),e.jsx(b,{children:e.jsx(D,{...d,placeholder:s("edit.form.email_placeholder"),autoComplete:"off","data-form-type":"other"})}),e.jsx(P,{...d})]})}),e.jsx(v,{control:i.control,name:"invite_user_email",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.inviter_email")}),e.jsx(b,{children:e.jsx(D,{value:d.value||"",onChange:h=>d.onChange(h.target.value?h.target.value:null),placeholder:s("edit.form.inviter_email_placeholder"),autoComplete:"off","data-form-type":"other"})}),e.jsx(P,{...d})]})}),e.jsx(v,{control:i.control,name:"password",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.password")}),e.jsx(b,{children:e.jsx(D,{type:"password",value:d.value||"",onChange:d.onChange,placeholder:s("edit.form.password_placeholder"),autoComplete:"off","data-form-type":"other"})}),e.jsx(P,{...d})]})}),e.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[e.jsx(v,{control:i.control,name:"balance",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.balance")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value||"",onChange:d.onChange,placeholder:s("edit.form.balance_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"¥"})]})}),e.jsx(P,{...d})]})}),e.jsx(v,{control:i.control,name:"commission_balance",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.commission_balance")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value||"",onChange:d.onChange,placeholder:s("edit.form.commission_balance_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"¥"})]})}),e.jsx(P,{...d})]})}),e.jsx(v,{control:i.control,name:"u",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.upload")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{value:d.value/1024/1024/1024||"",onChange:h=>d.onChange(parseInt(h.target.value)*1024*1024*1024),placeholder:s("edit.form.upload_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]})}),e.jsx(P,{...d})]})}),e.jsx(v,{control:i.control,name:"d",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.download")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value/1024/1024/1024||"",onChange:h=>d.onChange(parseInt(h.target.value)*1024*1024*1024),placeholder:s("edit.form.download_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]})}),e.jsx(P,{...d})]})})]}),e.jsx(v,{control:i.control,name:"transfer_enable",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.total_traffic")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value/1024/1024/1024||"",onChange:h=>d.onChange(parseInt(h.target.value)*1024*1024*1024),placeholder:s("edit.form.total_traffic_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]})}),e.jsx(P,{})]})}),e.jsx(v,{control:i.control,name:"expired_at",render:({field:d})=>e.jsxs(f,{className:"flex flex-col",children:[e.jsx(j,{children:s("edit.form.expire_time")}),e.jsxs(Cs,{open:r,onOpenChange:o,children:[e.jsx(Ss,{asChild:!0,children:e.jsx(b,{children:e.jsxs(L,{type:"button",variant:"outline",className:y("w-full pl-3 text-left font-normal",!d.value&&"text-muted-foreground"),onClick:()=>o(!0),children:[d.value?Se(d.value):e.jsx("span",{children:s("edit.form.expire_time_placeholder")}),e.jsx(Ct,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(bs,{className:"w-auto p-0",align:"start",side:"top",sideOffset:4,onInteractOutside:h=>{h.preventDefault()},onEscapeKeyDown:h=>{h.preventDefault()},children:e.jsxs("div",{className:"flex flex-col space-y-3 p-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{d.onChange(null),o(!1)},children:s("edit.form.expire_time_permanent")}),e.jsx(L,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{const h=new Date;h.setMonth(h.getMonth()+1),h.setHours(23,59,59,999),d.onChange(Math.floor(h.getTime()/1e3)),o(!1)},children:s("edit.form.expire_time_1month")}),e.jsx(L,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{const h=new Date;h.setMonth(h.getMonth()+3),h.setHours(23,59,59,999),d.onChange(Math.floor(h.getTime()/1e3)),o(!1)},children:s("edit.form.expire_time_3months")})]}),e.jsx("div",{className:"rounded-md border",children:e.jsx(ct,{mode:"single",selected:d.value?new Date(d.value*1e3):void 0,onSelect:h=>{if(h){const k=new Date(d.value?d.value*1e3:Date.now());h.setHours(k.getHours(),k.getMinutes(),k.getSeconds()),d.onChange(Math.floor(h.getTime()/1e3))}},disabled:h=>h<new Date,initialFocus:!0,className:"rounded-md border-none"})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:s("edit.form.expire_time_specific")}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const h=new Date;h.setHours(23,59,59,999),d.onChange(Math.floor(h.getTime()/1e3))},className:"h-6 px-2 text-xs",children:s("edit.form.expire_time_today")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"datetime-local",step:"1",value:Se(d.value,"YYYY-MM-DDTHH:mm:ss"),onChange:h=>{const k=new Date(h.target.value);isNaN(k.getTime())||d.onChange(Math.floor(k.getTime()/1e3))},className:"flex-1"}),e.jsx(L,{type:"button",variant:"outline",onClick:()=>o(!1),children:s("edit.form.expire_time_confirm")})]})]})]})})]}),e.jsx(P,{})]})}),e.jsx(v,{control:i.control,name:"plan_id",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.subscription")}),e.jsx(b,{children:e.jsxs(J,{value:d.value!==null?String(d.value):"null",onValueChange:h=>d.onChange(h==="null"?null:parseInt(h)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:s("edit.form.subscription_none")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"null",children:s("edit.form.subscription_none")}),c.map(h=>e.jsx(A,{value:String(h.id),children:h.name},h.id))]})]})})]})}),e.jsx(v,{control:i.control,name:"banned",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.account_status")}),e.jsx(b,{children:e.jsxs(J,{value:d.value.toString(),onValueChange:h=>d.onChange(parseInt(h)),children:[e.jsx(W,{children:e.jsx(Q,{})}),e.jsxs(Y,{children:[e.jsx(A,{value:"1",children:s("columns.status_text.banned")}),e.jsx(A,{value:"0",children:s("columns.status_text.normal")})]})]})})]})}),e.jsx(v,{control:i.control,name:"commission_type",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.commission_type")}),e.jsx(b,{children:e.jsxs(J,{value:d.value.toString(),onValueChange:h=>d.onChange(parseInt(h)),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:s("edit.form.subscription_none")})}),e.jsxs(Y,{children:[e.jsx(A,{value:"0",children:s("edit.form.commission_type_system")}),e.jsx(A,{value:"1",children:s("edit.form.commission_type_cycle")}),e.jsx(A,{value:"2",children:s("edit.form.commission_type_onetime")})]})]})})]})}),e.jsx(v,{control:i.control,name:"commission_rate",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.commission_rate")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value||"",onChange:h=>d.onChange(parseInt(h.currentTarget.value)||null),placeholder:s("edit.form.commission_rate_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"%"})]})})]})}),e.jsx(v,{control:i.control,name:"discount",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.discount")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value||"",onChange:h=>d.onChange(parseInt(h.currentTarget.value)||null),placeholder:s("edit.form.discount_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"%"})]})}),e.jsx(P,{})]})}),e.jsx(v,{control:i.control,name:"speed_limit",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.speed_limit")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value||"",onChange:h=>d.onChange(parseInt(h.currentTarget.value)||null),placeholder:s("edit.form.speed_limit_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"Mbps"})]})}),e.jsx(P,{})]})}),e.jsx(v,{control:i.control,name:"device_limit",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.device_limit")}),e.jsx(b,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:d.value||"",onChange:h=>d.onChange(parseInt(h.currentTarget.value)||null),placeholder:s("edit.form.device_limit_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"台"})]})}),e.jsx(P,{})]})}),e.jsx(v,{control:i.control,name:"is_admin",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.is_admin")}),e.jsx("div",{className:"py-2",children:e.jsx(b,{children:e.jsx(Z,{checked:d.value===1,onCheckedChange:h=>d.onChange(h?1:0)})})})]})}),e.jsx(v,{control:i.control,name:"is_staff",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.is_staff")}),e.jsx("div",{className:"py-2",children:e.jsx(b,{children:e.jsx(Z,{checked:d.value===1,onCheckedChange:h=>d.onChange(h?1:0)})})})]})}),e.jsx(v,{control:i.control,name:"remarks",render:({field:d})=>e.jsxs(f,{children:[e.jsx(j,{children:s("edit.form.remarks")}),e.jsx(b,{children:e.jsx(ks,{className:"h-24",value:d.value||"",onChange:h=>d.onChange(h.currentTarget.value??null),placeholder:s("edit.form.remarks_placeholder")})}),e.jsx(P,{})]})}),e.jsxs(ei,{children:[e.jsx(L,{variant:"outline",onClick:()=>t(!1),children:s("edit.form.cancel")}),e.jsx(L,{type:"submit",onClick:()=>{i.handleSubmit(d=>{_s.update(d).then(({data:h})=>{h&&($.success(s("edit.form.success")),t(!1),n())})})()},children:s("edit.form.submit")})]})]})]})})}function Lh(){const[s]=ur(),[a,t]=m.useState({}),[l,n]=m.useState({is_admin:!1,is_staff:!1}),[r,o]=m.useState([]),[c,u]=m.useState([]),[i,d]=m.useState({pageIndex:0,pageSize:20});m.useEffect(()=>{const p=s.get("email");p&&o(_=>_.some(H=>H.id==="email")?_:[..._,{id:"email",value:p}])},[s]);const{refetch:h,data:k,isLoading:C}=le({queryKey:["userList",i,r,c],queryFn:()=>_s.getList({pageSize:i.pageSize,current:i.pageIndex+1,filter:r,sort:c})}),[S,w]=m.useState([]),[N,g]=m.useState([]);m.useEffect(()=>{rt.getList().then(({data:p})=>{w(p)}),ss.getList().then(({data:p})=>{g(p)})},[]);const T=S.map(p=>({label:p.name,value:p.id})),E=N.map(p=>({label:p.name,value:p.id}));return e.jsxs(li,{refreshData:h,children:[e.jsx(Eh,{data:k?.data??[],rowCount:k?.total??0,sorting:c,setSorting:u,columnVisibility:l,setColumnVisibility:n,rowSelection:a,setRowSelection:t,columnFilters:r,setColumnFilters:o,pagination:i,setPagination:d,refetch:h,serverGroupList:S,permissionGroups:T,subscriptionPlans:E}),e.jsx(ri,{})]})}function Eh({data:s,rowCount:a,sorting:t,setSorting:l,columnVisibility:n,setColumnVisibility:r,rowSelection:o,setRowSelection:c,columnFilters:u,setColumnFilters:i,pagination:d,setPagination:h,refetch:k,serverGroupList:C,permissionGroups:S,subscriptionPlans:w}){const{setIsOpen:N,setEditingUser:g}=Vn(),T=Je({data:s,columns:Dh(k,C,g,N),state:{sorting:t,columnVisibility:n,rowSelection:o,columnFilters:u,pagination:d},rowCount:a,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:c,onSortingChange:l,onColumnFiltersChange:i,onColumnVisibilityChange:r,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),onPaginationChange:h,getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnVisibility:{commission_balance:!1,created_at:!1,is_admin:!1,is_staff:!1,permission_group:!1,plan_id:!1},columnPinning:{right:["actions"]}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(fh,{table:T,refetch:k,serverGroupList:C,permissionGroups:S,subscriptionPlans:w}),e.jsx(os,{table:T})]})}function Ih(){const{t:s}=V("user");return e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("manage.title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("manage.description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Lh,{})})})]})]})}const Rh=Object.freeze(Object.defineProperty({__proto__:null,default:Ih},Symbol.toStringTag,{value:"Module"}));function Vh({column:s,title:a,options:t}){const l=new Set(s?.getFilterValue());return e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(K,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Jc,{className:"mr-2 h-4 w-4"}),a,l?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):t.filter(n=>l.has(n.value)).map(n=>e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:n.label},`selected-${n.value}`))})]})]})}),e.jsx(bs,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Us,{children:[e.jsx(it,{placeholder:a}),e.jsxs(Ks,{children:[e.jsx(ot,{children:"No results found."}),e.jsx(ns,{children:t.map(n=>{const r=l.has(n.value);return e.jsxs($e,{onSelect:()=>{r?l.delete(n.value):l.add(n.value);const o=Array.from(l);s?.setFilterValue(o.length?o:void 0)},children:[e.jsx("div",{className:y("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",r?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Qc,{className:y("h-4 w-4")})}),n.icon&&e.jsx(n.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:n.label})]},`option-${n.value}`)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{}),e.jsx(ns,{children:e.jsx($e,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Fh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11H5a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})});function Mh({table:s}){const{t:a}=V("ticket");return e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-4",children:[e.jsx(Wt,{defaultValue:s.getColumn("status")?.getFilterValue(),onValueChange:t=>s.getColumn("status")?.setFilterValue(t),children:e.jsxs(kt,{className:"grid w-full grid-cols-2",children:[e.jsx(es,{value:"0",children:a("status.pending")}),e.jsx(es,{value:"1",children:a("status.closed")})]})}),s.getColumn("level")&&e.jsx(Vh,{column:s.getColumn("level"),title:a("columns.level"),options:[{label:a("level.low"),value:qe.LOW,icon:Fh,color:"gray"},{label:a("level.medium"),value:qe.MIDDLE,icon:si,color:"yellow"},{label:a("level.high"),value:qe.HIGH,icon:ti,color:"red"}]})]})})}function Oh(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[e.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const zh=tt("flex gap-2 max-w-[60%] items-end relative group",{variants:{variant:{received:"self-start",sent:"self-end flex-row-reverse"},layout:{default:"",ai:"max-w-full w-full items-center"}},defaultVariants:{variant:"received",layout:"default"}}),ii=m.forwardRef(({className:s,variant:a,layout:t,children:l,...n},r)=>e.jsx("div",{className:y(zh({variant:a,layout:t,className:s}),"relative group"),ref:r,...n,children:m.Children.map(l,o=>m.isValidElement(o)&&typeof o.type!="string"?m.cloneElement(o,{variant:a,layout:t}):o)}));ii.displayName="ChatBubble";const $h=tt("p-4",{variants:{variant:{received:"bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg",sent:"bg-primary text-primary-foreground rounded-l-lg rounded-tr-lg"},layout:{default:"",ai:"border-t w-full rounded-none bg-transparent"}},defaultVariants:{variant:"received",layout:"default"}}),oi=m.forwardRef(({className:s,variant:a,layout:t,isLoading:l=!1,children:n,...r},o)=>e.jsx("div",{className:y($h({variant:a,layout:t,className:s}),"break-words max-w-full whitespace-pre-wrap"),ref:o,...r,children:l?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Oh,{})}):n}));oi.displayName="ChatBubbleMessage";const Ah=m.forwardRef(({variant:s,className:a,children:t,...l},n)=>e.jsx("div",{ref:n,className:y("absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200",s==="sent"?"-left-1 -translate-x-full flex-row-reverse":"-right-1 translate-x-full",a),...l,children:t}));Ah.displayName="ChatBubbleActionWrapper";const ci=m.forwardRef(({className:s,...a},t)=>e.jsx(ks,{autoComplete:"off",ref:t,name:"message",className:y("max-h-12 px-4 py-3 bg-background text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 w-full rounded-md flex items-center h-16 resize-none",s),...a}));ci.displayName="ChatInput";const di=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29l-4.3 4.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l4.29-4.3l4.29 4.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42Z"})}),mi=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.098 12.634L13 11.423V7a1 1 0 0 0-2 0v5a1 1 0 0 0 .5.866l2.598 1.5a1 1 0 1 0 1-1.732M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8.01 8.01 0 0 1-8 8"})}),dl=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m11.29 12l3.54-3.54a1 1 0 0 0 0-1.41a1 1 0 0 0-1.42 0l-4.24 4.24a1 1 0 0 0 0 1.42L13.41 17a1 1 0 0 0 .71.29a1 1 0 0 0 .71-.29a1 1 0 0 0 0-1.41Z"})}),qh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.39M11 18a7 7 0 1 1 7-7a7 7 0 0 1-7 7"})}),Hh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M3.71 16.29a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21a1 1 0 0 0-.21.33a1 1 0 0 0 .21 1.09a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1 1 0 0 0 .21-1.09a1 1 0 0 0-.21-.33M7 8h14a1 1 0 0 0 0-2H7a1 1 0 0 0 0 2m-3.29 3.29a1 1 0 0 0-1.09-.21a1.2 1.2 0 0 0-.33.21a1 1 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1 1 0 0 0-.21-.33M21 11H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2M3.71 6.29a1 1 0 0 0-.33-.21a1 1 0 0 0-1.09.21a1.2 1.2 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a1 1 0 0 0 1.09-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1.2 1.2 0 0 0-.21-.33M21 16H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})}),Uh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9 12H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-1-2h4a1 1 0 0 0 0-2H8a1 1 0 0 0 0 2m1 6H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m12-4h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Zm-6.44-2.83a.8.8 0 0 0-.18-.09a.6.6 0 0 0-.19-.06a1 1 0 0 0-.9.27A1.05 1.05 0 0 0 12 17a1 1 0 0 0 .07.38a1.2 1.2 0 0 0 .22.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21A1 1 0 0 0 14 17a1.05 1.05 0 0 0-.29-.71a2 2 0 0 0-.15-.12m.14-3.88a1 1 0 0 0-1.62.33A1 1 0 0 0 13 14a1 1 0 0 0 1-1a1 1 0 0 0-.08-.38a.9.9 0 0 0-.22-.33"})});function Kh(){return e.jsxs("div",{className:"flex h-full flex-col space-y-4 p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{className:"h-8 w-3/4"}),e.jsx(he,{className:"h-4 w-1/2"})]}),e.jsx("div",{className:"flex-1 space-y-4",children:[1,2,3].map(s=>e.jsx(he,{className:"h-20 w-2/3"},s))})]})}function Bh(){return e.jsx("div",{className:"space-y-4 p-4",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{className:"h-5 w-4/5"}),e.jsx(he,{className:"h-4 w-2/3"}),e.jsx(he,{className:"h-3 w-1/2"})]},s))})}function Gh({ticket:s,isActive:a,onClick:t}){const{t:l}=V("ticket"),n=r=>{switch(r){case qe.HIGH:return"bg-red-50 text-red-600 border-red-200";case qe.MIDDLE:return"bg-yellow-50 text-yellow-600 border-yellow-200";case qe.LOW:return"bg-green-50 text-green-600 border-green-200";default:return"bg-gray-50 text-gray-600 border-gray-200"}};return e.jsxs("div",{className:y("flex cursor-pointer flex-col border-b p-4 hover:bg-accent/50",a&&"bg-accent"),onClick:t,children:[e.jsxs("div",{className:"flex max-w-[280px] items-center justify-between gap-2",children:[e.jsx("h4",{className:"flex-1 truncate font-medium",children:s.subject}),e.jsx(G,{variant:s.status===Hs.CLOSED?"secondary":"default",className:"shrink-0",children:s.status===Hs.CLOSED?l("status.closed"):l("status.processing")})]}),e.jsx("div",{className:"mt-1 max-w-[280px] truncate text-sm text-muted-foreground",children:s.user?.email}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs",children:[e.jsx("time",{className:"text-muted-foreground",children:Se(s.updated_at)}),e.jsx("div",{className:y("rounded-full border px-2 py-0.5 text-xs font-medium",n(s.level)),children:l(`level.${s.level===qe.LOW?"low":s.level===qe.MIDDLE?"medium":"high"}`)})]})]})}function Wh({ticketId:s,dialogTrigger:a}){const{t}=V("ticket"),l=Rs(),n=m.useRef(null),r=m.useRef(null),[o,c]=m.useState(!1),[u,i]=m.useState(""),[d,h]=m.useState(!1),[k,C]=m.useState(s),[S,w]=m.useState(""),[N,g]=m.useState(!1),{setIsOpen:T,setEditingUser:E}=Vn(),{data:p,isLoading:_,refetch:I}=le({queryKey:["tickets",o],queryFn:()=>o?jt.getList({filter:[{id:"status",value:[Hs.OPENING]}]}):Promise.resolve(null),enabled:o}),{data:H,refetch:O,isLoading:B}=le({queryKey:["ticket",k,o],queryFn:()=>o?jt.getInfo(k):Promise.resolve(null),refetchInterval:o?5e3:!1,retry:3}),ue=H?.data,te=(p?.data||[]).filter(re=>re.subject.toLowerCase().includes(S.toLowerCase())||re.user?.email.toLowerCase().includes(S.toLowerCase())),q=(re="smooth")=>{if(n.current){const{scrollHeight:us,clientHeight:Ts}=n.current;n.current.scrollTo({top:us-Ts,behavior:re})}};m.useEffect(()=>{if(!o)return;const re=requestAnimationFrame(()=>{q("instant"),setTimeout(()=>q(),1e3)});return()=>{cancelAnimationFrame(re)}},[o,ue?.messages]);const R=async()=>{const re=u.trim();!re||d||(h(!0),jt.reply({id:k,message:re}).then(()=>{i(""),O(),q(),setTimeout(()=>{r.current?.focus()},0)}).finally(()=>{h(!1)}))},X=async()=>{jt.close(k).then(()=>{$.success(t("actions.close_success")),O(),I()})},ms=()=>{ue?.user&&l("/finance/order?user_id="+ue.user.id)},Te=ue?.status===Hs.CLOSED;return e.jsxs(ge,{open:o,onOpenChange:c,children:[e.jsx(is,{asChild:!0,children:a??e.jsx(K,{variant:"outline",children:t("actions.view_ticket")})}),e.jsxs(pe,{className:"flex h-[90vh] max-w-6xl flex-col gap-0 p-0",children:[e.jsx(fe,{}),e.jsxs("div",{className:"flex h-full",children:[e.jsx(K,{variant:"ghost",size:"icon",className:"absolute left-2 top-2 z-50 md:hidden",onClick:()=>g(!N),children:e.jsx(dl,{className:y("h-4 w-4 transition-transform",!N&&"rotate-180")})}),e.jsxs("div",{className:y("absolute inset-y-0 left-0 z-40 flex flex-col border-r bg-background transition-transform duration-200 ease-in-out md:relative",N?"-translate-x-full":"translate-x-0","w-80 md:w-80 md:translate-x-0"),children:[e.jsxs("div",{className:"space-y-4 border-b p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:t("list.title")}),e.jsx(K,{variant:"ghost",size:"icon",className:"hidden h-8 w-8 md:flex",onClick:()=>g(!N),children:e.jsx(dl,{className:y("h-4 w-4 transition-transform",!N&&"rotate-180")})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(qh,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"}),e.jsx(D,{placeholder:t("list.search_placeholder"),value:S,onChange:re=>w(re.target.value),className:"pl-8"})]})]}),e.jsx(_t,{className:"flex-1",children:e.jsx("div",{className:"w-full",children:_?e.jsx(Bh,{}):te.length===0?e.jsx("div",{className:"flex h-full items-center justify-center p-4 text-muted-foreground",children:t(S?"list.no_search_results":"list.no_tickets")}):te.map(re=>e.jsx(Gh,{ticket:re,isActive:re.id===k,onClick:()=>{C(re.id),window.innerWidth<768&&g(!0)}},re.id))})})]}),e.jsxs("div",{className:"relative flex flex-1 flex-col",children:[!N&&e.jsx("div",{className:"absolute inset-0 z-30 bg-black/20 md:hidden",onClick:()=>g(!0)}),B?e.jsx(Kh,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4 border-b p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:ue?.subject}),e.jsx(G,{variant:Te?"secondary":"default",children:t(Te?"status.closed":"status.processing")}),!Te&&e.jsx(ls,{title:t("actions.close_confirm_title"),description:t("actions.close_confirm_description"),confirmText:t("actions.close_confirm_button"),variant:"destructive",onConfirm:X,children:e.jsxs(K,{variant:"ghost",size:"sm",className:"gap-1 text-muted-foreground hover:text-destructive",children:[e.jsx(di,{className:"h-4 w-4"}),t("actions.close_ticket")]})})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(wa,{className:"h-4 w-4"}),e.jsx("span",{children:ue?.user?.email})]}),e.jsx(De,{orientation:"vertical",className:"h-4"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(mi,{className:"h-4 w-4"}),e.jsxs("span",{children:[t("detail.created_at")," ",Se(ue?.created_at)]})]}),e.jsx(De,{orientation:"vertical",className:"h-4"}),e.jsx(G,{variant:"outline",children:ue?.level!=null&&t(`level.${ue.level===qe.LOW?"low":ue.level===qe.MIDDLE?"medium":"high"}`)})]})]}),ue?.user&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(K,{variant:"outline",size:"icon",className:"h-8 w-8",title:t("detail.user_info"),onClick:()=>{E(ue.user),T(!0)},children:e.jsx(wa,{className:"h-4 w-4"})}),e.jsx(ai,{user_id:ue.user.id,dialogTrigger:e.jsx(K,{variant:"outline",size:"icon",className:"h-8 w-8",title:t("detail.traffic_records"),children:e.jsx(Hh,{className:"h-4 w-4"})})}),e.jsx(K,{variant:"outline",size:"icon",className:"h-8 w-8",title:t("detail.order_records"),onClick:ms,children:e.jsx(Uh,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{ref:n,className:"h-full space-y-4 overflow-y-auto p-6",children:ue?.messages?.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:t("detail.no_messages")}):ue?.messages?.map(re=>e.jsx(ii,{variant:re.is_from_admin?"sent":"received",className:re.is_from_admin?"ml-auto":"mr-auto",children:e.jsx(oi,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"whitespace-pre-wrap break-words",children:re.message}),e.jsx("div",{className:"text-right",children:e.jsx("time",{className:"text-[10px] text-muted-foreground",children:Se(re.created_at)})})]})})},re.id))})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"relative flex items-center space-x-2",children:[e.jsx(ci,{ref:r,disabled:Te||d,placeholder:t(Te?"detail.input.closed_placeholder":"detail.input.reply_placeholder"),className:"flex-1 resize-none rounded-lg border bg-background p-3 focus-visible:ring-1",value:u,onChange:re=>i(re.target.value),onKeyDown:re=>{re.key==="Enter"&&!re.shiftKey&&(re.preventDefault(),R())}}),e.jsx(K,{disabled:Te||d||!u.trim(),onClick:R,children:t(d?"detail.input.sending":"detail.input.send")})]})})]})]})]})]})]})}const Yh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3m-.41 2l-5.88 5.88a1 1 0 0 1-1.42 0L5.41 6ZM20 17a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V7.41l5.88 5.88a3 3 0 0 0 4.24 0L20 7.41Z"})}),Jh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21.92 11.6C19.9 6.91 16.1 4 12 4s-7.9 2.91-9.92 7.6a1 1 0 0 0 0 .8C4.1 17.09 7.9 20 12 20s7.9-2.91 9.92-7.6a1 1 0 0 0 0-.8M12 18c-3.17 0-6.17-2.29-7.9-6C5.83 8.29 8.83 6 12 6s6.17 2.29 7.9 6c-1.73 3.71-4.73 6-7.9 6m0-10a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 6a2 2 0 1 1 2-2a2 2 0 0 1-2 2"})}),Qh=s=>{const{t:a}=V("ticket");return[{accessorKey:"id",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.id")}),cell:({row:t})=>e.jsx(G,{variant:"outline",children:t.getValue("id")}),enableSorting:!1,enableHiding:!1},{accessorKey:"subject",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.subject")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yh,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-[500px] truncate font-medium",children:t.getValue("subject")})]}),enableSorting:!1,enableHiding:!1,size:4e3},{accessorKey:"level",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.level")}),cell:({row:t})=>{const l=t.getValue("level"),n=l===qe.LOW?"default":l===qe.MIDDLE?"secondary":"destructive";return e.jsx(G,{variant:n,className:"whitespace-nowrap",children:a(`level.${l===qe.LOW?"low":l===qe.MIDDLE?"medium":"high"}`)})},filterFn:(t,l,n)=>n.includes(t.getValue(l))},{accessorKey:"status",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.status")}),cell:({row:t})=>{const l=t.getValue("status"),n=t.original.reply_status,r=l===Hs.CLOSED?a("status.closed"):a(n===0?"status.replied":"status.pending"),o=l===Hs.CLOSED?"default":n===0?"secondary":"destructive";return e.jsx(G,{variant:o,className:"whitespace-nowrap",children:r})}},{accessorKey:"updated_at",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.updated_at")}),cell:({row:t})=>e.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[e.jsx(mi,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:Se(t.getValue("updated_at"))})]}),enableSorting:!0},{accessorKey:"created_at",header:({column:t})=>e.jsx(z,{column:t,title:a("columns.created_at")}),cell:({row:t})=>e.jsx("div",{className:"text-sm text-muted-foreground",children:Se(t.getValue("created_at"))}),enableSorting:!0,meta:{isFlexGrow:!0}},{id:"actions",header:({column:t})=>e.jsx(z,{className:"justify-end",column:t,title:a("columns.actions")}),cell:({row:t})=>{const l=t.original.status!==Hs.CLOSED;return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Wh,{ticketId:t.original.id,dialogTrigger:e.jsx(K,{variant:"ghost",size:"icon",className:"h-8 w-8",title:a("actions.view_details"),children:e.jsx(Jh,{className:"h-4 w-4"})})}),l&&e.jsx(ls,{title:a("actions.close_confirm_title"),description:a("actions.close_confirm_description"),confirmText:a("actions.close_confirm_button"),variant:"destructive",onConfirm:async()=>{jt.close(t.original.id).then(()=>{$.success(a("actions.close_success")),s()})},children:e.jsx(K,{variant:"ghost",size:"icon",className:"h-8 w-8",title:a("actions.close_ticket"),children:e.jsx(di,{className:"h-4 w-4"})})})]})}}]};function Xh(){const[s,a]=m.useState({}),[t,l]=m.useState({}),[n,r]=m.useState([{id:"status",value:"0"}]),[o,c]=m.useState([]),[u,i]=m.useState({pageIndex:0,pageSize:20}),{refetch:d,data:h}=le({queryKey:["orderList",u,n,o],queryFn:()=>jt.getList({pageSize:u.pageSize,current:u.pageIndex+1,filter:n,sort:o})}),k=Je({data:h?.data??[],columns:Qh(d),state:{sorting:o,columnVisibility:t,rowSelection:s,columnFilters:n,pagination:u},rowCount:h?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:c,onColumnFiltersChange:r,onColumnVisibilityChange:l,getCoreRowModel:Qe(),getFilteredRowModel:js(),getPaginationRowModel:rs(),onPaginationChange:i,getSortedRowModel:vs(),getFacetedRowModel:Vs(),getFacetedUniqueValues:Fs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Mh,{table:k,refetch:d}),e.jsx(os,{table:k,showPagination:!0})]})}function Zh(){const{t:s}=V("ticket");return e.jsxs(li,{refreshData:()=>{},children:[e.jsxs(Ve,{children:[e.jsxs(Fe,{children:[e.jsx(Xe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Ke,{})]})]}),e.jsxs(Ae,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Xh,{})})]})]}),e.jsx(ri,{})]})}const ep=Object.freeze(Object.defineProperty({__proto__:null,default:Zh},Symbol.toStringTag,{value:"Module"}));export{rp as a,np as c,lp as g,ip as r};
